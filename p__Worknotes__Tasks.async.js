(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[117],{JfGV:function(e,t,a){"use strict";a.r(t);a("IzEo");var n,o,r,l,s,c,i=a("bx4M"),u=(a("qVdP"),a("jsC+")),d=(a("lUTK"),a("BvKs")),m=(a("Awhp"),a("KrTs")),p=(a("Pwec"),a("CtXQ")),h=(a("5NDa"),a("5rEg")),f=(a("T2oS"),a("W9HT")),k=(a("+L6B"),a("2/Rp")),b=(a("miYZ"),a("tsqr")),w=(a("2qtc"),a("kLXV")),y=a("qIgq"),g=a.n(y),E=a("d6i3"),C=a.n(E),v=a("1l/V"),S=a.n(v),T=a("p0pE"),x=a.n(T),_=a("2Taf"),O=a.n(_),I=a("vZ4D"),j=a.n(I),V=a("l4Ni"),W=a.n(V),F=a("ujKo"),A=a.n(F),B=a("MhPg"),M=a.n(B),P=(a("g9YV"),a("wCAj")),D=a("q1tI"),K=a.n(D),N=a("MuoO"),z=a("34ay"),q=a("zHco"),L=(a("3eRE"),a("FkSf")),R=a("6NK7"),J=a("Tt/K"),Z=a("tR9B"),H=a("rFvL"),U=(a("Znn+"),a("ZTPi")),X=(a("14J3"),a("BMrR")),Y=(a("jCWc"),a("kPKH")),G=(a("hN3k"),{row:{marginBottom:8},label:{textAlign:"right",fontWeight:"500",fontSize:14},content:{textAlign:"left",fontSize:14}}),Q=(n=Object(N["connect"])(),n((r=function(e){function t(){var e,a;O()(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return a=W()(this,(e=A()(t)).call.apply(e,[this].concat(o))),a.state={worknote:null},a.fetchWorknote=function(e){a.props.dispatch({type:"worknotes/worknotes/get",payload:{worknoteId:e},callback:a.fetchWorknoteCallback})},a.fetchWorknoteCallback=function(e){a.setState({worknote:e})},a}return M()(t,e),j()(t,[{key:"componentDidMount",value:function(){this.fetchWorknote(this.props.worknoteId)}},{key:"render",value:function(){var e=this.state.worknote;return e?K.a.createElement(U["a"],null,K.a.createElement(U["a"].TabPane,{tab:"\u4efb\u52a1\u8be6\u60c5",key:1},K.a.createElement("div",null,K.a.createElement(X["a"],{style:G.row,gutter:8,justify:"space-around"},K.a.createElement(Y["a"],{style:G.label,span:6},"\u5de5\u4f5c\u4eba\u5458\uff1a"),K.a.createElement(Y["a"],{style:G.content,span:18},e&&e["person_detail"]&&e["person_detail"]["name"])),K.a.createElement(X["a"],{style:G.row,gutter:8,justify:"space-around"},K.a.createElement(Y["a"],{style:G.label,span:6},"\u7c7b\u578b\uff1a"),K.a.createElement(Y["a"],{style:G.content,span:18},e&&e["category_title"])),K.a.createElement(X["a"],{style:G.row,gutter:8,justify:"space-around"},K.a.createElement(Y["a"],{style:G.label,span:6},"\u5de5\u4f5c\u65f6\u957f\uff1a"),K.a.createElement(Y["a"],{style:G.content,span:18},e&&e["hours"])),K.a.createElement(X["a"],{style:G.row,gutter:8,justify:"space-around"},K.a.createElement(Y["a"],{style:G.label,span:6},"\u5185\u5bb9\uff1a"),K.a.createElement(Y["a"],{style:G.content,span:18},e&&e["content"])),K.a.createElement(X["a"],{style:G.row,gutter:8,justify:"space-around"},K.a.createElement(Y["a"],{style:G.label,span:6},"\u521b\u5efa\u8005\uff1a"),K.a.createElement(Y["a"],{style:G.content,span:18},e&&e["creator_detail"]&&e["creator_detail"]["name"])),K.a.createElement(X["a"],{style:G.row,gutter:8,justify:"space-around"},K.a.createElement(Y["a"],{style:G.label,span:6},"\u521b\u5efa\u65f6\u95f4\uff1a"),K.a.createElement(Y["a"],{style:G.content,span:18},e&&e["created"])),K.a.createElement(X["a"],{style:G.row,gutter:8,justify:"space-around"},K.a.createElement(Y["a"],{style:G.label,span:6},"\u6700\u540e\u4fee\u6539\u65f6\u95f4\uff1a"),K.a.createElement(Y["a"],{style:G.content,span:18},e&&e["modified"]))))):K.a.createElement("div",null)}}]),t}(K.a.PureComponent),o=r))||o),$=Q,ee=a("cZFU"),te=a("l13n"),ae=a("00B6"),ne=a("Ntaw"),oe=a("X3JL"),re=P["a"].Column,le=(l=Object(N["connect"])(function(e){return{loading:e.loading.effects["worknotes/tasks/fetch"],list:e["worknotes/tasks"].data.list,pagination:e["worknotes/tasks"].data.pagination}}),l((c=function(e){function t(){var e,a;O()(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return a=W()(this,(e=A()(t)).call.apply(e,[this].concat(o))),a.state={task:null,isTasksAdmin:!1,isWorknotesAdmin:!1,schoolsOptions:[],schoolsSelectOptions:[],ordering:"",filters:null,filterVisible:!1,filtered:!1,searchText:"",modalTitle:"",modalContent:null,modalFooter:null,submitButtonText:"",modalVisible:!1,submitting:!1},a.fetchSchools=function(){var e=a.props.dispatch;e({type:"schools/schools/fetchPublic",payload:{},callback:a.fetchSchoolsCallback})},a.fetchSchoolsCallback=function(e){a.createSchoolsOptions(e)},a.fetchCategories=function(){var e=a.props.dispatch,t=Object(z["b"])();e({type:"worknotes/categories/fetchForSelectedSchools",payload:{school:t["worknotes_app_schools"].map(function(e){return e["id"]})},callback:a.fetchCategoriesCallback})},a.fetchCategoriesCallback=function(e){console.warn("categories: ",e),a.setState({categoriesOptions:R["a"].transferObjectsToFilterOptions(e)}),a.setState({categoriesSelectOptions:R["a"].transferObjectsToSelectOptionsWithoutID(e)})},a.createSchoolsOptions=function(e){a.setState({schoolsOptions:R["a"].transferObjectsToFilterOptions(e)}),a.setState({schoolsSelectOptions:R["a"].transferObjectsToSelectOptionsWithoutID(e)})},a.fetchTasks=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.props,n=t.dispatch,o=t.pagination,r=a.state,l=r.ordering,s=r.filters,c=r.searchText;n(e?{type:"worknotes/tasks/fetch",payload:e}:{type:"worknotes/tasks/fetch",payload:x()({search:c,page:o?o.current:1,ordering:l},s)})},a.onInputChange=function(e){a.setState({searchText:e.target.value})},a.onTaskSearch=S()(C.a.mark(function e(){var t,n,o,r;return C.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=a.state,n=t.ordering,o=t.filters,r=t.searchText,a.fetchTasks(x()({search:r,page:1,ordering:n},o)),a.setState({filterVisible:!1,filtered:!!r});case 3:case"end":return e.stop()}},e)})),a.handleTableChange=function(){var e=S()(C.a.mark(function e(t,n,o){var r,l;return C.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:r=a.state.searchText,l=R["a"].transferSorterToOrdering(o),a.setState({ordering:l,filters:n}),a.fetchTasks(x()({search:r,page:t.current,ordering:l},n));case 4:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.editTask=S()(C.a.mark(function e(){var t,n,o,r,l,s,c,i,u=arguments;return C.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:null,n=a.state,o=n.schoolsSelectOptions,r=n.submitting,l=null===t?["\u521b\u5efa\u5de5\u4f5c\u4efb\u52a1","\u521b\u5efa"]:["\u7f16\u8f91\u5de5\u4f5c\u4efb\u52a1","\u7f16\u8f91"],s=g()(l,2),c=s[0],i=s[1],e.next=5,a.setState({task:null!==t?x()({},t,{person:"".concat(t["person_detail"]["name"],"(").concat(t.person,")")}):t});case 5:return e.next=7,a.setState({modalTitle:c,modalContent:K.a.createElement(Z["a"],{isMeetingsAdmin:a.state.isMeetingsAdmin,task:a.state.task,schools:o,title:c,submitButtonText:i,onSubmit:a.onSubmit,submitting:r}),submitButtonText:i,modalVisible:!0});case 7:case"end":return e.stop()}},e)})),a.deleteTask=function(){var e=S()(C.a.mark(function e(t){var n,o;return C.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=a.props.dispatch,o="".concat(t["person_detail"]["name"],"(").concat(t.person,")"),w["a"].confirm({title:"\u60a8\u786e\u8ba4\u8981\u5220\u9664 ".concat(o," \u7684 ").concat(t.title," \u4efb\u52a1\u5417?"),content:"\u5220\u9664\u540e\u5c06\u4e0d\u53ef\u6062\u590d",onOk:function(){var e=S()(C.a.mark(function e(){return C.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n({type:"worknotes/tasks/remove",payload:{task:t},callback:function(){return a.fetchTasks()}}),b["a"].success("\u6210\u529f\u5220\u9664 ".concat(o," \u7684 ").concat(t.title," \u4efb\u52a1"));case 2:case"end":return e.stop()}},e)}));function r(){return e.apply(this,arguments)}return r}(),onCancel:function(){}});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.createWorknote=function(){var e=S()(C.a.mark(function e(t){var n,o,r,l,s,c;return C.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.state,o=n.submitting,r=n.schoolsSelectOptions,l=n.categoriesSelectOptions,s="\u521b\u5efa\u5de5\u4f5c\u8bb0\u5f55",c="\u7f16\u8f91",e.next=4,a.setState({task:t,modalTitle:s,modalContent:K.a.createElement(H["a"],{isWorknotesAdmin:a.state.isWorknotesAdmin,worknote:null,schools:r,categories:l,title:s,submitButtonText:c,onSubmit:a.onWorknoteSubmit,submitting:o}),submitButtonText:c,modalVisible:!0});case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.showCall=function(e){a.setState({modalTitle:"",modalContent:K.a.createElement(ee["a"],{callId:e}),modalFooter:[K.a.createElement(k["a"],{key:"ok",size:"default",onClick:a.handleCancel},"\u786e\u5b9a")],submitButtonText:"",modalVisible:!0})},a.showMeeting=function(e){a.setState({modalTitle:"",modalContent:K.a.createElement(te["a"],{meetingId:e}),modalFooter:[K.a.createElement(k["a"],{key:"ok",size:"default",onClick:a.handleCancel},"\u786e\u5b9a")],submitButtonText:"",modalVisible:!0})},a.showWorknote=function(e){a.setState({modalTitle:"",modalContent:K.a.createElement($,{worknoteId:e}),modalFooter:[K.a.createElement(k["a"],{key:"ok",size:"default",onClick:a.handleCancel},"\u786e\u5b9a")],submitButtonText:"",modalVisible:!0})},a.handleCancel=S()(C.a.mark(function e(){return C.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({modalVisible:!1,modalContent:null,modalFooter:null});case 2:case"end":return e.stop()}},e)})),a.onSubmit=function(e){var t=a.props.dispatch,n=a.state.task,o=/\((\w{4,11})\)/.exec(e["person"]),r=x()({},e,{person:o[1],start_datetime:e["start_datetime"]||null,end_datetime:e["end_datetime"]||null});try{a.setState({submitting:!0}),n&&n["id"]?t({type:"worknotes/tasks/update",payload:{task:r},callback:function(){return a.onSubmitCallback("\u4efb\u52a1\u4fee\u6539\u6210\u529f")}}):t({type:"worknotes/tasks/add",payload:{task:r},callback:function(){return a.onSubmitCallback("\u4efb\u52a1\u521b\u5efa\u6210\u529f")}})}catch(e){console.log(e)}finally{a.setState({submitting:!1})}a.setState({modalVisible:!1,modalContent:null,modalFooter:null})},a.onWorknoteSubmit=function(e){var t=a.props.dispatch,n=a.state.task,o=/\((\w{4,11})\)/.exec(e["person"]),r=x()({},e,{person:o[1],task:n.id});t({type:"worknotes/worknotes/add",payload:{worknote:r},callback:function(){return a.fetchTasks()}}),a.setState({modalVisible:!1,modalContent:null,modalFooter:null})},a}return M()(t,e),j()(t,[{key:"componentDidMount",value:function(){var e=Object(z["b"])(),t=Object(z["c"])();if(this.fetchTasks(),this.fetchCategories(),Object(z["f"])())this.fetchSchools();else if(t.includes("worknoteUser")){var a=e["tasks_admin_schools"],n=!0,o=!1,r=void 0;try{for(var l,s=function(){var e=l.value;a.findIndex(function(t){return t.id===e.id})<0&&a.push(e)},c=e["worknotes_app_schools"][Symbol.iterator]();!(n=(l=c.next()).done);n=!0)s()}catch(e){o=!0,r=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw r}}this.createSchoolsOptions(a)}this.setState({isTasksAdmin:e["tasks_admin_schools"]&&e["tasks_admin_schools"].length>0||Object(z["f"])(),isWorknotesAdmin:e["worknotes_admin_schools"]&&e["worknotes_admin_schools"].length>0||Object(z["f"])()})}},{key:"onSubmitCallback",value:function(e){b["a"].success(e),this.fetchTasks()}},{key:"render",value:function(){var e=this,t=this.props,a=t.list,n=t.pagination,o=t.loading,r=this.state,l=r.filtered,s=r.filterVisible,c=r.modalTitle,b=r.modalContent,y=r.modalFooter,g=r.modalVisible;return K.a.createElement(q["a"],{title:"\u5de5\u4f5c\u4efb\u52a1\u5217\u8868"},K.a.createElement(i["a"],{bordered:!1},n&&K.a.createElement(L["a"],null,n.total),K.a.createElement(w["a"],{title:c,visible:g,onCancel:this.handleCancel,footer:y},b||K.a.createElement(f["a"],{spinning:o})),K.a.createElement(k["a"],{type:"primary",onClick:function(){return e.editTask()}},"\u65b0\u5efa\u5de5\u4f5c\u4efb\u52a1"),K.a.createElement(oe["a"],null),K.a.createElement(P["a"],{dataSource:a,loading:o,rowKey:"id",width:1400,scroll:{x:1400},expandedRowRender:function(e){return K.a.createElement("div",null,K.a.createElement("p",null,"\u5de5\u4f5c\u5185\u5bb9\uff1a",e.content))},onChange:this.handleTableChange,pagination:n},K.a.createElement(re,{title:"\u5de5\u4f5c\u4eba\u5458",key:"person",render:function(e){return e["person_detail"]&&e["person_detail"]["name"]},filterDropdown:K.a.createElement("div",{className:"table-input-search"},K.a.createElement(h["a"],{placeholder:"\u59d3\u540d\u6216\u5b66\u5de5\u53f7",value:this.state.searchText,onChange:this.onInputChange,onPressEnter:this.onTaskSearch}),K.a.createElement(k["a"],{type:"primary",onClick:this.onTaskSearch},"\u68c0\u7d22")),filterIcon:K.a.createElement(p["a"],{type:"search",style:{color:l?"#108ee9":"#aaa"}}),filterDropdownVisible:s,onFilterDropdownVisibleChange:function(t){e.setState({filterVisible:t})}}),K.a.createElement(re,{title:"\u6307\u6d3e\u4eba",key:"creator",render:function(e){return e["creator_detail"]&&e["creator_detail"]["name"]}}),K.a.createElement(re,{title:"\u7c7b\u522b",dataIndex:"category",render:function(e,t){return t["category_title"]||"\u65e0"}}),K.a.createElement(re,{title:"\u4f18\u5148\u7ea7",dataIndex:"priority",sorter:!0,filters:J["m"].map(function(e){return{text:e.label,value:e.value}}),render:function(e,t){return t["get_priority_display"]}}),K.a.createElement(re,{title:"\u5f00\u59cb\u65f6\u95f4",sorter:!0,dataIndex:"start_datetime"}),K.a.createElement(re,{title:"\u7ed3\u675f\u65f6\u95f4",sorter:!0,dataIndex:"end_datetime"}),K.a.createElement(re,{title:"\u76f8\u5173\u5de5\u4f5c\u8bb0\u5f55",render:function(t){return t.worknote?K.a.createElement("a",{onClick:function(){return e.showWorknote(t.worknote)}},ae["a"].assembleIcon("FaExternalLink",13,ne["blue500"])," \u67e5\u770b"):K.a.createElement(m["a"],{status:"default",text:"\u672a\u521b\u5efa"})}}),K.a.createElement(re,{title:"\u76f8\u5173\u4f1a\u8bae",render:function(t){return t.meeting?K.a.createElement("a",{onClick:function(){return e.showMeeting(t.meeting)}},ae["a"].assembleIcon("FaExternalLink",13,ne["blue500"])," \u67e5\u770b"):K.a.createElement(m["a"],{status:"default",text:"\u65e0"})}}),K.a.createElement(re,{title:"\u64cd\u4f5c",fixed:"right",width:136,render:function(t,a){return K.a.createElement("div",null,K.a.createElement("a",{onClick:function(){return e.editTask(a)}},"\u7f16\u8f91"),K.a.createElement("span",{className:"ant-divider"}),K.a.createElement(u["a"],{overlay:K.a.createElement(d["a"],null,K.a.createElement(d["a"].Item,null,K.a.createElement("a",{onClick:function(){return e.deleteTask(a)}},"\u5220\u9664")),K.a.createElement(d["a"].Item,null,a.worknote?K.a.createElement("a",{onClick:function(){return e.showWorknote(a.worknote)}},"\u67e5\u770b\u5de5\u4f5c\u8bb0\u5f55"):K.a.createElement("a",{onClick:function(){return e.createWorknote(a)}},"\u521b\u5efa\u5de5\u4f5c\u8bb0\u5f55")),a.call&&K.a.createElement(d["a"].Item,null,K.a.createElement("a",{onClick:function(){return e.showCall(a.call)}},"\u67e5\u770b\u901a\u8baf\u8bb0\u5f55")),a.meeting&&K.a.createElement(d["a"].Item,null,K.a.createElement("a",{onClick:function(){return e.showMeeting(a.meeting)}},"\u67e5\u770b\u76f8\u5173\u4f1a\u8bae")))},K.a.createElement("a",{className:"ant-dropdown-link"},"\u66f4\u591a ",K.a.createElement(p["a"],{type:"down"}))))}}))))}}]),t}(D["PureComponent"]),s=c))||s);t["default"]=le}}]);