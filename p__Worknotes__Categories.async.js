(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[114],{"5h/u":function(e,t,a){"use strict";a.r(t);a("IzEo");var n=a("bx4M"),o=(a("qVdP"),a("jsC+")),r=(a("Pwec"),a("CtXQ")),l=(a("lUTK"),a("BvKs")),i=(a("+L6B"),a("2/Rp")),c=(a("T2oS"),a("W9HT")),s=(a("miYZ"),a("tsqr")),u=(a("2qtc"),a("kLXV")),p=a("qIgq"),d=a.n(p),h=a("d6i3"),m=a.n(h),f=a("1l/V"),g=a.n(f),y=a("p0pE"),b=a.n(y),w=a("2Taf"),v=a.n(w),C=a("vZ4D"),k=a.n(C),E=a("l4Ni"),S=a.n(E),x=a("ujKo"),T=a.n(x),O=a("MhPg"),V=a.n(O),j=(a("g9YV"),a("wCAj")),B=a("q1tI"),I=a.n(B),q=a("MuoO"),z=a("34ay"),N=a("zHco"),P=(a("3eRE"),a("y8nQ"),a("Vl3Y")),F=a("d/v1"),K=a("pJVQ"),M=a("p9nB"),_=a("WAby"),A=function(e){},D=function(e){function t(){var e,a;v()(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return a=S()(this,(e=T()(t)).call.apply(e,[this].concat(o))),a.state={people:[],categories:[],person:null,selectedPeople:[],loading:!1},a}return V()(t,e),k()(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.category,a=e.schools,n=e.handleSubmit,o=e.submitButtonText,r=e.submitting;return I.a.createElement("div",null,I.a.createElement(P["a"],{onSubmit:n,layout:"horizontal",className:"modal-form"},I.a.createElement(F["a"],{name:"school",label:"\u90e8\u95e8\uff08\u5b66\u9662\uff09",size:"default",labelCol:{span:6},wrapperCol:{span:18},options:a,disabled:null!==t,component:M["d"]}),I.a.createElement(F["a"],{name:"title",type:"text",size:"default",placeholder:"\u540d\u79f0",label:"\u540d\u79f0",required:!0,hasFeedback:!0,validate:[_["g"]],labelCol:{span:6},wrapperCol:{span:18},component:M["g"]}),I.a.createElement(F["a"],{type:"text",name:"description",size:"default",placeholder:"\u63cf\u8ff0",label:"\u63cf\u8ff0",required:!0,hasFeedback:!0,validate:[_["g"]],labelCol:{span:6},wrapperCol:{span:18},component:M["f"]}),I.a.createElement(i["a"],{type:"primary",htmlType:"submit",disabled:r,className:"modal-form-button"},o)))}}]),t}(I.a.Component),J=Object(K["a"])({form:"categoryForm",validate:A})(D);function L(e,t){var a=t.category;return{initialValues:a,category:t.category,submitButtonText:t.submitButtonText||"\u63d0\u4ea4"}}var Q,W,X,Y=Object(q["connect"])(L)(J),H=a("FkSf"),R=a("6NK7"),U=a("X3JL"),Z=j["a"].Column,G=(Q=Object(q["connect"])(function(e){return{loading:e.loading.effects["worknotes/categories/fetch"],list:e["worknotes/categories"].data.list,pagination:e["worknotes/categories"].data.pagination}}),Q((X=function(e){function t(){var e,a;v()(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return a=S()(this,(e=T()(t)).call.apply(e,[this].concat(o))),a.state={category:null,schoolsOptions:[],schoolsSelectOptions:[],ordering:"",filters:null,filterVisible:!1,filtered:!1,searchText:"",modalTitle:"",submitButtonText:"",modalVisible:!1,modalContent:null,submitting:!1},a.fetchSchools=function(){var e=a.props.dispatch;e({type:"schools/schools/fetchPublic",payload:{},callback:a.fetchSchoolsCallback})},a.fetchSchoolsCallback=function(e){a.createSchoolsOptions(e)},a.createSchoolsOptions=function(e){a.setState({schoolsOptions:R["a"].transferObjectsToFilterOptions(e)}),a.setState({schoolsSelectOptions:R["a"].transferObjectsToSelectOptionsWithoutID(e)})},a.fetchCategories=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.props,n=t.dispatch,o=t.pagination,r=a.state,l=r.ordering,i=r.filters,c=r.searchText;n(e?{type:"worknotes/categories/fetch",payload:e}:{type:"worknotes/categories/fetch",payload:b()({search:c,page:o?o.current:1,ordering:l},i)})},a.onInputChange=function(e){a.setState({searchText:e.target.value})},a.onCategorySearch=g()(m.a.mark(function e(){var t,n,o,r;return m.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=a.state,n=t.ordering,o=t.filters,r=t.searchText,a.fetchCategories(b()({search:r,page:1,ordering:n},o)),a.setState({filterVisible:!1,filtered:!!r});case 3:case"end":return e.stop()}},e)})),a.handleTableChange=function(){var e=g()(m.a.mark(function e(t,n,o){var r,l;return m.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:r=a.state.searchText,l=R["a"].transferSorterToOrdering(o),a.setState({ordering:l,filters:n}),a.fetchCategories(b()({search:r,page:t.current,ordering:l},n));case 4:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.editCategory=g()(m.a.mark(function e(){var t,n,o,r,l,i,c,s,u=arguments;return m.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:null,n=a.state,o=n.schoolsSelectOptions,r=n.submitting,l=null===t?["\u521b\u5efa\u5de5\u4f5c\u7c7b\u522b","\u521b\u5efa"]:["\u7f16\u8f91\u5de5\u4f5c\u7c7b\u522b","\u7f16\u8f91"],i=d()(l,2),c=i[0],s=i[1],e.next=5,a.setState({category:t});case 5:return e.next=7,a.setState({modalTitle:c,submitButtonText:s,modalVisible:!0,modalContent:I.a.createElement(Y,{category:t,schools:o,title:c,submitButtonText:s,onSubmit:a.onSubmit,submitting:r})});case 7:case"end":return e.stop()}},e)})),a.deleteCategory=function(){var e=g()(m.a.mark(function e(t){return m.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:u["a"].confirm({title:"\u60a8\u786e\u8ba4\u8981\u5220\u9664 ".concat(t.title," \u7c7b\u522b\u5417?"),content:"\u5220\u9664\u540e\u5c06\u4e0d\u53ef\u6062\u590d",onOk:function(){var e=g()(m.a.mark(function e(){return m.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a.props.dispatch({type:"worknotes/categories/remove",payload:{category:t},callback:function(){return a.fetchCategories()}}),s["a"].success('\u6210\u529f\u5220\u9664 "'.concat(t.title,'" \u5de5\u4f5c\u7c7b\u522b'));case 2:case"end":return e.stop()}},e)}));function n(){return e.apply(this,arguments)}return n}(),onCancel:function(){}});case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.handleCancel=g()(m.a.mark(function e(){return m.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({modalVisible:!1,modalContent:null,category:null});case 2:case"end":return e.stop()}},e)})),a.onSubmit=function(e){var t=a.props.dispatch,n=a.state.category;try{a.setState({submitting:!0}),n&&n["id"]?t({type:"worknotes/categories/update",payload:{category:e},callback:function(){return a.fetchCategories()}}):t({type:"worknotes/categories/add",payload:{category:e},callback:function(){return a.fetchCategories()}})}catch(e){console.log(e)}finally{a.setState({submitting:!1})}a.setState({modalVisible:!1,modalContent:null})},a}return V()(t,e),k()(t,[{key:"componentDidMount",value:function(){var e=Object(z["b"])(),t=Object(z["c"])();this.fetchCategories(),Object(z["f"])()?this.fetchSchools():t.includes("worknoteUser")&&this.createSchoolsOptions(e["worknotes_app_schools"])}},{key:"render",value:function(){var e=this,t=this.props,a=t.list,s=t.pagination,p=t.loading,d=this.state,h=d.schoolsOptions,m=d.modalTitle,f=d.modalVisible,g=d.modalContent;return I.a.createElement(N["a"],{title:"\u5de5\u4f5c\u7c7b\u522b\u5217\u8868"},I.a.createElement(n["a"],{bordered:!1},s&&I.a.createElement(H["a"],null,s.total),I.a.createElement(u["a"],{title:m,visible:f,onCancel:this.handleCancel,footer:null},g||I.a.createElement(c["a"],{spinning:p})),I.a.createElement(i["a"],{type:"primary",onClick:function(){return e.editCategory()}},"\u65b0\u5efa\u5de5\u4f5c\u7c7b\u522b"),I.a.createElement(U["a"],null),I.a.createElement(j["a"],{dataSource:a,loading:p,rowKey:"id",onChange:this.handleTableChange,pagination:s},I.a.createElement(Z,{title:"\u90e8\u95e8\u5e8f\u53f7",dataIndex:"school",key:"school_id",sorter:!0,width:120}),I.a.createElement(Z,{title:"\u90e8\u95e8",key:"school",render:function(e){return e["school_detail"]&&e["school_detail"]["name"]},filters:h,width:140}),I.a.createElement(Z,{title:"\u540d\u79f0",dataIndex:"title",key:"title"}),I.a.createElement(Z,{title:"\u63cf\u8ff0",dataIndex:"description",key:"description"}),I.a.createElement(Z,{title:"\u64cd\u4f5c",width:128,render:function(t,a){return I.a.createElement("div",null,I.a.createElement("a",{onClick:function(){return e.editCategory(a)}},"\u7f16\u8f91"),I.a.createElement("span",{className:"ant-divider"}),I.a.createElement(o["a"],{overlay:I.a.createElement(l["a"],null,I.a.createElement(l["a"].Item,null,I.a.createElement("a",{onClick:function(){return e.deleteCategory(a)}},"\u5220\u9664")))},I.a.createElement("a",{className:"ant-dropdown-link"},"\u66f4\u591a ",I.a.createElement(r["a"],{type:"down"}))))}}))))}}]),t}(B["PureComponent"]),W=X))||W);t["default"]=G}}]);