(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[115],{L1tf:function(e,t,n){"use strict";n.r(t);n("IzEo");var a=n("bx4M"),r=(n("qVdP"),n("jsC+")),o=(n("lUTK"),n("BvKs")),l=(n("Awhp"),n("KrTs")),i=(n("Pwec"),n("CtXQ")),s=(n("5NDa"),n("5rEg")),c=(n("+L6B"),n("2/Rp")),p=(n("T2oS"),n("W9HT")),u=n("gWZ8"),d=n.n(u),m=(n("miYZ"),n("tsqr")),h=(n("2qtc"),n("kLXV")),f=n("qIgq"),g=n.n(f),b=n("d6i3"),w=n.n(b),y=n("1l/V"),v=n.n(y),S=n("p0pE"),k=n.n(S),E=n("2Taf"),C=n.n(E),x=n("vZ4D"),O=n.n(x),T=n("l4Ni"),M=n.n(T),_=n("ujKo"),P=n.n(_),V=n("MhPg"),j=n.n(V),D=(n("g9YV"),n("wCAj")),F=n("q1tI"),I=n.n(F),z=n("MuoO"),A=n("34ay"),Y=n("zHco"),q=n("3eRE"),B=(n("y8nQ"),n("Vl3Y")),N=n("d/v1"),K=n("pJVQ"),R=n("p9nB"),H=n("WAby"),W=n("6NK7"),J=n("Tt/K"),L=function(e){},Q=function(e){function t(){var e,n;C()(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return n=M()(this,(e=P()(t)).call.apply(e,[this].concat(r))),n.state={recorderOptions:[],personSchools:[],peopleOptions:[],selectedPeople:[],categories:[],loading:!1},n.searchPeople=function(e){var t=n.props,a=t.dispatch,r=t.isMeetingsAdmin,o=n.state.personSchools;n.setState({loading:!0}),a({type:"people/people/search",payload:{person:r?e:Object(A["b"])()["id"],school:o},callback:n.searchPeopleCallback})},n.searchRecorder=function(e,t){n.searchPeople(t)},n.searchPeopleCallback=function(e){var t=W["a"].transferObjectsToSelectOptions(e),a=W["a"].transferPeopleToOptionsWithName(e);n.state.selectedPeople.forEach(function(e){return t.findIndex(function(t){return t.id===e.id})<0&&t.push(e)}),n.setState({peopleOptions:t,recorderOptions:a,loading:!1})},n.handleSelect=function(){var e=v()(w.a.mark(function e(t){return w.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.setState({selectedPeople:n.state.selectedPeople.concat(n.state.peopleOptions.filter(function(e){return e.id===t}))});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.handleDeselect=function(){var e=v()(w.a.mark(function e(t){return w.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.setState({selectedPeople:n.state.selectedPeople.filter(function(e){return e.id!==t})});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.handleSchoolSelect=function(e){var t=n.props.dispatch;t({type:"worknotes/categories/fetchForSelectedSchools",payload:{school:e},callback:n.handleSchoolSelectCallback}),n.setState({loading:!0})},n.handleSchoolSelectCallback=function(e){console.log("selected categories in select school callback: ",e);var t=e.map(function(e){return{key:e.id,value:e.id,label:e.title}});n.setState({categories:t}),n.setState({loading:!1})},n}return j()(t,e),O()(t,[{key:"componentDidMount",value:function(){var e=this.props.meeting,t=Object(A["b"])();if(e){this.handleSchoolSelect(e.school);var n=W["a"].transferObjectsToSelectOptions(e["attendees_detail"]);this.setState({peopleOptions:n,selectedPeople:n})}var a=[].concat(d()(t["worknotes_app_schools"]),d()(t["meetings_admin_schools"]));this.setState({personSchools:a.map(function(e){return e.id})})}},{key:"render",value:function(){var e=this.props,t=e.meeting,n=e.schools,a=e.handleSubmit,r=e.submitButtonText,o=e.submitting,l=this.state,i=l.recorderOptions,s=l.peopleOptions,u=l.categories,d=l.loading;return I.a.createElement("div",null,I.a.createElement(B["a"],{onSubmit:a,layout:"horizontal",className:"modal-form"},I.a.createElement(N["a"],{name:"school",label:"\u90e8\u95e8",size:"default",labelCol:{span:6},wrapperCol:{span:18},options:n,disabled:null!==t,onSelect:this.handleSchoolSelect,component:R["d"]}),I.a.createElement(N["a"],{name:"recorder",label:"\u8bb0\u5f55\u5458",size:"default",mode:"combobox",labelCol:{span:6},wrapperCol:{span:18},options:i,disabled:null!==t,defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onFocus:this.searchRecorder,onChange:this.searchRecorder,required:!0,hasFeedback:!0,validate:[H["g"],H["d"]],notFoundContent:d?I.a.createElement(p["a"],{size:"small"}):null,component:R["d"]}),I.a.createElement(N["a"],{name:"title",type:"text",size:"default",placeholder:"\u4f1a\u8bae\u4e3b\u9898\u3001\u540d\u79f0",label:"\u540d\u79f0",required:!0,hasFeedback:!0,validate:[H["g"]],labelCol:{span:6},wrapperCol:{span:18},component:R["g"]}),I.a.createElement(N["a"],{name:"content",type:"text",size:"default",placeholder:"\u4f1a\u8bae\u4e3b\u8981\u5185\u5bb9",label:"\u4e3b\u8981\u5185\u5bb9",required:!0,hasFeedback:!0,validate:[H["g"]],labelCol:{span:6},wrapperCol:{span:18},component:R["f"]}),I.a.createElement(N["a"],{name:"attendees",label:"\u4e0e\u4f1a\u4eba\u5458",size:"default",labelCol:{span:6},wrapperCol:{span:18},options:s,defaultValue:[],mode:"multiple",filterOption:!1,onFocus:this.searchPeople,onSearch:this.searchPeople,onSelect:this.handleSelect,onDeselect:this.handleDeselect,notFoundContent:d?I.a.createElement(p["a"],{size:"small"}):null,component:R["d"]}),I.a.createElement(N["a"],{name:"category",type:"text",size:"default",placeholder:"\u7c7b\u522b",label:"\u7c7b\u522b",labelCol:{span:6},wrapperCol:{span:18},options:u,component:R["d"]}),I.a.createElement(N["a"],{name:"start_datetime",type:"text",size:"default",placeholder:"\u5f00\u59cb\u65f6\u95f4",label:"\u5f00\u59cb\u65f6\u95f4",required:!0,hasFeedback:!0,validate:[H["g"]],labelCol:{span:6},wrapperCol:{span:9,offset:0},component:R["a"],dateTimeFormat:"YYYY-MM-DD HH:mm:ss",showTime:!0}),I.a.createElement(N["a"],{name:"end_datetime",type:"text",size:"default",placeholder:"\u7ed3\u675f\u65f6\u95f4",label:"\u7ed3\u675f\u65f6\u95f4",labelCol:{span:6},wrapperCol:{span:9,offset:0},component:R["a"],dateTimeFormat:"YYYY-MM-DD HH:mm:ss",showTime:!0}),I.a.createElement(N["a"],{name:"priority",type:"text",size:"default",placeholder:"\u4f18\u5148\u7ea7",label:"\u4f18\u5148\u7ea7",labelCol:{span:6},wrapperCol:{span:18},options:J["m"],component:R["d"]}),I.a.createElement(c["a"],{type:"primary",htmlType:"submit",disabled:o,className:"modal-form-button"},r)))}}]),t}(I.a.Component),Z=Object(K["a"])({form:"meetingForm",validate:L})(Q);function U(e,t){var n=t.meeting;return{initialValues:n,meeting:t.meeting,submitButtonText:t.submitButtonText||"\u63d0\u4ea4"}}var X,G,$,ee=Object(z["connect"])(U)(Z),te=n("FkSf"),ne=D["a"].Column,ae=function(e){var t=e.meeting,n=[];return t["attendees_detail"].forEach(function(e){return n.push(I.a.createElement("span",{key:e.id},e.name,"(",e.id,") \xa0\xa0"))}),I.a.createElement("div",null,I.a.createElement("p",null,"\u4e0e\u4f1a\u4eba\u5458\uff08\u5171 ",t["attendees"].length," \u4eba\uff09\uff1a"),I.a.createElement("p",null,n),I.a.createElement("br",null),I.a.createElement("p",null,"\u4f1a\u8bae\u5185\u5bb9\uff1a",t.content))},re=(X=Object(z["connect"])(function(e){return{loading:e.loading.effects["worknotes/meetings/fetch"],list:e["worknotes/meetings"].data.list,pagination:e["worknotes/meetings"].data.pagination}}),X(($=function(e){function t(){var e,n;C()(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return n=M()(this,(e=P()(t)).call.apply(e,[this].concat(r))),n.state={meeting:null,isMeetingsAdmin:!1,schoolsOptions:[],schoolsSelectOptions:[],ordering:"",filters:null,filterVisible:!1,filtered:!1,searchText:"",modalTitle:"",modalContent:null,submitButtonText:"",modalVisible:!1,submitting:!1},n.fetchSchools=function(){var e=n.props.dispatch;e({type:"schools/schools/fetchPublic",payload:{},callback:n.fetchSchoolsCallback})},n.fetchSchoolsCallback=function(e){n.createSchoolsOptions(e)},n.createSchoolsOptions=function(e){n.setState({schoolsOptions:W["a"].transferObjectsToFilterOptions(e)}),n.setState({schoolsSelectOptions:W["a"].transferObjectsToSelectOptionsWithoutID(e)})},n.fetchMeetings=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=n.props,a=t.dispatch,r=t.pagination,o=n.state,l=o.ordering,i=o.filters,s=o.searchText;a(e?{type:"worknotes/meetings/fetch",payload:e}:{type:"worknotes/meetings/fetch",payload:k()({search:s,page:r?r.current:1,ordering:l},i)})},n.onInputChange=function(e){n.setState({searchText:e.target.value})},n.onMeetingSearch=v()(w.a.mark(function e(){var t,a,r,o;return w.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=n.state,a=t.ordering,r=t.filters,o=t.searchText,n.fetchMeetings(k()({search:o,page:1,ordering:a},r)),n.setState({filterVisible:!1,filtered:!!o});case 3:case"end":return e.stop()}},e)})),n.handleTableChange=function(){var e=v()(w.a.mark(function e(t,a,r){var o,l;return w.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:o=n.state.searchText,l=W["a"].transferSorterToOrdering(r),n.setState({ordering:l,filters:a}),n.fetchMeetings(k()({search:o,page:t.current,ordering:l},a));case 4:case"end":return e.stop()}},e)}));return function(t,n,a){return e.apply(this,arguments)}}(),n.editMeeting=v()(w.a.mark(function e(){var t,a,r,o,l,i,s,c,p=arguments;return w.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:null,a=n.state,r=a.schoolsSelectOptions,o=a.submitting,l=null===t?["\u521b\u5efa\u4f1a\u8bae","\u521b\u5efa"]:["\u7f16\u8f91\u4f1a\u8bae","\u7f16\u8f91"],i=g()(l,2),s=i[0],c=i[1],e.next=5,n.setState({meeting:null!==t?k()({},t,{recorder:"".concat(t["recorder_detail"]["name"],"(").concat(t.recorder,")")}):t});case 5:return e.next=7,n.setState({modalTitle:s,submitButtonText:c,modalVisible:!0,modalContent:I.a.createElement(ee,{isMeetingsAdmin:n.state.isMeetingsAdmin,meeting:n.state.meeting,schools:r,title:s,submitButtonText:c,onSubmit:n.onSubmit,submitting:o})});case 7:case"end":return e.stop()}},e)})),n.deleteMeeting=function(){var e=v()(w.a.mark(function e(t){var a;return w.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a=n.props.dispatch,h["a"].confirm({title:"\u60a8\u786e\u8ba4\u8981\u5220\u9664 ".concat(t.title," \u5417?"),content:"\u5220\u9664\u540e\u5c06\u4e0d\u53ef\u6062\u590d",onOk:function(){var e=v()(w.a.mark(function e(){return w.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a({type:"worknotes/meetings/remove",payload:{meeting:t},callback:function(){return n.fetchMeetings()}}),m["a"].success("\u6210\u529f\u5220\u9664 ".concat(t.title));case 2:case"end":return e.stop()}},e)}));function r(){return e.apply(this,arguments)}return r}(),onCancel:function(){}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.finishMeeting=function(){var e=v()(w.a.mark(function e(t){var a;return w.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a=n.props.dispatch,h["a"].confirm({title:"\u60a8\u786e\u8ba4\u8981\u8bbe\u7f6e ".concat(t.title," \u4e3a\u7ed3\u675f\u5417?"),content:"\u5b8c\u6210\u4f1a\u8bae\u540e\u5c06\u65e0\u6cd5\u518d\u4fee\u6539\u4f1a\u8bae\u5185\u5bb9",onOk:function(){var e=v()(w.a.mark(function e(){return w.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:a({type:"worknotes/meetings/finish",payload:{meeting:t},callback:function(){return n.fetchMeetings()}}),m["a"].success("".concat(t.title," \u5df2\u6210\u529f\u8bbe\u7f6e\u4e3a\u7ed3\u675f\u72b6\u6001"));case 2:case"end":return e.stop()}},e)}));function r(){return e.apply(this,arguments)}return r}(),onCancel:function(){}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.handleCancel=v()(w.a.mark(function e(){return w.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.setState({modalVisible:!1,modalContent:null,meeting:null});case 2:case"end":return e.stop()}},e)})),n.onSubmit=function(e){var t=n.props.dispatch,a=n.state.meeting,r=/\((\w{4,11})\)/.exec(e["recorder"]),o=e["attendees"]?[].concat(d()(e["attendees"]),[r[1]]):[r[1]],l=k()({},e,{recorder:r[1],attendees:Array.from(new Set(o)),start_datetime:e["start_datetime"]||null,end_datetime:e["end_datetime"]||null});try{n.setState({submitting:!0}),a&&a["id"]?t({type:"worknotes/meetings/update",payload:{meeting:l},callback:function(){return n.onSubmitCallback("\u4f1a\u8bae\u4fee\u6539\u6210\u529f")}}):t({type:"worknotes/meetings/add",payload:{meeting:l},callback:function(){return n.onSubmitCallback("\u4f1a\u8bae\u521b\u5efa\u6210\u529f")}})}catch(e){console.log(e)}finally{n.setState({submitting:!1})}n.setState({modalVisible:!1,modalContent:null})},n}return j()(t,e),O()(t,[{key:"componentDidMount",value:function(){var e=Object(A["b"])(),t=Object(A["c"])();this.fetchMeetings(),Object(A["f"])()?this.fetchSchools():t.includes("worknoteUser")&&this.createSchoolsOptions(e["worknotes_app_schools"]),this.setState({isMeetingsAdmin:e["meetings_admin_schools"]&&e["meetings_admin_schools"].length>0||Object(A["f"])()})}},{key:"onSubmitCallback",value:function(e){m["a"].success(e),this.fetchMeetings()}},{key:"render",value:function(){var e=this,t=this.props,n=t.list,u=t.pagination,d=t.loading,m=this.state,f=m.isMeetingsAdmin,g=m.filtered,b=m.filterVisible,w=m.modalTitle,y=m.modalContent,v=m.modalVisible;return I.a.createElement(Y["a"],{title:"\u4f1a\u8bae\u5217\u8868"},I.a.createElement(a["a"],{bordered:!1},u&&I.a.createElement(te["a"],null,u.total),I.a.createElement(h["a"],{title:w,visible:v,onCancel:this.handleCancel,footer:null},y||I.a.createElement(p["a"],{spinning:d})),f&&I.a.createElement(c["a"],{type:"primary",onClick:function(){return e.editMeeting()}},"\u65b0\u5efa\u4f1a\u8bae"),I.a.createElement(D["a"],{dataSource:n,loading:d,rowKey:"id",width:1400,scroll:{x:1400},expandedRowRender:function(e){return I.a.createElement(ae,{meeting:e})},onChange:this.handleTableChange,pagination:u},I.a.createElement(ne,{title:"\u6807\u9898",key:"title",render:function(e,t){return t["title"]||"\u65e0"}}),I.a.createElement(ne,{title:"\u7c7b\u578b",key:"category",render:function(e,t){return t["category_title"]||"\u65e0"}}),I.a.createElement(ne,{title:"\u5f00\u59cb\u65f6\u95f4",sorter:!0,dataIndex:"start_datetime"}),I.a.createElement(ne,{title:"\u7ed3\u675f\u65f6\u95f4",sorter:!0,dataIndex:"end_datetime"}),I.a.createElement(ne,{title:"\u4f18\u5148\u7ea7",dataIndex:"priority",key:"priority",sorter:!0,filters:J["m"].map(function(e){return{text:e.label,value:e.value}}),render:function(e,t){return t["get_priority_display"]}}),I.a.createElement(ne,{title:"\u8bb0\u5f55\u4eba",key:"recorder",render:function(e){return e["recorder_detail"]&&e["recorder_detail"]["name"]},filterDropdown:I.a.createElement("div",{className:"table-input-search"},I.a.createElement(s["a"],{placeholder:"\u59d3\u540d/\u5b66\u5de5\u53f7",value:this.state.searchText,onChange:this.onInputChange,onPressEnter:this.onMeetingSearch}),I.a.createElement(c["a"],{type:"primary",onClick:this.onMeetingSearch},"\u68c0\u7d22")),filterIcon:I.a.createElement(i["a"],{type:"search",style:{color:g?"#108ee9":"#aaa"}}),filterDropdownVisible:b,onFilterDropdownVisibleChange:function(t){e.setState({filterVisible:t})}}),I.a.createElement(ne,{title:"\u72b6\u6001",dataIndex:"finished",render:function(e,t){return t.finished?I.a.createElement(l["a"],{status:"success",text:"\u7ed3\u675f"}):q["a"].nowIsBetweenDatetimes(t["start_datetime"],t["end_datetime"])?I.a.createElement(l["a"],{status:"processing",text:"\u8fdb\u884c\u4e2d"}):I.a.createElement(l["a"],{status:"default",text:"\u672a\u77e5"})}}),f&&I.a.createElement(ne,{title:"\u64cd\u4f5c",fixed:"right",width:136,render:function(t,n){return I.a.createElement("div",null,n["finished"]?I.a.createElement("span",null,"\u7f16\u8f91"):I.a.createElement("a",{onClick:function(){return e.editMeeting(n)}},"\u7f16\u8f91"),I.a.createElement("span",{className:"ant-divider"}),I.a.createElement(r["a"],{overlay:I.a.createElement(o["a"],null,I.a.createElement(o["a"].Item,null,I.a.createElement("a",{onClick:function(){return e.deleteMeeting(n)}},"\u5220\u9664")),!n.finished&&I.a.createElement(o["a"].Item,null,I.a.createElement("a",{onClick:function(){return e.finishMeeting(n)}},"\u7ed3\u675f\u4f1a\u8bae")))},I.a.createElement("a",{className:"ant-dropdown-link"},"\u66f4\u591a ",I.a.createElement(i["a"],{type:"down"}))))}}))))}}]),t}(F["PureComponent"]),G=$))||G);t["default"]=re}}]);