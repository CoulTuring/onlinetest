(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[71],{VAbD:function(e,t,a){"use strict";a.r(t);a("IzEo");var n=a("bx4M"),o=(a("qVdP"),a("jsC+")),s=(a("P2fV"),a("NJEC")),l=(a("lUTK"),a("BvKs")),r=(a("Awhp"),a("KrTs")),i=(a("Pwec"),a("CtXQ")),c=(a("5NDa"),a("5rEg")),u=(a("+L6B"),a("2/Rp")),p=(a("2qtc"),a("kLXV")),d=(a("T2oS"),a("W9HT")),m=(a("miYZ"),a("tsqr")),h=a("qIgq"),f=a.n(h),b=a("d6i3"),g=a.n(b),y=a("1l/V"),C=a.n(y),v=a("p0pE"),w=a.n(v),E=a("2Taf"),q=a.n(E),k=a("vZ4D"),x=a.n(k),O=a("l4Ni"),M=a.n(O),S=a("ujKo"),j=a.n(S),T=a("MhPg"),Q=a.n(T),V=(a("g9YV"),a("wCAj")),I=a("q1tI"),F=a.n(I),P=a("MuoO"),B=a("LLXN"),z=a("zHco"),N=a("FkSf"),D=(a("y8nQ"),a("Vl3Y")),A=a("d/v1"),K=a("pJVQ"),L=a("p9nB"),J=a("WAby"),R=a("6NK7"),W=a("Tt/K"),_=function(e){},X=function(e){function t(){var e,a;q()(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return a=M()(this,(e=j()(t)).call.apply(e,[this].concat(o))),a.state={polls:[],showOptionsField:!1},a.fetchRecentPolls=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=a.props.dispatch,n=e.length>0?{pollId:e}:{};t({type:"polls/polls/fetchRecent",payload:n,callback:a.fetchRecentPollsCallback})},a.fetchRecentPollsCallback=function(e){a.setState({polls:R["a"].transferObjectsToSelectOptionsWithoutID(e)})},a.handleCategorySelect=function(e){"2"===e||"3"===e?a.setState({showOptionsField:!0}):a.setState({showOptionsField:!1})},a}return Q()(t,e),x()(t,[{key:"componentDidMount",value:function(){var e=this.props.question;e?(this.fetchRecentPolls(e.poll),"2"!==e["category"]&&"3"!==e["category"]||this.setState({showOptionsField:!0})):this.fetchRecentPolls("")}},{key:"render",value:function(){var e=this.props,t=e.handleSubmit,a=e.submitButtonText,n=e.submitting,o=this.state,s=o.polls,l=o.showOptionsField;return F.a.createElement("div",null,F.a.createElement(D["a"],{onSubmit:t,layout:"horizontal",className:"modal-form"},F.a.createElement(A["a"],{name:"poll",label:Object(B["formatMessage"])({id:"app.polls.poll"}),size:"default",labelCol:{span:6},wrapperCol:{span:18},options:s,required:!0,hasFeedback:!0,validate:[J["g"]],component:L["d"]}),F.a.createElement(A["a"],{name:"serial",type:"text",size:"default",placeholder:"",label:Object(B["formatMessage"])({id:"common.serial"}),required:!0,hasFeedback:!0,validate:[J["g"]],labelCol:{span:6},wrapperCol:{span:18},component:L["b"]}),F.a.createElement(A["a"],{name:"question",type:"text",size:"default",placeholder:"",label:Object(B["formatMessage"])({id:"app.polls.question.question"}),required:!0,hasFeedback:!0,validate:[J["g"]],labelCol:{span:6},wrapperCol:{span:18},component:L["g"]}),F.a.createElement(A["a"],{name:"category",type:"text",size:"default",label:Object(B["formatMessage"])({id:"common.category"}),labelCol:{span:6},wrapperCol:{span:18},required:!0,hasFeedback:!0,onSelect:this.handleCategorySelect,validate:[J["g"]],options:W["k"],component:L["d"]}),F.a.createElement(A["a"],{name:"options",type:"text",size:"default",rows:4,placeholder:Object(B["formatMessage"])({id:"app.polls.oneOptionEachLine"}),label:Object(B["formatMessage"])({id:"app.polls.selectionOptions"}),disabled:!l,required:l,hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:L["f"]}),F.a.createElement(A["a"],{name:"required",label:Object(B["formatMessage"])({id:"app.polls.requiredQuestion"}),size:"default",labelCol:{span:6},wrapperCol:{span:18},defaultChecked:!0,checkedChildren:Object(B["formatMessage"])({id:"app.polls.requiredQuestion"}),unCheckedChildren:Object(B["formatMessage"])({id:"app.polls.optionalQuestion"}),component:L["e"]}),F.a.createElement(u["a"],{type:"primary",htmlType:"submit",disabled:n,className:"modal-form-button"},a)))}}]),t}(F.a.Component),Y=Object(K["a"])({form:"pollQuestionForm",validate:_})(X);function H(e,t){var a=t.question;return{initialValues:a,question:t.question,submitButtonText:t.submitButtonText||Object(B["formatMessage"])({id:"common.submit"})}}var Z,U,G,$=Object(P["connect"])(H)(Y),ee=a("LJjV"),te=a("JnT6"),ae=V["a"].Column,ne=function(e){function t(){var e,a;q()(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return a=M()(this,(e=j()(t)).call.apply(e,[this].concat(o))),a.state={data:[]},a.handleTableChange=function(){var e=C()(g.a.mark(function e(t,n,o){var s;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:s=a.state.data,o&&("ascend"===o.order?a.setState({data:s.sort(function(e,t){return e["y"]-t["y"]})}):a.setState({data:s.sort(function(e,t){return t["y"]-e["y"]})}));case 2:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a}return Q()(t,e),x()(t,[{key:"componentDidMount",value:function(){var e=this.props.data;this.setState({data:e})}},{key:"render",value:function(){var e=this.props,t=e.title,a=e.data,n={showQuickJumper:!0,pageSize:10,total:a.length};return F.a.createElement("div",null,F.a.createElement("h2",{className:"is-size-6"},"\u95ee\u9898\uff1a",t),F.a.createElement(V["a"],{size:"small",dataSource:a,rowKey:"x",pagination:n,onChange:this.handleTableChange},F.a.createElement(ae,{title:"\u7b54\u6848",dataIndex:"x"}),F.a.createElement(ae,{title:"\u6570\u91cf",dataIndex:"y",sorter:!0})))}}]),t}(I["PureComponent"]),oe=ne,se=V["a"].Column,le=(Z=Object(P["connect"])(function(e){return{loading:e.loading.effects["polls/questions/fetch"],list:e["polls/questions"].data.list,pagination:e["polls/questions"].data.pagination}}),Z((G=function(e){function t(){var e,a;q()(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return a=M()(this,(e=j()(t)).call.apply(e,[this].concat(o))),a.state={question:null,selectedQuestion:null,ordering:"",filters:null,filterVisible:!1,filtered:!1,searchText:"",modalTitle:"",modalContent:null,submitButtonText:"",modalVisible:!1,submitting:!1},a.fetchQuestions=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.props,n=t.dispatch,o=t.pagination,s=a.state,l=s.ordering,r=s.filters,i=s.searchText;n(e?{type:"polls/questions/fetch",payload:e}:{type:"polls/questions/fetch",payload:w()({search:i,page:o?o.current:1,ordering:l},r)})},a.handleTableChange=function(){var e=C()(g.a.mark(function e(t,n,o){var s,l;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return s=a.state.searchText,l=R["a"].transferSorterToOrdering(o),a.setState({ordering:l,filters:n}),e.next=5,a.fetchQuestions(w()({search:s,page:t.current,ordering:l},n));case 5:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.editQuestion=C()(g.a.mark(function e(){var t,n,o,s,l,r,i,c=arguments;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:null,n=a.state.submitting,o=null===t?[Object(B["formatMessage"])({id:"operations.create"},{name:Object(B["formatMessage"])({id:"app.polls.questions"})}),Object(B["formatMessage"])({id:"common.create"})]:[Object(B["formatMessage"])({id:"operations.edit"},{name:Object(B["formatMessage"])({id:"app.polls.questions"})}),Object(B["formatMessage"])({id:"common.edit"})],s=f()(o,2),l=s[0],r=s[1],i=null!==t?w()({},t,{options:R["a"].transferArrayToMultilineText(t["options"])}):t,e.next=6,a.setState({question:i});case 6:return e.next=8,a.setState({modalTitle:l,modalContent:F.a.createElement($,{question:a.state.question,title:l,submitButtonText:r,onSubmit:a.onSubmit,submitting:n}),submitButtonText:r,modalVisible:!0});case 8:case"end":return e.stop()}},e)})),a.deleteQuestion=function(){var e=C()(g.a.mark(function e(t){var n;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=a.props.dispatch,n({type:"polls/questions/remove",payload:{question:t},callback:function(){return a.deleteQuestionCallback(t["question"])}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.deleteQuestionCallback=function(e){m["a"].success("".concat(Object(B["formatMessage"])({id:"operations.success-delete"},{name:Object(B["formatMessage"])({id:"app.polls.questions"})})," ").concat(e)),a.fetchQuestions()},a.onInputChange=function(e){a.setState({searchText:e.target.value})},a.onQuestionSearch=C()(g.a.mark(function e(){var t,n,o,s;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=a.state,n=t.ordering,o=t.filters,s=t.searchText,e.next=3,a.fetchQuestions(w()({search:s,page:1,ordering:n},o));case 3:a.setState({filterVisible:!1,filtered:!!s});case 4:case"end":return e.stop()}},e)})),a.handleCancel=C()(g.a.mark(function e(){return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({modalVisible:!1,modalContent:null});case 2:case"end":return e.stop()}},e)})),a.onSubmit=function(){var e=C()(g.a.mark(function e(t){var n,o,s;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.props.dispatch,o=a.state.question,s=w()({},t,{required:!!t["required"],options:t["options"]?R["a"].transferMultilineTextToArray(t["options"]):[]}),console.warn("new values: ",s),e.prev=4,e.next=7,a.setState({submitting:!0});case 7:o&&o["id"]?n({type:"polls/questions/update",payload:{question:w()({},s)},callback:function(){return a.fetchQuestions()}}):n({type:"polls/questions/add",payload:{question:s},callback:function(){return a.fetchQuestions()}}),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](4),console.log(e.t0);case 13:return e.prev=13,e.next=16,a.setState({submitting:!1});case 16:return e.finish(13);case 17:return e.next=19,a.setState({modalVisible:!1,modalContent:null});case 19:case"end":return e.stop()}},e,null,[[4,10,13,17]])}));return function(t){return e.apply(this,arguments)}}(),a.showStatsTable=function(e){var t=a.props.dispatch;t({type:"polls/questions/stats",payload:{question:e},callback:a.showStatsTableCallback}),a.setState({modalTitle:"\u7b2c".concat(e["serial"],"\u9898 \u7edf\u8ba1\u8868"),selectedQuestion:e})},a.showStatsTableCallback=function(e){var t=a.state.selectedQuestion;a.setState({modalVisible:!0,modalContent:F.a.createElement(oe,{title:t["question"],height:300,data:e})})},a.showBarChart=function(e){var t=a.props.dispatch;t({type:"polls/questions/stats",payload:{question:e},callback:a.showBarChartCallback}),a.setState({modalTitle:"\u7b2c".concat(e["serial"],"\u9898 \u67f1\u72b6\u56fe"),selectedQuestion:e})},a.showBarChartCallback=function(e){var t=a.state.selectedQuestion;a.setState({modalVisible:!0,modalContent:F.a.createElement(ee["default"],{title:t["question"],height:300,data:e})})},a.showPieChart=function(e){var t=a.props.dispatch;t({type:"polls/questions/stats",payload:{question:e},callback:a.showPieChartCallback}),a.setState({modalTitle:"\u7b2c".concat(e["serial"],"\u9898 \u67f1\u72b6\u56fe"),selectedQuestion:e})},a.showPieChartCallback=function(e){var t=a.state.selectedQuestion;a.setState({modalVisible:!0,modalContent:F.a.createElement(te["default"],{animate:!1,autoLabel:!0,hasLegend:!0,lineWidth:2,title:t["question"],height:400,data:e})})},a}return Q()(t,e),x()(t,[{key:"componentDidMount",value:function(){this.fetchQuestions()}},{key:"render",value:function(){var e=this,t=this.props,a=t.list,m=t.pagination,h=t.loading,f=this.state,b=f.filtered,g=f.filterVisible,y=f.modalTitle,C=f.modalContent,v=f.modalVisible;return console.warn("list, pages, loading:",a,m,h),F.a.createElement(z["a"],{title:Object(B["formatMessage"])({id:"operations.management"},{name:Object(B["formatMessage"])({id:"app.polls.questions"})})},F.a.createElement(n["a"],{bordered:!1},m&&F.a.createElement(N["a"],null,m.total),F.a.createElement(p["a"],{title:y,visible:v,onCancel:this.handleCancel,footer:null},C||F.a.createElement(d["a"],{spinning:h})),F.a.createElement(u["a"],{type:"primary",onClick:function(){return e.editQuestion()}},F.a.createElement(B["FormattedMessage"],{id:"operations.create",values:{name:Object(B["formatMessage"])({id:"app.polls.questions"})}})),F.a.createElement(V["a"],{dataSource:a,loading:h,rowKey:"id",onChange:this.handleTableChange,pagination:m,width:1e3,scroll:{x:1e3}},F.a.createElement(se,{title:Object(B["formatMessage"])({id:"app.polls.polls"}),dataIndex:"poll",render:function(e,t){return t["poll_detail"]?t["poll_detail"]["name"]:""}}),F.a.createElement(se,{title:Object(B["formatMessage"])({id:"common.serial"}),dataIndex:"serial",render:function(e,t){return t["serial"]}}),F.a.createElement(se,{title:Object(B["formatMessage"])({id:"app.polls.question.question"}),dataIndex:"question",filterDropdown:F.a.createElement("div",{className:"table-input-search"},F.a.createElement(c["a"],{placeholder:Object(B["formatMessage"])({id:"app.polls.question.question"}),value:this.state.searchText,onChange:this.onInputChange,onPressEnter:this.onQuestionSearch}),F.a.createElement(u["a"],{type:"primary",onClick:this.onQuestionSearch},F.a.createElement(B["FormattedMessage"],{id:"common.search"}))),filterIcon:F.a.createElement(i["a"],{type:"search",style:{color:b?"#108ee9":"#aaa"}}),filterDropdownVisible:g,onFilterDropdownVisibleChange:function(t){e.setState({filterVisible:t})}}),F.a.createElement(se,{title:Object(B["formatMessage"])({id:"common.category"}),dataIndex:"category",render:function(e,t){return t["get_category_display"]}}),F.a.createElement(se,{title:Object(B["formatMessage"])({id:"common.option"}),dataIndex:"options",render:function(e,t){return F.a.createElement("ul",{type:"circle"},t["options"].map(function(e,t){return F.a.createElement("li",{key:t},e)}))}}),F.a.createElement(se,{title:Object(B["formatMessage"])({id:"app.polls.requiredQuestion"}),dataIndex:"required",render:function(e){return e?F.a.createElement(r["a"],{status:"success",text:Object(B["formatMessage"])({id:"app.polls.requiredQuestion"})}):F.a.createElement(r["a"],{status:"default",text:Object(B["formatMessage"])({id:"app.polls.optionalQuestion"})})}}),F.a.createElement(se,{title:Object(B["formatMessage"])({id:"common.modified"}),dataIndex:"modified",sorter:!0}),F.a.createElement(se,{title:Object(B["formatMessage"])({id:"common.created"}),dataIndex:"created"}),F.a.createElement(se,{title:Object(B["formatMessage"])({id:"common.operations"}),width:152,fixed:"right",render:function(t,a){return F.a.createElement("div",null,F.a.createElement("a",{onClick:function(){return e.editQuestion(a)}},Object(B["formatMessage"])({id:"common.edit"})),F.a.createElement("span",{className:"ant-divider"}),F.a.createElement(o["a"],{overlay:F.a.createElement(l["a"],null,F.a.createElement(l["a"].Item,null,F.a.createElement("a",{onClick:function(){return e.showStatsTable(a)}},"\u67e5\u770b\u7edf\u8ba1\u8868")),F.a.createElement(l["a"].Item,null,F.a.createElement("a",{onClick:function(){return e.showBarChart(a)}},"\u67e5\u770b\u67f1\u72b6\u56fe")),F.a.createElement(l["a"].Item,null,F.a.createElement("a",{onClick:function(){return e.showPieChart(a)}},"\u67e5\u770b\u997c\u72b6\u56fe")),F.a.createElement(l["a"].Item,null,F.a.createElement(s["a"],{title:Object(B["formatMessage"])({id:"common.delete-ask"}),onConfirm:function(){return e.deleteQuestion(a)}},F.a.createElement("a",{href:"#"}," ",F.a.createElement(B["FormattedMessage"],{id:"common.delete"})))))},F.a.createElement("a",{className:"ant-dropdown-link"},F.a.createElement(B["FormattedMessage"],{id:"common.more"})," ",F.a.createElement(i["a"],{type:"down"}))))}}))))}}]),t}(I["PureComponent"]),U=G))||U);t["default"]=le}}]);