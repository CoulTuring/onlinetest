(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[41],{Wdj6:function(e,t,a){"use strict";a.r(t);a("IzEo");var n=a("bx4M"),l=(a("qVdP"),a("jsC+")),r=(a("lUTK"),a("BvKs")),o=(a("Awhp"),a("KrTs")),s=(a("Pwec"),a("CtXQ")),c=(a("5NDa"),a("5rEg")),i=(a("+L6B"),a("2/Rp")),d=(a("T2oS"),a("W9HT")),p=(a("miYZ"),a("tsqr")),u=(a("2qtc"),a("kLXV")),h=a("qIgq"),m=a.n(h),f=a("d6i3"),v=a.n(f),b=a("1l/V"),E=a.n(b),g=a("p0pE"),w=a.n(g),C=a("2Taf"),x=a.n(C),y=a("vZ4D"),k=a.n(y),S=a("l4Ni"),O=a.n(S),T=a("ujKo"),L=a.n(T),I=a("MhPg"),V=a.n(I),F=(a("g9YV"),a("wCAj")),P=a("q1tI"),z=a.n(P),j=a("MuoO"),_=a("zHco"),D=a("FkSf"),B=(a("y8nQ"),a("Vl3Y")),q=a("d/v1"),N=a("pJVQ"),M=a("p9nB"),Y=(a("WAby"),a("6NK7")),K=function(e){},A=function(e){function t(){var e,a;x()(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return a=O()(this,(e=L()(t)).call.apply(e,[this].concat(l))),a.state={peopleOptions:[],selectedPeople:[]},a.searchPeople=function(e){var t=a.props.dispatch;t({type:"people/people/search",payload:{person:e},callback:a.searchPeopleCallback})},a.searchPeopleCallback=function(e){console.log("callback search people",e);var t=Y["a"].transferObjectsToSelectOptions(e);console.log(t),a.state.selectedPeople.forEach(function(e){return t.findIndex(function(t){return t.id===e.id})<0&&t.push(e)}),a.setState({peopleOptions:t})},a.handleSelect=function(){var e=E()(v.a.mark(function e(t){return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log("\u5f53\u524d\u9009\u4e2d\u7684 value:",t),e.next=3,a.setState({selectedPeople:a.state.selectedPeople.concat(a.state.peopleOptions.filter(function(e){return e.id===t}))});case 3:console.log("\u9009\u4e2d\u540e\uff1a",a.state.selectedPeople);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.handleDeselect=function(){var e=E()(v.a.mark(function e(t){return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({selectedPeople:a.state.selectedPeople.filter(function(e){return e.id!==t})});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return V()(t,e),k()(t,[{key:"componentDidMount",value:function(){this.props.leaderEvent}},{key:"render",value:function(){var e=this.props,t=e.schools,a=e.leaders,n=e.handleSubmit,l=e.submitButtonText,r=e.submitting,o=e.searching;this.state.peopleOptions;return z.a.createElement("div",null,z.a.createElement(B["a"],{onSubmit:n,layout:"horizontal",className:"modal-form"},z.a.createElement(q["a"],{name:"leaders",label:"\u9886\u5bfc",size:"default",labelCol:{span:6},wrapperCol:{span:18},options:a,defaultValue:[],mode:"multiple",filterOption:!1,onSelect:this.handleSelect,onDeselect:this.handleDeselect,notFoundContent:o?z.a.createElement(d["a"],{size:"small"}):null,component:M["d"]}),z.a.createElement(q["a"],{name:"leaders_notes",type:"text",size:"default",placeholder:"\u7279\u6b8a\u6587\u5b57\uff0c\u5982\uff1a\u5168\u4f53\u5728\u6821\u9886\u5bfc",label:"\u9886\u5bfc\u5907\u6ce8(\u9009\u586b)",hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:M["g"]}),z.a.createElement(q["a"],{name:"date",type:"text",size:"default",placeholder:"\u65e5\u671f",label:"\u65e5\u671f",required:!0,hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:12,offset:0},component:M["a"],dateTimeFormat:"YYYY-MM-DD"}),z.a.createElement(q["a"],{name:"time",type:"text",size:"default",placeholder:"\u5f00\u59cb\u65f6\u95f4",label:"\u5f00\u59cb\u65f6\u95f4",hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:12,offset:0},component:M["h"],dateTimeFormat:"HH:mm:ss"}),z.a.createElement(q["a"],{name:"title",type:"text",size:"default",placeholder:"",label:"\u6d3b\u52a8\u540d\u79f0",required:!0,hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:M["g"]}),z.a.createElement(q["a"],{name:"schools",label:"\u627f\u529e\u90e8\u95e8",size:"default",labelCol:{span:6},wrapperCol:{span:18},options:t,defaultValue:[],mode:"multiple",component:M["d"]}),z.a.createElement(q["a"],{name:"location",type:"text",size:"default",placeholder:"",label:"\u5730\u70b9",hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:M["g"]}),z.a.createElement(q["a"],{name:"attendances",type:"text",size:"default",placeholder:"",label:"\u53c2\u52a0\u90e8\u95e8/\u4eba\u5458",hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:M["g"]}),z.a.createElement(q["a"],{name:"contact",type:"text",size:"default",placeholder:"",label:"\u8054\u7cfb\u4eba",hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:M["g"]}),z.a.createElement(q["a"],{name:"contact_number",type:"text",size:"default",placeholder:"",label:"\u8054\u7cfb\u7535\u8bdd",hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:M["g"]}),z.a.createElement(q["a"],{name:"visible",label:"\u663e\u793a",size:"default",labelCol:{span:6},wrapperCol:{span:18},defaultChecked:!0,checkedChildren:"\u663e\u793a",unCheckedChildren:"\u9690\u85cf",component:M["e"]}),z.a.createElement(q["a"],{name:"notes",type:"text",size:"default",placeholder:"",label:"\u5907\u6ce8",hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},rows:3,component:M["f"]}),z.a.createElement(i["a"],{type:"primary",htmlType:"submit",disabled:r,className:"modal-form-button"},l)))}}]),t}(z.a.Component),H=Object(N["a"])({form:"leaderEventForm",validate:K})(A);function W(e,t){var a=t.leaderEvent;return{searching:e.loading.effects["people/people/search"],initialValues:a,leaderEvent:t.leaderEvent,submitButtonText:t.submitButtonText||"\u63d0\u4ea4"}}var J,Q,X,Z=Object(j["connect"])(W)(H),R=F["a"].Column,U=(J=Object(j["connect"])(function(e){return{loading:e.loading.effects["leader-events/leader-events/fetch"],list:e["leader-events/leader-events"].data.list,pagination:e["leader-events/leader-events"].data.pagination}}),J((X=function(e){function t(){var e,a;x()(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return a=O()(this,(e=L()(t)).call.apply(e,[this].concat(l))),a.state={leaderEvent:null,leadersOptions:[],leadersSelectOptions:[],schoolsOptions:[],schoolsSelectOptions:[],ordering:"",filters:null,filterVisible:!1,filtered:!1,searchText:"",modalTitle:"",modalContent:null,submitButtonText:"",modalVisible:!1,submitting:!1},a.fetchLeaderEvents=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.props,n=t.dispatch,l=t.pagination,r=a.state,o=r.ordering,s=r.filters,c=r.searchText;n(e?{type:"leader-events/leader-events/fetch",payload:e}:{type:"leader-events/leader-events/fetch",payload:w()({search:c,page:l?l.current:1,ordering:o},s)})},a.fetchLeaders=function(){var e=a.props.dispatch;e({type:"leader-events/leaders/fetchPublic",payload:{},callback:a.fetchLeadersCallback})},a.fetchLeadersCallback=function(e){a.setState({leadersOptions:Y["a"].transferObjectsToFilterOptions(e)}),a.setState({leadersSelectOptions:e.map(function(e){return Object.assign({},e,{key:e["person"],value:e["person"],label:"".concat(e["person_detail"]["name"],"(").concat(e["person"],")")})})})},a.fetchSchools=function(){var e=a.props.dispatch;e({type:"schools/schools/fetchPublic",payload:{},callback:a.fetchSchoolsCallback})},a.fetchSchoolsCallback=function(e){a.setState({schoolsOptions:Y["a"].transferObjectsToFilterOptions(e)}),a.setState({schoolsSelectOptions:Y["a"].transferObjectsToSelectOptionsWithoutID(e)})},a.handleTableChange=function(){var e=E()(v.a.mark(function e(t,n,l){var r,o;return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return r=a.state.searchText,o=0===Object.keys(l).length?void 0:"ascend"===l.order?"".concat(l.field):"-".concat(l.field),a.setState({ordering:o,filters:n}),e.next=5,a.fetchLeaderEvents(w()({search:r,page:t.current,ordering:o},n));case 5:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.editLeaderEvent=E()(v.a.mark(function e(){var t,n,l,r,o,s,c,i,d,p=arguments;return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:null,n=a.state,l=n.leadersSelectOptions,r=n.schoolsSelectOptions,o=n.submitting,s=null===t?["\u521b\u5efa\u9886\u5bfc\u6d3b\u52a8","\u521b\u5efa"]:["\u7f16\u8f91\u9886\u5bfc\u6d3b\u52a8","\u7f16\u8f91"],c=m()(s,2),i=c[0],d=c[1],e.next=5,a.setState({leaderEvent:t?w()({},t):{}});case 5:return e.next=7,a.setState({modalTitle:i,modalContent:z.a.createElement(Z,{leaderEvent:a.state.leaderEvent,leaders:l,schools:r,title:i,submitButtonText:d,onSubmit:a.onSubmit,submitting:o}),submitButtonText:d,modalVisible:!0});case 7:case"end":return e.stop()}},e)})),a.deleteLeaderEvent=function(){var e=E()(v.a.mark(function e(t){var n;return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=a.props.dispatch,u["a"].confirm({title:"\u60a8\u786e\u8ba4\u8981\u5220\u9664\u9886\u5bfc\u6d3b\u52a8 ".concat(t["title"]," \u5417?"),content:"\u5220\u9664\u540e\u5c06\u4e0d\u53ef\u6062\u590d\uff0c\u5176\u76f8\u5173\u6570\u636e\u3001\u4fe1\u606f\u4e5f\u5c06\u4e00\u5e76\u5220\u9664\u3002",onOk:function(){var e=E()(v.a.mark(function e(){return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n({type:"leader-events/leader-events/remove",payload:{leaderEvent:t},callback:function(){return a.fetchLeaderEvents()}}),p["a"].success("\u6210\u529f\u5220\u9664\u9886\u5bfc\u6d3b\u52a8 ".concat(t["title"],"\u3002"));case 2:case"end":return e.stop()}},e)}));function l(){return e.apply(this,arguments)}return l}(),onCancel:function(){}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.onInputChange=function(e){a.setState({searchText:e.target.value})},a.onLeaderEventSearch=E()(v.a.mark(function e(){var t,n,l,r;return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=a.state,n=t.ordering,l=t.filters,r=t.searchText,e.next=3,a.fetchLeaderEvents(w()({search:r,page:1,ordering:n},l));case 3:a.setState({filterVisible:!1,filtered:!!r});case 4:case"end":return e.stop()}},e)})),a.handleCancel=E()(v.a.mark(function e(){return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({modalVisible:!1,modalContent:null});case 2:case"end":return e.stop()}},e)})),a.onSubmit=function(){var e=E()(v.a.mark(function e(t){var n,l,r;return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.props.dispatch,l=a.state.leaderEvent,r=w()({},t,{visible:!!t["visible"]}),console.warn("new values: ",r),e.prev=4,e.next=7,a.setState({submitting:!0});case 7:l&&l["id"]?n({type:"leader-events/leader-events/update",payload:{leaderEvent:w()({},r)},callback:function(){return a.fetchLeaderEvents()}}):n({type:"leader-events/leader-events/add",payload:{leaderEvent:r},callback:function(){return a.fetchLeaderEvents()}}),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](4),console.log(e.t0);case 13:return e.prev=13,e.next=16,a.setState({submitting:!1});case 16:return e.finish(13);case 17:return e.next=19,a.setState({modalVisible:!1,modalContent:null});case 19:case"end":return e.stop()}},e,null,[[4,10,13,17]])}));return function(t){return e.apply(this,arguments)}}(),a}return V()(t,e),k()(t,[{key:"componentDidMount",value:function(){this.fetchLeaderEvents(),this.fetchLeaders(),this.fetchSchools()}},{key:"render",value:function(){var e=this,t=this.props,a=t.list,p=t.pagination,h=t.loading,m=this.state,f=(m.leadersOptions,m.schoolsOptions,m.filtered),v=m.filterVisible,b=m.modalTitle,E=m.modalContent,g=m.modalVisible;return console.warn("list, pages, loading:",a,p,h),z.a.createElement(_["a"],{title:"\u9886\u5bfc\u6d3b\u52a8\u7ba1\u7406"},z.a.createElement(n["a"],{bordered:!1},p&&z.a.createElement(D["a"],null,p.total),z.a.createElement(u["a"],{title:b,visible:g,onCancel:this.handleCancel,footer:null},E||z.a.createElement(d["a"],{spinning:h})),z.a.createElement(i["a"],{type:"primary",onClick:function(){return e.editLeaderEvent()}},"\u65b0\u5efa\u9886\u5bfc\u6d3b\u52a8"),z.a.createElement(F["a"],{dataSource:a,loading:h,rowKey:"id",onChange:this.handleTableChange,pagination:p,width:1400,scroll:{x:1400}},z.a.createElement(R,{title:"\u9886\u5bfc",dataIndex:"leaders_relations",render:function(e,t){return t["leaders_notes"]?t["leaders_notes"]:t["leaders"].length>0?t["leaders_relations"].sort(function(e,t){return e["leader"]["sort_weight"]-t["leader"]["sort_weight"]}).map(function(e){return e["leader"]["person_detail"]["name"]}).join("\uff0c"):void 0}}),z.a.createElement(R,{title:"\u65e5\u671f",dataIndex:"date",render:function(e,t){return t["date"]},sorter:!0}),z.a.createElement(R,{title:"\u5f00\u59cb\u65f6\u95f4",dataIndex:"time",render:function(e,t){return t["time"]}}),z.a.createElement(R,{title:"\u627f\u529e\u90e8\u95e8",dataIndex:"schools",render:function(e,t){if(t["schools"].length>0)return t["schools_relations"].sort(function(e,t){return e["school"]["sort_weight"]-t["school"]["sort_weight"]}).map(function(e){return e["school"]["full_name"]}).join("\uff0c")}}),z.a.createElement(R,{title:"\u6d3b\u52a8\u540d\u79f0",dataIndex:"title",filterDropdown:z.a.createElement("div",{className:"table-input-search"},z.a.createElement(c["a"],{placeholder:"\u540d\u79f0",value:this.state.searchText,onChange:this.onInputChange,onPressEnter:this.onLeaderEventSearch}),z.a.createElement(i["a"],{type:"primary",onClick:this.onLeaderEventSearch},"\u68c0\u7d22")),filterIcon:z.a.createElement(s["a"],{type:"search",style:{color:f?"#108ee9":"#aaa"}}),filterDropdownVisible:v,onFilterDropdownVisibleChange:function(t){e.setState({filterVisible:t})}}),z.a.createElement(R,{title:"\u5730\u70b9",dataIndex:"location"}),z.a.createElement(R,{title:"\u53c2\u4e0e\u90e8\u95e8/\u4eba\u5458",dataIndex:"attendances"}),z.a.createElement(R,{title:"\u8054\u7cfb\u4eba",dataIndex:"contact"}),z.a.createElement(R,{title:"\u8054\u7cfb\u7535\u8bdd",dataIndex:"contact_number"}),z.a.createElement(R,{title:"\u663e\u793a",dataIndex:"visible",render:function(e){return e?z.a.createElement(o["a"],{status:"success",text:"\u5f00\u653e"}):z.a.createElement(o["a"],{status:"default",text:"\u5173\u95ed"})}}),z.a.createElement(R,{title:"\u5907\u6ce8",dataIndex:"notes"}),z.a.createElement(R,{title:"\u64cd\u4f5c",width:152,fixed:"right",render:function(t,a){return z.a.createElement("div",null,z.a.createElement("a",{onClick:function(){return e.editLeaderEvent(a)}},"\u7f16\u8f91"),z.a.createElement("span",{className:"ant-divider"}),z.a.createElement(l["a"],{overlay:z.a.createElement(r["a"],null,z.a.createElement(r["a"].Item,null,z.a.createElement("a",{onClick:function(){return e.deleteLeaderEvent(a)}},"\u5220\u9664")))},z.a.createElement("a",{className:"ant-dropdown-link"},"\u66f4\u591a ",z.a.createElement(s["a"],{type:"down"}))))}}))))}}]),t}(P["PureComponent"]),Q=X))||Q);t["default"]=U}}]);