(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[68],{N4sV:function(e,t,a){"use strict";a.r(t);a("IzEo");var n=a("bx4M"),o=(a("qVdP"),a("jsC+")),l=(a("lUTK"),a("BvKs")),s=(a("P2fV"),a("NJEC")),r=(a("Awhp"),a("KrTs")),i=(a("Pwec"),a("CtXQ")),c=(a("5NDa"),a("5rEg")),m=(a("+L6B"),a("2/Rp")),p=(a("2qtc"),a("kLXV")),d=(a("T2oS"),a("W9HT")),u=(a("miYZ"),a("tsqr")),f=a("qIgq"),h=a.n(f),b=a("d6i3"),g=a.n(b),v=a("1l/V"),O=a.n(v),C=a("p0pE"),w=a.n(C),E=a("2Taf"),M=a.n(E),j=a("vZ4D"),x=a.n(j),y=a("l4Ni"),k=a.n(y),S=a("ujKo"),P=a.n(S),T=a("MhPg"),V=a.n(T),F=(a("g9YV"),a("wCAj")),I=a("q1tI"),D=a.n(I),_=a("MuoO"),N=a("LLXN"),q=a("zHco"),z=a("FkSf"),B=(a("y8nQ"),a("Vl3Y")),A=a("d/v1"),Y=a("pJVQ"),K=a("p9nB"),H=a("WAby"),J=a("6NK7"),L=function(e){},W=function(e){function t(){var e,a;M()(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return a=k()(this,(e=P()(t)).call.apply(e,[this].concat(o))),a.state={peopleOptions:[],selectedPeople:[]},a.searchPeople=function(e,t){var n=a.props.dispatch;console.log("in search people: ",t),n({type:"people/people/search",payload:{person:t},callback:a.searchPeopleCallback})},a.searchPeopleCallback=function(e){var t=J["a"].transferPeopleToOptionsWithName(e);a.setState({peopleOptions:t})},a}return V()(t,e),x()(t,[{key:"componentDidMount",value:function(){this.props.poll}},{key:"render",value:function(){var e=this.props,t=e.schools,a=e.handleSubmit,n=e.submitButtonText,o=e.submitting,l=e.searching,s=this.state.peopleOptions;return D.a.createElement("div",null,D.a.createElement(B["a"],{onSubmit:a,layout:"horizontal",className:"modal-form"},D.a.createElement(A["a"],{name:"name",type:"text",size:"default",placeholder:"",label:Object(N["formatMessage"])({id:"common.brand-name"}),required:!0,hasFeedback:!0,validate:[H["g"]],labelCol:{span:6},wrapperCol:{span:18},component:K["g"]}),D.a.createElement(A["a"],{name:"datetime",type:"text",size:"default",placeholder:[Object(N["formatMessage"])({id:"common.startDatetime"}),Object(N["formatMessage"])({id:"common.endDatetime"})],label:Object(N["formatMessage"])({id:"app.polls.pollDatetimeInterval"}),required:!0,hasFeedback:!0,validate:[H["g"]],labelCol:{span:6},wrapperCol:{span:18,offset:0},component:K["c"],dateTimeFormat:"YYYY-MM-DD HH:mm:ss",showTime:!0}),D.a.createElement(A["a"],{name:"description",type:"text",size:"default",placeholder:"",label:Object(N["formatMessage"])({id:"common.description"}),required:!0,hasFeedback:!0,validate:[H["g"]],labelCol:{span:6},wrapperCol:{span:18},rows:4,component:K["f"]}),D.a.createElement(A["a"],{name:"school",label:Object(N["formatMessage"])({id:"app.schools.school"}),size:"default",labelCol:{span:6},wrapperCol:{span:18},options:t,required:!0,hasFeedback:!0,validate:[H["g"]],component:K["d"]}),D.a.createElement(A["a"],{name:"administrator",label:Object(N["formatMessage"])({id:"common.administrator"}),size:"default",mode:"combobox",labelCol:{span:6},wrapperCol:{span:18},options:s,defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onFocus:this.searchPeople,onChange:this.searchPeople,required:!1,hasFeedback:!0,validate:[H["g"],H["d"]],notFoundContent:l?D.a.createElement(d["a"],{size:"small"}):null,component:K["d"]}),D.a.createElement(A["a"],{name:"open",label:Object(N["formatMessage"])({id:"common.visible"}),size:"default",labelCol:{span:6},wrapperCol:{span:18},defaultChecked:!0,checkedChildren:Object(N["formatMessage"])({id:"common.visible"}),unCheckedChildren:Object(N["formatMessage"])({id:"common.invisible"}),component:K["e"]}),D.a.createElement(m["a"],{type:"primary",htmlType:"submit",disabled:o,className:"modal-form-button"},n)))}}]),t}(D.a.Component),Q=Object(Y["a"])({form:"pollForm",validate:L})(W);function X(e,t){var a=t.poll;return{searching:e.loading.effects["people/people/search"],initialValues:a,poll:t.poll,submitButtonText:t.submitButtonText||Object(N["formatMessage"])({id:"common.submit"})}}var Z,R,U,G=Object(_["connect"])(X)(Q),$=F["a"].Column,ee=(Z=Object(_["connect"])(function(e){return{loading:e.loading.effects["polls/polls/fetch"],list:e["polls/polls"].data.list,pagination:e["polls/polls"].data.pagination}}),Z((U=function(e){function t(){var e,a;M()(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return a=k()(this,(e=P()(t)).call.apply(e,[this].concat(o))),a.state={poll:null,schoolsOptions:[],schoolsSelectOptions:[],ordering:"",filters:null,filterVisible:!1,filtered:!1,searchText:"",modalTitle:"",modalContent:null,submitButtonText:"",modalVisible:!1,submitting:!1},a.fetchPolls=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.props,n=t.dispatch,o=t.pagination,l=a.state,s=l.ordering,r=l.filters,i=l.searchText;n(e?{type:"polls/polls/fetch",payload:e}:{type:"polls/polls/fetch",payload:w()({search:i,page:o?o.current:1,ordering:s},r)})},a.fetchSchools=function(){var e=a.props.dispatch;e({type:"schools/schools/fetchPublic",payload:{},callback:a.fetchSchoolsCallback})},a.fetchSchoolsCallback=function(e){a.setState({schoolsOptions:J["a"].transferObjectsToFilterOptions(e),schoolsSelectOptions:J["a"].transferObjectsToSelectOptionsWithoutID(e)})},a.handleTableChange=function(){var e=O()(g.a.mark(function e(t,n,o){var l,s;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return l=a.state.searchText,s=J["a"].transferSorterToOrdering(o),a.setState({ordering:s,filters:n}),e.next=5,a.fetchPolls(w()({search:l,page:t.current,ordering:s},n));case 5:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.editPoll=O()(g.a.mark(function e(){var t,n,o,l,s,r,i,c,m=arguments;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=m.length>0&&void 0!==m[0]?m[0]:null,n=a.state,o=n.schoolsSelectOptions,l=n.submitting,s=null===t?[Object(N["formatMessage"])({id:"operations.create"},{name:Object(N["formatMessage"])({id:"app.polls.polls"})}),Object(N["formatMessage"])({id:"common.create"})]:[Object(N["formatMessage"])({id:"operations.edit"},{name:Object(N["formatMessage"])({id:"app.polls.polls"})}),Object(N["formatMessage"])({id:"common.edit"})],r=h()(s,2),i=r[0],c=r[1],e.next=5,a.setState({poll:t?w()({},t,{administrator:t["administrator"]?"".concat(t["administrator_detail"]["name"],"(").concat(t["administrator_detail"]["id"],")"):null,datetime:[t["start_datetime"],t["end_datetime"]]}):{}});case 5:return e.next=7,a.setState({modalTitle:i,modalContent:D.a.createElement(G,{poll:a.state.poll,schools:o,title:i,submitButtonText:c,onSubmit:a.onSubmit,submitting:l}),submitButtonText:c,modalVisible:!0});case 7:case"end":return e.stop()}},e)})),a.deletePoll=function(){var e=O()(g.a.mark(function e(t){var n;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=a.props.dispatch,n({type:"polls/polls/remove",payload:{poll:t},callback:function(){return a.deletePollCallback(t["name"])}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.deletePollCallback=function(e){u["a"].success("".concat(Object(N["formatMessage"])({id:"operations.success-delete"},{name:Object(N["formatMessage"])({id:"app.polls.polls"})})," ").concat(e)),a.fetchPolls()},a.onInputChange=function(e){a.setState({searchText:e.target.value})},a.onPollSearch=O()(g.a.mark(function e(){var t,n,o,l;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=a.state,n=t.ordering,o=t.filters,l=t.searchText,e.next=3,a.fetchPolls(w()({search:l,page:1,ordering:n},o));case 3:a.setState({filterVisible:!1,filtered:!!l});case 4:case"end":return e.stop()}},e)})),a.handleCancel=O()(g.a.mark(function e(){return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({modalVisible:!1,modalContent:null});case 2:case"end":return e.stop()}},e)})),a.onSubmit=function(){var e=O()(g.a.mark(function e(t){var n,o,l,s;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.props.dispatch,o=a.state.poll,l=/\((\w{4,11})\)/.exec(t["administrator"]),s=w()({},t,{administrator:l[1],start_datetime:t["datetime"][0],end_datetime:t["datetime"][1]}),console.warn("new values: ",s),e.prev=5,e.next=8,a.setState({submitting:!0});case 8:o&&o["id"]?n({type:"polls/polls/update",payload:{poll:w()({},s)},callback:function(){return a.onSubmitCallback("".concat(Object(N["formatMessage"])({id:"operations.success-edit"},{name:Object(N["formatMessage"])({id:"app.polls.polls"})})))}}):n({type:"polls/polls/add",payload:{poll:s},callback:function(){return a.onSubmitCallback("".concat(Object(N["formatMessage"])({id:"operations.success-create"},{name:Object(N["formatMessage"])({id:"app.polls.polls"})})))}}),e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](5),console.log(e.t0);case 14:return e.prev=14,e.next=17,a.setState({submitting:!1});case 17:return e.finish(14);case 18:return e.next=20,a.setState({modalVisible:!1,modalContent:null});case 20:case"end":return e.stop()}},e,null,[[5,11,14,18]])}));return function(t){return e.apply(this,arguments)}}(),a}return V()(t,e),x()(t,[{key:"componentDidMount",value:function(){this.fetchPolls(),this.fetchSchools()}},{key:"onSubmitCallback",value:function(e){u["a"].success(e),this.fetchPolls()}},{key:"render",value:function(){var e=this,t=this.props,a=t.list,u=t.pagination,f=t.loading,h=this.state,b=h.schoolsOptions,g=h.filtered,v=h.filterVisible,O=h.modalTitle,C=h.modalContent,w=h.modalVisible;return console.warn("list, pages, loading:",a,u,f),D.a.createElement(q["a"],{title:Object(N["formatMessage"])({id:"operations.management"},{name:Object(N["formatMessage"])({id:"app.polls.polls"})})},D.a.createElement(n["a"],{bordered:!1},u&&D.a.createElement(z["a"],null,u.total),D.a.createElement(p["a"],{title:O,visible:w,onCancel:this.handleCancel,footer:null},C||D.a.createElement(d["a"],{spinning:f})),D.a.createElement(m["a"],{type:"primary",onClick:function(){return e.editPoll()}},D.a.createElement(N["FormattedMessage"],{id:"operations.create",values:{name:Object(N["formatMessage"])({id:"app.polls.polls"})}})),D.a.createElement(F["a"],{dataSource:a,loading:f,rowKey:"id",onChange:this.handleTableChange,pagination:u,width:1200,scroll:{x:1200}},D.a.createElement($,{title:Object(N["formatMessage"])({id:"common.brand-name"}),dataIndex:"name",filterDropdown:D.a.createElement("div",{className:"table-input-search"},D.a.createElement(c["a"],{placeholder:Object(N["formatMessage"])({id:"common.brand-name"}),value:this.state.searchText,onChange:this.onInputChange,onPressEnter:this.onPollSearch}),D.a.createElement(m["a"],{type:"primary",onClick:this.onPollSearch},D.a.createElement(N["FormattedMessage"],{id:"common.search"}))),filterIcon:D.a.createElement(i["a"],{type:"search",style:{color:g?"#108ee9":"#aaa"}}),filterDropdownVisible:v,onFilterDropdownVisibleChange:function(t){e.setState({filterVisible:t})}}),D.a.createElement($,{title:Object(N["formatMessage"])({id:"app.schools.school"}),dataIndex:"school",render:function(e,t){return t["school_detail"]?t["school_detail"]["name"]:""},filters:b}),D.a.createElement($,{title:Object(N["formatMessage"])({id:"common.administrator"}),dataIndex:"administrator",render:function(e,t){return t["administrator_detail"]?t["administrator_detail"]["name"]:""}}),D.a.createElement($,{title:Object(N["formatMessage"])({id:"common.startDatetime"}),dataIndex:"start_datetime",render:function(e,t){return t["start_datetime"]}}),D.a.createElement($,{title:Object(N["formatMessage"])({id:"common.endDatetime"}),dataIndex:"end_datetime",render:function(e,t){return t["end_datetime"]}}),D.a.createElement($,{title:Object(N["formatMessage"])({id:"common.description"}),dataIndex:"description"}),D.a.createElement($,{title:Object(N["formatMessage"])({id:"common.open"}),dataIndex:"open",render:function(e){return e?D.a.createElement(r["a"],{status:"success",text:Object(N["formatMessage"])({id:"common.open"})}):D.a.createElement(r["a"],{status:"default",text:Object(N["formatMessage"])({id:"common.close"})})}}),D.a.createElement($,{title:Object(N["formatMessage"])({id:"common.operations"}),width:152,fixed:"right",render:function(t,a){return D.a.createElement("div",null,D.a.createElement("a",{onClick:function(){return e.editPoll(a)}},Object(N["formatMessage"])({id:"common.edit"})),D.a.createElement("span",{className:"ant-divider"}),D.a.createElement(o["a"],{overlay:D.a.createElement(l["a"],null,D.a.createElement(l["a"].Item,null,D.a.createElement(s["a"],{title:Object(N["formatMessage"])({id:"common.delete-ask"}),onConfirm:function(){return e.deletePoll(a)}},D.a.createElement("a",{href:"#"}," ",D.a.createElement(N["FormattedMessage"],{id:"common.delete"})))))},D.a.createElement("a",{className:"ant-dropdown-link"},D.a.createElement(N["FormattedMessage"],{id:"common.more"})," ",D.a.createElement(i["a"],{type:"down"}))))}}))))}}]),t}(I["PureComponent"]),R=U))||R);t["default"]=ee}}]);