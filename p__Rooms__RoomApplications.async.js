(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[82],{m2uq:function(e,t,a){"use strict";a.r(t);a("IzEo");var n=a("bx4M"),o=(a("qVdP"),a("jsC+")),r=(a("Pwec"),a("CtXQ")),l=(a("P2fV"),a("NJEC")),i=(a("lUTK"),a("BvKs")),c=(a("Awhp"),a("KrTs")),s=(a("5NDa"),a("5rEg")),p=(a("+L6B"),a("2/Rp")),m=(a("2qtc"),a("kLXV")),u=(a("T2oS"),a("W9HT")),d=(a("miYZ"),a("tsqr")),h=a("qIgq"),f=a.n(h),b=a("d6i3"),v=a.n(b),x=a("1l/V"),g=a.n(x),E=a("p0pE"),w=a.n(E),y=a("2Taf"),C=a.n(y),A=a("vZ4D"),k=a.n(A),S=a("l4Ni"),R=a.n(S),T=a("ujKo"),O=a.n(T),I=a("MhPg"),V=a.n(I),B=(a("g9YV"),a("wCAj")),_=a("q1tI"),z=a.n(_),F=a("MuoO"),q=a("zHco"),j=a("FkSf"),N=(a("y8nQ"),a("Vl3Y")),D=a("d/v1"),M=a("pJVQ"),P=a("p9nB"),Y=a("WAby"),K=a("6NK7"),H=function(e){},J=function(e){function t(){var e,a;C()(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return a=R()(this,(e=O()(t)).call.apply(e,[this].concat(o))),a.state={roomsOptions:[],selectedRooms:[]},a.selectRoom=function(e,t){var n=a.props.dispatch;console.log("in clear content: ",e,t),console.log(t.props,t.props.id),n({type:"meeting-rooms/meeting-rooms/selectRoom",payload:t.props.id})},a.searchRooms=function(e,t){var n=a.props.dispatch;n({type:"rooms/rooms/search",payload:{person:t},callback:a.searchRoomsCallback})},a.searchRoomsCallback=function(e){console.log("in callback: ",e);var t=e.map(function(e){return Object.assign({},e,{key:"".concat(e.id),value:"".concat(e["fullname"],"(").concat(e["full_id"],")"),label:"".concat(e["fullname"],"(").concat(e["full_id"],")")})});a.setState({roomsOptions:t})},a}return V()(t,e),k()(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.searching,a=e.schools,n=e.handleSubmit,o=e.submitButtonText,r=e.submitting,l=this.state.roomsOptions;return z.a.createElement("div",null,z.a.createElement(N["a"],{onSubmit:n,layout:"horizontal",className:"modal-form"},z.a.createElement(D["a"],{name:"room",label:"\u623f\u95f4",size:"default",mode:"combobox",labelCol:{span:6},wrapperCol:{span:18},options:l,defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onFocus:this.searchRooms,onSelect:this.selectRoom,onChange:this.searchRooms,required:!0,hasFeedback:!0,validate:[Y["g"]],notFoundContent:t?z.a.createElement(u["a"],{size:"small"}):null,component:P["d"]}),z.a.createElement(D["a"],{name:"school",label:"\u7533\u8bf7\u90e8\u95e8",size:"default",labelCol:{span:6},wrapperCol:{span:18},options:a,required:!0,hasFeedback:!0,component:P["d"]}),z.a.createElement(D["a"],{type:"text",name:"datetime",size:"default",label:"\u7533\u8bf7\u65e5\u671f\u65f6\u95f4",labelCol:{span:6},wrapperCol:{span:9,offset:0},component:P["a"],dateTimeFormat:"YYYY-MM-DD HH:mm:ss",showTime:!0}),z.a.createElement(D["a"],{name:"hours",type:"text",size:"default",placeholder:"2\u5c0f\u65f630\u5206\u949f\u5219\u586b\u51992.5",label:"\u7533\u8bf7\u65f6\u5e38(\u5c0f\u65f6)",required:!0,hasFeedback:!0,validate:[Y["g"]],labelCol:{span:6},wrapperCol:{span:18},step:.1,component:P["b"]}),z.a.createElement(D["a"],{name:"content",type:"text",size:"default",placeholder:"\u8bf7\u8bf4\u660e\u7533\u8bf7\u6559\u5ba4/\u623f\u95f4\u7684\u539f\u56e0",label:"\u7533\u8bf7\u8bf4\u660e",required:!0,hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:P["f"]}),z.a.createElement(D["a"],{name:"notes",type:"text",size:"default",placeholder:"",label:"\u5907\u6ce8",labelCol:{span:6},wrapperCol:{span:18},component:P["f"]}),z.a.createElement(p["a"],{type:"primary",htmlType:"submit",disabled:r,className:"modal-form-button"},o)))}}]),t}(z.a.Component),Q=Object(M["a"])({form:"roomApplicationForm",validate:H})(J);function W(e,t){var a=t.roomApplication;return{searching:e.loading.effects["rooms/rooms/search"],initialValues:a,roomApplication:t.roomApplication,submitButtonText:t.submitButtonText||"\u63d0\u4ea4"}}var L=Object(F["connect"])(W)(Q),X=function(e){},Z=function(e){function t(){var e,a;C()(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return a=R()(this,(e=O()(t)).call.apply(e,[this].concat(o))),a.state={},a}return V()(t,e),k()(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.handleSubmit,a=e.submitButtonText,n=e.submitting;return z.a.createElement("div",null,z.a.createElement(N["a"],{onSubmit:t,layout:"horizontal",className:"modal-form"},z.a.createElement(D["a"],{name:"approved",label:"\u5ba1\u6279\u7ed3\u679c",size:"default",labelCol:{span:6},wrapperCol:{span:18},defaultChecked:!0,checkedChildren:"\u6279\u51c6",unCheckedChildren:"\u5426\u51b3",component:P["e"]}),z.a.createElement(D["a"],{name:"opinion",type:"text",size:"default",placeholder:"\u8bf7\u7b80\u8981\u8bf4\u660e\u5ba1\u6279\u623f\u95f4\u7533\u8bf7\u7684\u610f\u89c1",label:"\u5ba1\u6279\u610f\u89c1",required:!0,hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:P["f"]}),z.a.createElement(p["a"],{type:"primary",htmlType:"submit",disabled:n,className:"modal-form-button"},a)))}}]),t}(z.a.Component),U=Object(M["a"])({form:"roomApplicationExamineForm",validate:X})(Z);function G(e,t){var a=t.roomApplication;return{initialValues:a,roomApplication:t.roomApplication,submitButtonText:t.submitButtonText||"\u63d0\u4ea4"}}var $,ee,te,ae=Object(F["connect"])(G)(U),ne=B["a"].Column,oe=($=Object(F["connect"])(function(e){return{isAdminOrIsRoomsAdmin:e["auth"].person&&e["auth"].person["roles"].indexOf("admin")>-1||e["auth"].person&&e["auth"].person["roles"].indexOf("roomsAdmin")>-1,loading:e.loading.effects["rooms/room-applications/fetch"],selectedRoomId:e["meeting-rooms/meeting-rooms"].selectedRoomId,list:e["rooms/room-applications"].data.list,pagination:e["rooms/room-applications"].data.pagination}}),$((te=function(e){function t(){var e,a;C()(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return a=R()(this,(e=O()(t)).call.apply(e,[this].concat(o))),a.state={roomApplication:null,schoolsOptions:[],schoolsSelectOptions:[],ordering:"",filters:null,filterVisible:!1,filtered:!1,searchText:"",modalTitle:"",modalContent:null,submitButtonText:"",modalVisible:!1,submitting:!1},a.fetchRoomApplications=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.props,n=t.dispatch,o=t.pagination,r=a.state,l=r.ordering,i=r.filters,c=r.searchText;n(e?{type:"rooms/room-applications/fetch",payload:e}:{type:"rooms/room-applications/fetch",payload:w()({search:c,page:o?o.current:1,ordering:l},i)})},a.fetchSchools=function(){var e=a.props.dispatch;e({type:"schools/schools/fetchPublic",payload:{},callback:a.fetchSchoolsCallback})},a.fetchSchoolsCallback=function(e){a.setState({schoolsOptions:K["a"].transferObjectsToFilterOptions(e)}),a.setState({schoolsSelectOptions:K["a"].transferObjectsToSelectOptionsWithoutID(e)})},a.handleTableChange=function(){var e=g()(v.a.mark(function e(t,n,o){var r,l;return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return r=a.state.searchText,l=K["a"].transferSorterToOrdering(o),a.setState({ordering:l,filters:n}),e.next=5,a.fetchRoomApplications(w()({search:r,page:t.current,ordering:l},n));case 5:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.editRoomApplication=g()(v.a.mark(function e(){var t,n,o,r,l,i,c,s,p=arguments;return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:null,n=a.state,o=n.schoolsSelectOptions,r=n.submitting,l=null===t?["\u7533\u8bf7\u6559\u5ba4","\u7533\u8bf7"]:["\u7f16\u8f91\u6559\u5ba4\u7533\u8bf7","\u7f16\u8f91"],i=f()(l,2),c=i[0],s=i[1],e.next=5,a.setState({roomApplication:t?w()({},t,{room:"".concat(t["room_detail"]["fullname"],"(").concat(t["room_detail"]["full_id"],")")}):{}});case 5:return e.next=7,a.setState({modalTitle:c,modalContent:z.a.createElement(L,{roomApplication:a.state.roomApplication,schools:o,title:c,submitButtonText:s,onSubmit:a.onSubmit,submitting:r}),submitButtonText:s,modalVisible:!0});case 7:case"end":return e.stop()}},e)})),a.deleteRoomApplication=function(){var e=g()(v.a.mark(function e(t){var n;return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=a.props.dispatch,n({type:"rooms/room-applications/remove",payload:{roomApplication:t},callback:function(){return a.deleteRoomApplicationCallback(t["name"])}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.deleteRoomApplicationCallback=function(e){d["a"].success("\u6210\u529f\u5220\u9664\u6559\u5ba4\u7533\u8bf7 ".concat(e,"\u3002")),a.fetchRoomApplications()},a.onInputChange=function(e){a.setState({searchText:e.target.value})},a.onRoomApplicationSearch=g()(v.a.mark(function e(){var t,n,o,r;return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=a.state,n=t.ordering,o=t.filters,r=t.searchText,e.next=3,a.fetchRoomApplications(w()({search:r,page:1,ordering:n},o));case 3:a.setState({filterVisible:!1,filtered:!!r});case 4:case"end":return e.stop()}},e)})),a.handleCancel=g()(v.a.mark(function e(){return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({modalVisible:!1,modalContent:null});case 2:case"end":return e.stop()}},e)})),a.onSubmit=function(){var e=g()(v.a.mark(function e(t){var n,o,r,l,i;return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.props,o=n.dispatch,r=n.selectedRoomId,l=a.state.roomApplication,i=w()({},t,{room:"".concat(r)}),console.warn("new values: ",i),e.prev=4,e.next=7,a.setState({submitting:!0});case 7:l&&l["id"]?o({type:"rooms/room-applications/update",payload:{roomApplication:w()({},i)},callback:function(){return a.fetchRoomApplications()}}):o({type:"rooms/room-applications/add",payload:{roomApplication:i},callback:function(){return a.fetchRoomApplications()}}),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](4),console.log(e.t0);case 13:return e.prev=13,e.next=16,a.setState({submitting:!1});case 16:return e.finish(13);case 17:return e.next=19,a.setState({modalVisible:!1,modalContent:null});case 19:case"end":return e.stop()}},e,null,[[4,10,13,17]])}));return function(t){return e.apply(this,arguments)}}(),a.examineRoomApplication=g()(v.a.mark(function e(){var t,n,o,r,l,i,c=arguments;return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:null,n=a.state,o=n.schoolsSelectOptions,r=n.submitting,l="\u5ba1\u6279\u6559\u5ba4",i="\u5ba1\u6279",e.next=5,a.setState({roomApplication:t?w()({},t,{room:"".concat(t["room_detail"]["fullname"],"(").concat(t["room_detail"]["full_id"],")")}):{}});case 5:return e.next=7,a.setState({modalTitle:l,modalContent:z.a.createElement(ae,{roomApplication:a.state.roomApplication,schools:o,title:l,submitButtonText:i,onSubmit:a.onRoomApplicationExamineSubmit,submitting:r}),submitButtonText:i,modalVisible:!0});case 7:case"end":return e.stop()}},e)})),a.onRoomApplicationExamineSubmit=function(){var e=g()(v.a.mark(function e(t){var n,o,r;return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.props.dispatch,o=a.state.roomApplication,r=w()({},t,{approved:!!t["approved"]}),console.warn("new values: ",r),e.prev=4,e.next=7,a.setState({submitting:!0});case 7:n({type:"rooms/room-applications/examine",payload:w()({},t,{id:o.id}),callback:function(){return a.fetchRoomApplications()}}),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](4),console.log(e.t0);case 13:return e.prev=13,e.next=16,a.setState({submitting:!1});case 16:return e.finish(13);case 17:return e.next=19,a.setState({modalVisible:!1,modalContent:null});case 19:case"end":return e.stop()}},e,null,[[4,10,13,17]])}));return function(t){return e.apply(this,arguments)}}(),a}return V()(t,e),k()(t,[{key:"componentDidMount",value:function(){this.fetchRoomApplications(),this.fetchSchools()}},{key:"render",value:function(){var e=this,t=this.props,a=t.isAdminOrIsRoomsAdmin,d=t.list,h=t.pagination,f=t.loading,b=this.state,v=b.schoolsOptions,x=(b.filtered,b.filterVisible,b.modalTitle),g=b.modalContent,E=b.modalVisible;return console.warn("list, pages, loading:",d,h,f),z.a.createElement(q["a"],{title:"\u6559\u5ba4\u7533\u8bf7\u7ba1\u7406"},z.a.createElement(n["a"],{bordered:!1},h&&z.a.createElement(j["a"],null,h.total),z.a.createElement(m["a"],{title:x,visible:E,onCancel:this.handleCancel,footer:null},g||z.a.createElement(u["a"],{spinning:f})),z.a.createElement(p["a"],{type:"primary",onClick:function(){return e.editRoomApplication()}},"\u6559\u5ba4\u7533\u8bf7"),z.a.createElement(B["a"],{dataSource:d,loading:f,rowKey:"id",onChange:this.handleTableChange,pagination:h,width:1400,scroll:{x:1400}},z.a.createElement(ne,{title:"\u4f7f\u7528\u65e5\u671f\u65f6\u95f4",sorter:!0,dataIndex:"datetime",filterDropdown:z.a.createElement("div",{className:"table-input-search"},z.a.createElement(s["a"],{placeholder:"\u540d\u79f0",value:this.state.searchText,onChange:this.onInputChange,onPressEnter:this.onRoomApplicationSearch}),z.a.createElement(p["a"],{type:"primary",onClick:this.onRoomApplicationSearch},"\u68c0\u7d22"))}),z.a.createElement(ne,{title:"\u4f7f\u7528\u65f6\u957f",dataIndex:"hours",sorter:!0}),z.a.createElement(ne,{title:"\u7533\u8bf7\u90e8\u95e8",dataIndex:"school",render:function(e,t){return t["school_detail"]?t["school_detail"]["name"]:""},filters:v}),z.a.createElement(ne,{title:"\u7533\u8bf7\u6559\u5ba4/\u623f\u95f4",dataIndex:"room",render:function(e,t){return t["name"]?t["name"]:t["fullname"]}}),z.a.createElement(ne,{title:"\u6dfb\u52a0\u65f6\u95f4",dataIndex:"created",sorter:!0}),z.a.createElement(ne,{title:"\u4fee\u6539\u65f6\u95f4",dataIndex:"modified",sorter:!0}),z.a.createElement(ne,{title:"\u63d0\u4ea4",dataIndex:"submitted",render:function(e){return e?z.a.createElement(c["a"],{status:"success",text:"\u5df2\u63d0\u4ea4"}):z.a.createElement(c["a"],{status:"error",text:"\u672a\u63d0\u4ea4"})}}),z.a.createElement(ne,{title:"\u7533\u8bf7\u4eba",dataIndex:"person",render:function(e,t){return t["person_detail"]?t["person_detail"]["name"]:t["person"]}}),z.a.createElement(ne,{title:"\u5907\u6ce8",dataIndex:"notes"}),z.a.createElement(ne,{title:"\u5ba1\u6838\u7ed3\u679c",dataIndex:"approved",render:function(e){return!1===e?z.a.createElement(c["a"],{status:"error",text:"\u672a\u901a\u8fc7"}):!0===e?z.a.createElement(c["a"],{status:"success",text:"\u5df2\u901a\u8fc7"}):z.a.createElement(c["a"],{status:"default",text:"\u5f85\u5ba1\u6838"})}}),z.a.createElement(ne,{title:"\u5ba1\u6838\u610f\u89c1",dataIndex:"opinion"}),z.a.createElement(ne,{title:"\u5ba1\u6838\u4eba",dataIndex:"examiner",render:function(e,t){return t["examiner_detail"]?t["examiner_detail"]["name"]:t["examiner"]}}),z.a.createElement(ne,{title:"\u64cd\u4f5c",width:152,fixed:"right",render:function(t,n){return z.a.createElement("div",null,z.a.createElement("a",{onClick:function(){return e.editRoomApplication(n)}},"\u7f16\u8f91"),z.a.createElement("span",{className:"ant-divider"}),z.a.createElement(o["a"],{overlay:z.a.createElement(i["a"],null,a&&z.a.createElement(i["a"].Item,null,z.a.createElement("a",{onClick:function(){return e.examineRoomApplication(n)}},"\u5ba1\u6838")),z.a.createElement(i["a"].Item,null,z.a.createElement(l["a"],{title:"\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f",onConfirm:function(){return e.deleteRoomApplication(n)}},z.a.createElement("a",{href:"#"},"\u5220\u9664"))))},z.a.createElement("a",{className:"ant-dropdown-link"},"\u66f4\u591a ",z.a.createElement(r["a"],{type:"down"}))))}}))))}}]),t}(_["PureComponent"]),ee=te))||ee);t["default"]=oe}}]);