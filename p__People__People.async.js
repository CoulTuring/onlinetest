(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[66],{YXsF:function(e,t,a){"use strict";a.r(t);a("IzEo");var n=a("bx4M"),l=(a("qVdP"),a("jsC+")),r=(a("lUTK"),a("BvKs")),o=(a("Pwec"),a("CtXQ")),c=(a("5NDa"),a("5rEg")),i=(a("+L6B"),a("2/Rp")),s=(a("T2oS"),a("W9HT")),p=(a("2qtc"),a("kLXV")),d=a("qIgq"),u=a.n(d),m=a("d6i3"),h=a.n(m),f=a("1l/V"),b=a.n(f),g=(a("miYZ"),a("tsqr")),y=a("p0pE"),v=a.n(y),x=a("2Taf"),E=a.n(x),w=a("vZ4D"),C=a.n(w),k=a("l4Ni"),S=a.n(k),T=a("ujKo"),P=a.n(T),I=a("MhPg"),q=a.n(I),V=(a("g9YV"),a("wCAj")),z=a("q1tI"),_=a.n(z),B=a("MuoO"),O=a("zHco"),N=a("FkSf"),j=a("Bg+s"),D=(a("y8nQ"),a("Vl3Y")),F=a("d/v1"),Q=a("pJVQ"),Y=a("p9nB"),M=a("WAby"),K=a("Tt/K"),A=function(e){},J=function(e){function t(){var e,a;E()(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return a=S()(this,(e=P()(t)).call.apply(e,[this].concat(l))),a.state={loading:!1},a}return q()(t,e),C()(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.person,a=e.handleSubmit,n=e.submitButtonText,l=e.submitting;return console.log("person? ",t),_.a.createElement("div",null,_.a.createElement(D["a"],{onSubmit:a,layout:"horizontal",className:"modal-form"},_.a.createElement(F["a"],{name:"id",type:"text",size:"default",placeholder:"\u5b66\u53f7\u3001\u8d22\u52a1\u5de5\u53f7\u6216\u4e34\u65f6\u8d26\u53f7",label:"\u5b66\u5de5\u53f7",disabled:!!t&&!!t["id"],required:!0,hasFeedback:!0,validate:[M["g"]],labelCol:{span:6},wrapperCol:{span:18},component:Y["g"]}),_.a.createElement(F["a"],{name:"name",type:"text",size:"default",placeholder:"\u59d3\u540d",label:"\u59d3\u540d",required:!0,hasFeedback:!0,validate:[M["g"]],labelCol:{span:6},wrapperCol:{span:18},component:Y["g"]}),_.a.createElement(F["a"],{name:"gender",type:"text",size:"default",placeholder:"\u6027\u522b",label:"\u6027\u522b",labelCol:{span:6},wrapperCol:{span:18},required:!0,hasFeedback:!0,validate:[M["g"]],options:K["d"],component:Y["d"]}),_.a.createElement(F["a"],{name:"birthdate",type:"date",size:"default",placeholder:"\u51fa\u751f\u65e5\u671f",label:"\u51fa\u751f\u65e5\u671f",labelCol:{span:6},wrapperCol:{span:12,offset:0},component:Y["a"],dateTimeFormat:"YYYY-MM-DD"}),_.a.createElement(F["a"],{name:"nation",type:"text",size:"default",placeholder:"\u6c11\u65cf",label:"\u6c11\u65cf",labelCol:{span:6},wrapperCol:{span:18},required:!0,hasFeedback:!0,validate:[M["g"]],options:K["h"],component:Y["d"]}),_.a.createElement(F["a"],{name:"personid",type:"text",size:"default",placeholder:"\u8eab\u4efd\u8bc1\u53f7",label:"\u8eab\u4efd\u8bc1\u53f7",labelCol:{span:6},wrapperCol:{span:18},component:Y["g"]}),_.a.createElement(F["a"],{name:"cell_number",type:"text",size:"default",placeholder:"\u624b\u673a\u53f7",label:"\u624b\u673a\u53f7",labelCol:{span:6},wrapperCol:{span:18},component:Y["g"]}),_.a.createElement(F["a"],{name:"cell_number2",type:"text",size:"default",placeholder:"\u624b\u673a\u53f72",label:"\u624b\u673a\u53f72",labelCol:{span:6},wrapperCol:{span:18},component:Y["g"]}),_.a.createElement(F["a"],{name:"qq",type:"text",size:"default",placeholder:"QQ\u53f7",label:"QQ\u53f7",labelCol:{span:6},wrapperCol:{span:18},component:Y["g"]}),_.a.createElement(F["a"],{name:"email",type:"text",size:"default",placeholder:"\u7535\u5b50\u90ae\u4ef6",label:"\u7535\u5b50\u90ae\u4ef6",labelCol:{span:6},wrapperCol:{span:18},component:Y["g"]}),_.a.createElement(F["a"],{name:"ccb_card",type:"text",size:"default",placeholder:"\u5efa\u884c\u5361\u53f7",label:"\u5efa\u884c\u5361\u53f7",labelCol:{span:6},wrapperCol:{span:18},component:Y["g"]}),_.a.createElement(F["a"],{name:"abc_card",type:"text",size:"default",placeholder:"\u519c\u884c\u5361\u53f7",label:"\u519c\u884c\u5361\u53f7",labelCol:{span:6},wrapperCol:{span:18},component:Y["g"]}),_.a.createElement(i["a"],{type:"primary",htmlType:"submit",disabled:l,className:"modal-form-button"},n)))}}]),t}(_.a.Component),R=Object(Q["a"])({form:"personForm",validate:A})(J);function U(e,t){var a=t.person;return{initialValues:a,person:t.person,submitButtonText:t.submitButtonText||"\u63d0\u4ea4"}}var X,H,L,W=Object(B["connect"])(U)(R),Z=V["a"].Column,G=(X=Object(B["connect"])(function(e){return{loading:e.loading.effects["people/people/fetch"],list:e["people/people"].data.list,pagination:e["people/people"].data.pagination}}),X((L=function(e){function t(){var e,a;E()(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return a=S()(this,(e=P()(t)).call.apply(e,[this].concat(l))),a.state={person:null,schoolsOptions:[],schoolsSelectOptions:[],ordering:"",filters:null,filterVisible:!1,filtered:!1,searchText:"",modalTitle:"",modalContent:null,submitButtonText:"",modalVisible:!1,submitting:!1},a.fetchPeople=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.props,n=t.dispatch,l=t.pagination,r=a.state,o=r.ordering,c=r.filters,i=r.searchText;n(e?{type:"people/people/fetch",payload:e}:{type:"people/people/fetch",payload:v()({search:i,page:l?l.current:1,ordering:o},c)})},a.fetchSchools=function(){var e=a.props.dispatch;e({type:"schools/schools/fetchPublic",payload:{},callback:a.fetchSchoolsCallback})},a.fetchSchoolsCallback=function(e){a.setState({schoolsOptions:e.map(function(e){return Object.assign({},e,{value:e.name,text:"".concat(e.name,"(").concat(e["full_name"],")")})})}),a.setState({schoolsSelectOptions:e.map(function(e){return Object.assign({},e,{key:e.name,value:e.name,label:"".concat(e.name,"(").concat(e["full_name"],")")})})})},a.handleExcelUpload=function(e){console.warn(e);var t=[];e.forEach(function(e){t.push({id:e["\u5b66\u53f7"],name:e["\u59d3\u540d"],password:e["\u5bc6\u7801"],nation:e["\u6c11\u65cf"]?parseInt(e["\u6c11\u65cf"]):1,majorClass:e["\u73ed\u7ea7"],gender:e["\u6027\u522b"],personId:e["\u8eab\u4efd\u8bc1\u53f7"],political:e["\u653f\u6cbb\u9762\u8c8c"],highSchool:e["\u6bd5\u4e1a\u9ad8\u4e2d"],year:e["\u5165\u5b66\u5e74\u4efd"],homePlace:e["\u7c4d\u8d2f"],address:e["\u8054\u7cfb\u5730\u5740"],zipcode:e["\u90ae\u653f\u7f16\u7801"],contactName:e["\u6536\u4ef6\u4eba"],contactNumber:e["\u8054\u7cfb\u7535\u8bdd"],mobileNumber:e["\u624b\u673a\u53f7"],qq:e["qq"],email:e["email"],gaokaoNumber:e["\u9ad8\u8003\u8003\u751f\u53f7"]})}),console.log(t),a.props.dispatch({type:"people/people/bulkImport",payload:{people:t},callback:a.displayResult})},a.displayResult=function(e){console.log(e),g["a"].success(e["detail"])},a.handleTableChange=function(){var e=b()(h.a.mark(function e(t,n,l){var r,o;return h.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return r=a.state.searchText,o=0===Object.keys(l).length?void 0:"ascend"===l.order?"".concat(l.field):"-".concat(l.field),a.setState({ordering:o,filters:n}),e.next=5,a.fetchPeople(v()({search:r,page:t.current,ordering:o},n));case 5:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.editPerson=b()(h.a.mark(function e(){var t,n,l,r,o,c,i=arguments;return h.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:null,n=a.state.submitting,l=null===t?["\u521b\u5efa\u4eba\u5458","\u521b\u5efa"]:["\u7f16\u8f91\u4eba\u5458","\u7f16\u8f91"],r=u()(l,2),o=r[0],c=r[1],e.next=5,a.setState({person:t});case 5:return e.next=7,a.setState({modalTitle:o,modalContent:_.a.createElement(W,{person:a.state.person,title:o,submitButtonText:c,onSubmit:a.onSubmit,submitting:n}),submitButtonText:c,modalVisible:!0});case 7:case"end":return e.stop()}},e)})),a.deletePerson=function(){var e=b()(h.a.mark(function e(t){var n;return h.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=a.props.dispatch,p["a"].confirm({title:"\u60a8\u786e\u8ba4\u8981\u5220\u9664\u5e94\u7528\u4eba\u5458 ".concat(t["name"]," \u5417?"),content:"\u5220\u9664\u540e\u5c06\u4e0d\u53ef\u6062\u590d\uff0c\u5176\u76f8\u5173\u6570\u636e\u3001\u4fe1\u606f\u4e5f\u5c06\u4e00\u5e76\u5220\u9664\u3002",onOk:function(){var e=b()(h.a.mark(function e(){return h.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n({type:"people/people/remove",payload:{person:t},callback:function(){return a.fetchPeople()}}),g["a"].success("\u6210\u529f\u5220\u9664\u4eba\u5458 ".concat(t["name"],"\u3002"));case 2:case"end":return e.stop()}},e)}));function l(){return e.apply(this,arguments)}return l}(),onCancel:function(){}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.onInputChange=function(e){a.setState({searchText:e.target.value})},a.onPersonSearch=b()(h.a.mark(function e(){var t,n,l,r;return h.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=a.state,n=t.ordering,l=t.filters,r=t.searchText,e.next=3,a.fetchPeople(v()({search:r,page:1,ordering:n},l));case 3:a.setState({filterVisible:!1,filtered:!!r});case 4:case"end":return e.stop()}},e)})),a.handleCancel=b()(h.a.mark(function e(){return h.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({modalVisible:!1,modalContent:null});case 2:case"end":return e.stop()}},e)})),a.onSubmit=function(){var e=b()(h.a.mark(function e(t){var n,l,r;return h.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.props.dispatch,l=a.state.person,r=v()({},t),e.prev=3,e.next=6,a.setState({submitting:!0});case 6:l&&l["id"]?n({type:"people/people/update",payload:{person:v()({},r)},callback:function(){return a.fetchPeople()}}):n({type:"people/people/add",payload:{person:r},callback:function(){return a.fetchPeople()}}),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](3),console.log(e.t0);case 12:return e.prev=12,e.next=15,a.setState({submitting:!1});case 15:return e.finish(12);case 16:return e.next=18,a.setState({modalVisible:!1,modalContent:null});case 18:case"end":return e.stop()}},e,null,[[3,9,12,16]])}));return function(t){return e.apply(this,arguments)}}(),a}return q()(t,e),C()(t,[{key:"componentDidMount",value:function(){this.fetchPeople(),this.fetchSchools()}},{key:"render",value:function(){var e=this,t=this.props,a=t.list,d=t.pagination,u=t.loading,m=this.state,h=m.filtered,f=m.filterVisible,b=m.modalTitle,g=m.modalContent,y=m.modalVisible;return console.warn("list, pages, loading:",a,d,u),_.a.createElement(O["a"],{title:"\u4eba\u5458\u7ba1\u7406"},_.a.createElement(n["a"],{bordered:!1},d&&_.a.createElement(N["a"],null,d.total),_.a.createElement(p["a"],{title:b,visible:y,onCancel:this.handleCancel,footer:null},g||_.a.createElement(s["a"],{spinning:u})),_.a.createElement(i["a"],{type:"primary",onClick:function(){return e.editPerson()}},"\u65b0\u5efa\u4eba\u5458"),_.a.createElement(j["a"],{uploadButtonText:"\u4eba\u5458\u6279\u91cf\u4e0a\u4f20",handleSubmit:this.handleExcelUpload,isButton:!0}),_.a.createElement(V["a"],{dataSource:a,loading:u,rowKey:"id",onChange:this.handleTableChange,pagination:d,width:1e3,scroll:{x:1e3}},_.a.createElement(Z,{title:"\u7f16\u53f7",dataIndex:"id",sorter:!0}),_.a.createElement(Z,{title:"\u59d3\u540d",dataIndex:"name",filterDropdown:_.a.createElement("div",{className:"table-input-search"},_.a.createElement(c["a"],{placeholder:"\u59d3\u540d(\u5b66\u53f7)",value:this.state.searchText,onChange:this.onInputChange,onPressEnter:this.onPersonSearch}),_.a.createElement(i["a"],{type:"primary",onClick:this.onPersonSearch},"\u68c0\u7d22")),filterIcon:_.a.createElement(o["a"],{type:"search",style:{color:h?"#108ee9":"#aaa"}}),filterDropdownVisible:f,onFilterDropdownVisibleChange:function(t){e.setState({filterVisible:t})}}),_.a.createElement(Z,{title:"\u6027\u522b",dataIndex:"gender",key:"gender",render:function(e,t){return t["get_gender_display"]}}),_.a.createElement(Z,{title:"\u51fa\u751f\u65e5\u671f",dataIndex:"birthdate",key:"birthdate",sorter:!0}),_.a.createElement(Z,{title:"\u6c11\u65cf",dataIndex:"nation",key:"nation",render:function(e,t){return t["get_nation_display"]}}),_.a.createElement(Z,{title:"\u8eab\u4efd\u8bc1\u53f7",dataIndex:"personid",key:"personid"}),_.a.createElement(Z,{title:"\u624b\u673a\u53f7",dataIndex:"cell_number",key:"cell_number"}),_.a.createElement(Z,{title:"QQ",dataIndex:"qq",key:"qq"}),_.a.createElement(Z,{title:"Email",dataIndex:"email",key:"email"}),_.a.createElement(Z,{title:"\u5efa\u884c\u5361\u53f7",dataIndex:"ccb_card",key:"ccb_card"}),_.a.createElement(Z,{title:"\u519c\u884c\u5361\u53f7",dataIndex:"abc_card",key:"abc_card"}),_.a.createElement(Z,{title:"\u64cd\u4f5c",width:152,fixed:"right",render:function(t,a){return _.a.createElement("div",null,_.a.createElement("a",{onClick:function(){return e.editPerson(a)}},"\u7f16\u8f91"),_.a.createElement("span",{className:"ant-divider"}),_.a.createElement(l["a"],{overlay:_.a.createElement(r["a"],null,_.a.createElement(r["a"].Item,null,_.a.createElement("a",{onClick:function(){return e.deletePerson(a)}},"\u5220\u9664")))},_.a.createElement("a",{className:"ant-dropdown-link"},"\u66f4\u591a ",_.a.createElement(o["a"],{type:"down"}))))}}))))}}]),t}(z["PureComponent"]),H=L))||H);t["default"]=G}}]);