(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[116],{XOW7:function(e,t,a){"use strict";a.r(t);a("IzEo");var n=a("bx4M"),r=(a("qVdP"),a("jsC+")),s=(a("lUTK"),a("BvKs")),o=(a("P2fV"),a("NJEC")),l=(a("Pwec"),a("CtXQ")),i=(a("5NDa"),a("5rEg")),c=(a("7Kak"),a("9yH6")),m=(a("2qtc"),a("kLXV")),u=(a("T2oS"),a("W9HT")),p=(a("+L6B"),a("2/Rp")),d=(a("miYZ"),a("tsqr")),f=a("d6i3"),g=a.n(f),h=a("1l/V"),b=a.n(h),w=a("p0pE"),v=a.n(w),E=a("2Taf"),k=a.n(E),y=a("vZ4D"),M=a.n(y),x=a("l4Ni"),C=a.n(x),O=a("ujKo"),S=a.n(O),j=a("MhPg"),T=a.n(j),V=a("Y/ft"),F=a.n(V),P=(a("g9YV"),a("wCAj")),I=a("q1tI"),B=a.n(I),D=a("MuoO"),N=a("LLXN"),z=a("34ay"),A=a("D1pA"),K=a("zHco"),W=a("FkSf"),_=(a("y8nQ"),a("Vl3Y")),q=a("gWZ8"),J=a.n(q),L=a("d/v1"),X=a("pJVQ"),Y=a("p9nB"),Z=a("WAby"),H=a("6NK7"),Q=function(e){},U=function(e){function t(){var e,a;k()(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return a=C()(this,(e=S()(t)).call.apply(e,[this].concat(r))),a.state={peopleOptions:[],selectedPeople:[],loading:!1},a.handleSelect=function(){var e=b()(g.a.mark(function e(t){return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({selectedPeople:a.state.selectedPeople.concat(a.state.peopleOptions.filter(function(e){return e.id===t}))});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.handleDeselect=function(){var e=b()(g.a.mark(function e(t){return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({selectedPeople:a.state.selectedPeople.filter(function(e){return e.id!==t})});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.searchPeople=function(e){var t=a.props.dispatch,n=a.state.personSchools;a.setState({loading:!0}),t({type:"people/people/search",payload:{person:e,school:n},callback:a.searchPeopleCallback})},a.searchPeopleCallback=function(e){var t=H["a"].transferObjectsToSelectOptions(e),n=H["a"].transferPeopleToOptionsWithName(e);a.state.selectedPeople.forEach(function(e){return t.findIndex(function(t){return t.id===e.id})<0&&t.push(e)}),a.setState({peopleOptions:t,recorderOptions:n,loading:!1})},a}return T()(t,e),M()(t,[{key:"componentDidMount",value:function(){this.props.message;var e=Object(z["b"])(),t=J()(e["worknotes_app_schools"]);this.setState({personSchools:t.map(function(e){return e.id})})}},{key:"render",value:function(){var e=this.props,t=e.handleSubmit,a=e.submitButtonText,n=e.submitting,r=this.state,s=r.peopleOptions,o=r.loading;return B.a.createElement("div",null,B.a.createElement(_["a"],{onSubmit:t,layout:"horizontal",className:"modal-form"},B.a.createElement(L["a"],{name:"recipients",label:Object(N["formatMessage"])({id:"app.worknotes.messages.recipients"}),size:"default",labelCol:{span:6},wrapperCol:{span:18},options:s,defaultValue:[],mode:"multiple",filterOption:!1,onFocus:this.searchPeople,onSearch:this.searchPeople,onSelect:this.handleSelect,onDeselect:this.handleDeselect,notFoundContent:o?B.a.createElement(u["a"],{size:"small"}):null,component:Y["d"]}),B.a.createElement(L["a"],{name:"title",type:"text",size:"default",placeholder:"",label:Object(N["formatMessage"])({id:"common.title"}),hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:Y["g"]}),B.a.createElement(L["a"],{name:"content",type:"text",size:"default",placeholder:"",label:Object(N["formatMessage"])({id:"common.content"}),required:!0,hasFeedback:!0,validate:[Z["g"]],labelCol:{span:6},wrapperCol:{span:18},rows:4,component:Y["f"]}),B.a.createElement(p["a"],{type:"primary",htmlType:"submit",disabled:n,className:"modal-form-button"},a)))}}]),t}(B.a.Component),G=Object(X["a"])({form:"messageForm",validate:Q})(U);function R(e,t){var a=t.message;return{initialValues:a,message:t.message,submitButtonText:t.submitButtonText||Object(N["formatMessage"])({id:"common.submit"})}}var $,ee,te,ae=Object(D["connect"])(R)(G),ne=a("X3JL"),re=(a("/OaA"),a("fUsW"),a("cZFU"),P["a"].Column),se=function(e){var t=e.msg,a=(e.children,F()(e,["msg","children"]));return B.a.createElement("div",a,t["content"])},oe=($=Object(D["connect"])(function(e){return{loading:e.loading.effects["worknotes/messages/fetch"],list:e["worknotes/messages"].data.list,pagination:e["worknotes/messages"].data.pagination}}),$((te=function(e){function t(){var e,a;k()(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return a=C()(this,(e=S()(t)).call.apply(e,[this].concat(r))),a.state={msg:null,category:"unread",ordering:"",filters:null,filterVisible:!1,filtered:!1,searchText:"",modalTitle:"",modalContent:null,modalFooter:null,submitButtonText:"",modalVisible:!1,submitting:!1},a.fetchMessages=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.props,n=t.dispatch,r=t.pagination,s=a.state,o=s.category,l=s.ordering,i=s.filters,c=s.searchText;n(e?{type:"worknotes/messages/fetch",payload:e}:{type:"worknotes/messages/fetch",payload:v()({category:o,search:c,page:r?r.current:1,ordering:l},i)})},a.handleTableChange=function(){var e=b()(g.a.mark(function e(t,n,r){var s,o,l,i;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return s=a.state,o=s.category,l=s.searchText,i=H["a"].transferSorterToOrdering(r),e.next=4,a.fetchMessages(v()({category:o,search:l,page:t.current,ordering:i},n));case 4:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.createMessage=b()(g.a.mark(function e(){var t,n,r,s,o,l=arguments;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=l.length>0&&void 0!==l[0]?l[0]:null,n=a.state.submitting,r=[Object(N["formatMessage"])({id:"operations.create"},{name:Object(N["formatMessage"])({id:"app.worknotes.message"})}),Object(N["formatMessage"])({id:"common.create"})],s=r[0],o=r[1],e.next=5,a.setState({modalTitle:s,modalContent:B.a.createElement(ae,{message:t,title:s,submitButtonText:o,onSubmit:a.onSubmit,submitting:n}),submitButtonText:o,modalVisible:!0});case 5:case"end":return e.stop()}},e)})),a.deleteMessage=function(){var e=b()(g.a.mark(function e(t){var n;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=a.props.dispatch,n({type:"worknotes/messages/remove",payload:{msg:t},callback:function(){return a.deleteMessageCallback(t["title"])}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.deleteMessageCallback=function(e){d["a"].success("".concat(Object(N["formatMessage"])({id:"operations.success-delete"},{name:Object(N["formatMessage"])({id:"app.worknotes.messages"})})," ").concat(e)),a.fetchMessages()},a.onInputChange=function(e){a.setState({searchText:e.target.value})},a.onMessageSearch=b()(g.a.mark(function e(){var t,n,r,s;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=a.state,n=t.ordering,r=t.filters,s=t.searchText,e.next=3,a.fetchMessages(v()({search:s,page:1,ordering:n},r));case 3:a.setState({filterVisible:!1,filtered:!!s});case 4:case"end":return e.stop()}},e)})),a.handleCancel=b()(g.a.mark(function e(){return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({modalVisible:!1,modalContent:null,modalFooter:null});case 2:case"end":return e.stop()}},e)})),a.onSubmit=function(){var e=b()(g.a.mark(function e(t){var n,r;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=a.props.dispatch,a.state.msg,r=v()({},t,{visible:!!t["visible"]}),console.warn("new values: ",r),e.prev=4,n({type:"worknotes/messages/add",payload:{message:r},callback:function(){return a.onSubmitCallback("".concat(Object(N["formatMessage"])({id:"operations.success-create"},{name:Object(N["formatMessage"])({id:"app.worknotes.messages"})})))}}),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](4),console.log(e.t0);case 11:return e.prev=11,e.next=14,a.setState({submitting:!1});case 14:return e.finish(11);case 15:return e.next=17,a.setState({modalVisible:!1,modalContent:null,modalFooter:null});case 17:case"end":return e.stop()}},e,null,[[4,8,11,15]])}));return function(t){return e.apply(this,arguments)}}(),a.onCategoryChange=function(){var e=b()(g.a.mark(function e(t){var n;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=t.target.value,e.next=3,a.setState({category:n});case 3:a.fetchMessages();case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.showMessage=function(){var e=b()(g.a.mark(function e(t){var n,r;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.state.category,console.warn("message: ",t,t["title"]),r=a.props.dispatch,"unread"===n&&r({type:"worknotes/messages/read",payload:{messageId:t["id"]}}),e.next=6,a.setState({modalTitle:t["title"],modalContent:B.a.createElement(se,{msg:t}),modalFooter:[B.a.createElement(p["a"],{key:"ok",size:"default",onClick:a.handleCancel},"\u786e\u5b9a")],submitButtonText:"",modalVisible:!0});case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return T()(t,e),M()(t,[{key:"componentDidMount",value:function(){this.fetchMessages()}},{key:"onSubmitCallback",value:function(e){d["a"].success(e),this.fetchMessages()}},{key:"render",value:function(){var e=this,t=this.props,a=t.list,d=t.pagination,f=t.loading,g=this.state,h=g.category,b=g.filtered,w=g.filterVisible,v=g.modalTitle,E=g.modalContent,k=g.modalFooter,y=g.modalVisible;return console.warn("list, pages, loading:",a,d,f),B.a.createElement(K["a"],{title:Object(N["formatMessage"])({id:"operations.management"},{name:Object(N["formatMessage"])({id:"app.worknotes.messages"})})},B.a.createElement(n["a"],{bordered:!1},d&&B.a.createElement(W["a"],null,d.total),B.a.createElement(m["a"],{title:v,visible:y,onCancel:this.handleCancel,footer:k||null},E||B.a.createElement(u["a"],{spinning:f})),B.a.createElement(c["a"].Group,{onChange:this.onCategoryChange,defaultValue:"unread",buttonStyle:"solid"},B.a.createElement(c["a"].Button,{value:"unread"},B.a.createElement(N["FormattedMessage"],{id:"app.worknotes.messages.unread"})),B.a.createElement(c["a"].Button,{value:"sent"},B.a.createElement(N["FormattedMessage"],{id:"app.worknotes.messages.sent"})),B.a.createElement(c["a"].Button,{value:"received"},B.a.createElement(N["FormattedMessage"],{id:"app.worknotes.messages.received"})),Object(z["f"])()&&B.a.createElement(c["a"].Button,{value:"all"},B.a.createElement(N["FormattedMessage"],{id:"app.worknotes.messages.all"}))),B.a.createElement("span",null,"\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0"),B.a.createElement(p["a"],{type:"primary",onClick:function(){return e.createMessage()}},B.a.createElement(N["FormattedMessage"],{id:"operations.create",values:{name:Object(N["formatMessage"])({id:"app.worknotes.message"})}})),B.a.createElement(ne["a"],null),B.a.createElement(P["a"],{dataSource:a,loading:f,rowKey:"id",onChange:this.handleTableChange,pagination:d,width:1e3,scroll:{x:1e3}},"/>",B.a.createElement(re,{title:"",width:40,dataIndex:"id",render:function(e,t){var a=t["receipts_detail"];if("unread"===h)return B.a.createElement(A["a"],{name:"envelope"});if("sent"===h)return a.findIndex(function(e){return!e["read"]})>=0?(console.warn(1),B.a.createElement(A["a"],{name:"envelope"})):(console.warn(2),B.a.createElement(A["a"],{name:"envelope open outline"}));if("received"===h){var n=a.find(function(e){return e["recipient"]===Object(z["b"])()["id"]});return n&&n["read"]?B.a.createElement(A["a"],{name:"envelope open outline"}):B.a.createElement(A["a"],{name:"envelope"})}return a.findIndex(function(e){return!e["read"]})>=0?B.a.createElement(A["a"],{name:"envelope"}):B.a.createElement(A["a"],{name:"envelope open outline"})}}),B.a.createElement(re,{width:120,title:Object(N["formatMessage"])({id:"app.worknotes.messages.sentDatetime"}),dataIndex:"created"}),B.a.createElement(re,{width:120,title:Object(N["formatMessage"])({id:"app.worknotes.messages.sender"}),dataIndex:"sender_detail",render:function(e){return e&&e["name"]}}),B.a.createElement(re,{width:120,title:Object(N["formatMessage"])({id:"app.worknotes.messages.recipients"}),dataIndex:"receipts_detail",render:function(e){return e&&e.map(function(e,t){return B.a.createElement("span",{key:t},e["recipient_detail"]["name"],"      ")})}}),B.a.createElement(re,{title:Object(N["formatMessage"])({id:"common.title"}),dataIndex:"title",filterDropdown:B.a.createElement("div",{className:"table-input-search"},B.a.createElement(i["a"],{placeholder:Object(N["formatMessage"])({id:"common.title"}),value:this.state.searchText,onChange:this.onInputChange,onPressEnter:this.onMessageSearch}),B.a.createElement(p["a"],{type:"primary",onClick:this.onMessageSearch},B.a.createElement(N["FormattedMessage"],{id:"common.search"}))),filterIcon:B.a.createElement(l["a"],{type:"search",style:{color:b?"#108ee9":"#aaa"}}),filterDropdownVisible:w,onFilterDropdownVisibleChange:function(t){e.setState({filterVisible:t})}}),B.a.createElement(re,{title:Object(N["formatMessage"])({id:"common.content"}),dataIndex:"content"}),B.a.createElement(re,{title:Object(N["formatMessage"])({id:"common.operations"}),width:152,fixed:"right",render:function(t,a){return B.a.createElement("div",null,B.a.createElement("a",{onClick:function(){return e.showMessage(a)}}," ",Object(N["formatMessage"])({id:"common.show"})),B.a.createElement("span",{className:"ant-divider"}),B.a.createElement(r["a"],{overlay:B.a.createElement(s["a"],null,B.a.createElement(s["a"].Item,null,B.a.createElement(o["a"],{title:Object(N["formatMessage"])({id:"common.delete-ask"}),onConfirm:function(){return e.deleteMessage(a)}},B.a.createElement("a",{href:"#"},B.a.createElement(N["FormattedMessage"],{id:"common.delete"})))))},B.a.createElement("a",{className:"ant-dropdown-link"},B.a.createElement(N["FormattedMessage"],{id:"common.more"})," ",B.a.createElement(l["a"],{type:"down"}))))}}))))}}]),t}(I["PureComponent"]),ee=te))||ee);t["default"]=oe}}]);