(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[84],{qxp2:function(e,t,a){"use strict";a.r(t);a("IzEo");var n=a("bx4M"),l=(a("qVdP"),a("jsC+")),r=(a("lUTK"),a("BvKs")),o=(a("P2fV"),a("NJEC")),i=(a("Pwec"),a("CtXQ")),c=(a("5NDa"),a("5rEg")),s=(a("+L6B"),a("2/Rp")),p=(a("2qtc"),a("kLXV")),f=(a("T2oS"),a("W9HT")),d=(a("miYZ"),a("tsqr")),u=a("qIgq"),h=a.n(u),m=a("d6i3"),b=a.n(m),v=a("1l/V"),g=a.n(v),C=a("p0pE"),x=a.n(C),E=a("2Taf"),y=a.n(E),w=a("vZ4D"),k=a.n(w),S=a("l4Ni"),O=a.n(S),T=a("ujKo"),I=a.n(T),V=a("MhPg"),z=a.n(V),F=(a("g9YV"),a("wCAj")),q=a("q1tI"),B=a.n(q),N=a("MuoO"),_=a("zHco"),j=a("FkSf"),D=(a("y8nQ"),a("Vl3Y")),K=a("d/v1"),P=a("pJVQ"),M=a("p9nB"),A=a("WAby"),J=a("Tt/K"),Q=function(e){},W=function(e){function t(){var e,a;y()(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return a=O()(this,(e=I()(t)).call.apply(e,[this].concat(l))),a.state={loading:!1},a}return z()(t,e),k()(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.office,a=e.schools,n=e.handleSubmit,l=e.submitButtonText,r=e.submitting;return B.a.createElement("div",null,B.a.createElement(D["a"],{onSubmit:n,layout:"horizontal",className:"modal-form"},B.a.createElement(K["a"],{name:"school",label:"\u90e8\u95e8\uff08\u5b66\u9662\uff09",size:"default",labelCol:{span:6},wrapperCol:{span:18},options:a,disabled:!!t&&!!t["id"],onSelect:this.handleSchoolSelect,required:!0,hasFeedback:!0,validate:[A["g"]],component:M["d"]}),B.a.createElement(K["a"],{name:"id",type:"text",size:"default",placeholder:"\u529e\u516c\u5ba4\u7f16\u53f7",label:"\u7f16\u53f7",disabled:!!t&&!!t["id"],required:!0,hasFeedback:!0,validate:[A["g"]],labelCol:{span:6},wrapperCol:{span:18},component:M["g"]}),B.a.createElement(K["a"],{name:"name",type:"text",size:"default",placeholder:"\u529e\u516c\u5ba4\u7b80\u79f0",label:"\u7b80\u79f0",required:!0,hasFeedback:!0,validate:[A["g"]],labelCol:{span:6},wrapperCol:{span:18},component:M["g"]}),B.a.createElement(K["a"],{name:"full_name",type:"text",size:"default",placeholder:"\u529e\u516c\u5ba4\u5168\u79f0",label:"\u5168\u79f0",required:!0,hasFeedback:!0,validate:[A["g"]],labelCol:{span:6},wrapperCol:{span:18},component:M["g"]}),B.a.createElement(K["a"],{name:"description",type:"text",size:"default",placeholder:"\u63cf\u8ff0\u529e\u516c\u5ba4\u7684\u5177\u4f53\u804c\u8d23",label:"\u804c\u8d23",labelCol:{span:6},wrapperCol:{span:18},component:M["g"]}),B.a.createElement(K["a"],{name:"level",type:"text",size:"default",placeholder:"\u7ea7\u522b",label:"\u7ea7\u522b",labelCol:{span:6},wrapperCol:{span:18},required:!0,hasFeedback:!0,validate:[A["g"]],options:J["i"],component:M["d"]}),B.a.createElement(K["a"],{name:"phone",type:"text",size:"default",placeholder:"",label:"\u7535\u8bdd",hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:M["g"]}),B.a.createElement(K["a"],{name:"internal_phone",type:"text",size:"default",placeholder:"",label:"\u5185\u7ebf\u7535\u8bdd",hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:M["g"]}),B.a.createElement(K["a"],{name:"fax",type:"text",size:"default",placeholder:"",label:"\u4f20\u771f",hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:M["g"]}),B.a.createElement(K["a"],{name:"email",type:"text",size:"default",placeholder:"",label:"\u7535\u5b50\u90ae\u7bb1",hasFeedback:!0,validate:[A["b"]],labelCol:{span:6},wrapperCol:{span:18},component:M["g"]}),B.a.createElement(K["a"],{name:"visible",label:"\u53ef\u89c1\u7a0b\u5ea6",size:"default",labelCol:{span:6},wrapperCol:{span:18},defaultChecked:!0,checkedChildren:"\u53ef\u89c1",unCheckedChildren:"\u9690\u85cf",component:M["e"]}),B.a.createElement(s["a"],{type:"primary",htmlType:"submit",disabled:r,className:"modal-form-button"},l)))}}]),t}(B.a.Component),Y=Object(P["a"])({form:"officeForm",validate:Q})(W);function H(e,t){var a=t.office;return{initialValues:a,office:t.office,submitButtonText:t.submitButtonText||"\u63d0\u4ea4"}}var L,X,Z,R=Object(N["connect"])(H)(Y),U=a("KrTs"),G=a("6NK7"),$=F["a"].Column,ee=(L=Object(N["connect"])(function(e){return{loading:e.loading.effects["schools/offices/fetch"],list:e["schools/offices"].data.list,pagination:e["schools/offices"].data.pagination}}),L((Z=function(e){function t(){var e,a;y()(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return a=O()(this,(e=I()(t)).call.apply(e,[this].concat(l))),a.state={office:null,schoolsOptions:[],schoolsSelectOptions:[],ordering:"",filters:null,filterVisible:!1,filtered:!1,searchText:"",modalTitle:"",modalContent:null,submitButtonText:"",modalVisible:!1,submitting:!1},a.fetchOffices=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.props,n=t.dispatch,l=t.pagination,r=a.state,o=r.ordering,i=r.filters,c=r.searchText;n(e?{type:"schools/offices/fetch",payload:e}:{type:"schools/offices/fetch",payload:x()({search:c,page:l?l.current:1,ordering:o},i)})},a.fetchSchools=function(){var e=a.props.dispatch;e({type:"schools/schools/fetchPublic",payload:{},callback:a.fetchSchoolsCallback})},a.fetchSchoolsCallback=function(e){a.setState({schoolsOptions:G["a"].transferObjectsToFilterOptions(e)}),a.setState({schoolsSelectOptions:G["a"].transferObjectsToSelectOptionsWithoutID(e)})},a.handleTableChange=function(){var e=g()(b.a.mark(function e(t,n,l){var r,o;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return r=a.state.searchText,o=G["a"].transferSorterToOrdering(l),a.setState({ordering:o,filters:n}),e.next=5,a.fetchOffices(x()({search:r,page:t.current,ordering:o},n));case 5:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.editOffice=g()(b.a.mark(function e(){var t,n,l,r,o,i,c,s,p=arguments;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:null,n=a.state,l=n.schoolsSelectOptions,r=n.submitting,o=null===t?["\u521b\u5efa\u529e\u516c\u5ba4","\u521b\u5efa"]:["\u7f16\u8f91\u529e\u516c\u5ba4","\u7f16\u8f91"],i=h()(o,2),c=i[0],s=i[1],e.next=5,a.setState({office:t});case 5:return e.next=7,a.setState({modalTitle:c,modalContent:B.a.createElement(R,{office:a.state.office,schools:l,title:c,submitButtonText:s,onSubmit:a.onSubmit,submitting:r}),submitButtonText:s,modalVisible:!0});case 7:case"end":return e.stop()}},e)})),a.deleteOffice=function(){var e=g()(b.a.mark(function e(t){var n;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=a.props.dispatch,n({type:"schools/offices/remove",payload:{office:t},callback:function(){return a.deleteOfficeCallback(t["fullname"])}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.deleteOfficeCallback=function(e){d["a"].success("\u6210\u529f\u5220\u9664\u623f\u95f4 ".concat(e,"\u3002")),a.fetchOffices()},a.onInputChange=function(e){a.setState({searchText:e.target.value})},a.onOfficeSearch=g()(b.a.mark(function e(){var t,n,l,r;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=a.state,n=t.ordering,l=t.filters,r=t.searchText,e.next=3,a.fetchOffices(x()({search:r,page:1,ordering:n},l));case 3:a.setState({filterVisible:!1,filtered:!!r});case 4:case"end":return e.stop()}},e)})),a.handleCancel=g()(b.a.mark(function e(){return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({modalVisible:!1,modalContent:null});case 2:case"end":return e.stop()}},e)})),a.onSubmit=function(){var e=g()(b.a.mark(function e(t){var n,l,r;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.props.dispatch,l=a.state.office,r=x()({},t,{visible:!!t["visible"]}),e.prev=3,e.next=6,a.setState({submitting:!0});case 6:l&&l["id"]?n({type:"schools/offices/update",payload:{office:x()({},r)},callback:function(){return a.fetchOffices()}}):n({type:"schools/offices/add",payload:{office:r},callback:function(){return a.fetchOffices()}}),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](3),console.log(e.t0);case 12:return e.prev=12,e.next=15,a.setState({submitting:!1});case 15:return e.finish(12);case 16:return e.next=18,a.setState({modalVisible:!1,modalContent:null});case 18:case"end":return e.stop()}},e,null,[[3,9,12,16]])}));return function(t){return e.apply(this,arguments)}}(),a}return z()(t,e),k()(t,[{key:"componentDidMount",value:function(){this.fetchOffices(),this.fetchSchools()}},{key:"render",value:function(){var e=this,t=this.props,a=t.list,d=t.pagination,u=t.loading,h=this.state,m=h.schoolsOptions,b=h.filtered,v=h.filterVisible,g=h.modalTitle,C=h.modalContent,x=h.modalVisible;return B.a.createElement(_["a"],{title:"\u529e\u516c\u5ba4\u7ba1\u7406"},B.a.createElement(n["a"],{bordered:!1},d&&B.a.createElement(j["a"],null,d.total),B.a.createElement(p["a"],{title:g,visible:x,onCancel:this.handleCancel,footer:null},C||B.a.createElement(f["a"],{spinning:u})),B.a.createElement(s["a"],{type:"primary",onClick:function(){return e.editOffice()}},"\u65b0\u5efa\u529e\u516c\u5ba4"),B.a.createElement(F["a"],{dataSource:a,loading:u,rowKey:"id",onChange:this.handleTableChange,pagination:d,width:1e3,scroll:{x:1e3}},B.a.createElement($,{title:"\u7f16\u53f7",dataIndex:"id",sorter:!0}),B.a.createElement($,{title:"\u540d\u79f0",dataIndex:"name",filterDropdown:B.a.createElement("div",{className:"table-input-search"},B.a.createElement(c["a"],{placeholder:"\u540d\u79f0(\u4e2d\u82f1\u6587)",value:this.state.searchText,onChange:this.onInputChange,onPressEnter:this.onOfficeSearch}),B.a.createElement(s["a"],{type:"primary",onClick:this.onOfficeSearch},"\u68c0\u7d22")),filterIcon:B.a.createElement(i["a"],{type:"search",style:{color:b?"#108ee9":"#aaa"}}),filterDropdownVisible:v,onFilterDropdownVisibleChange:function(t){e.setState({filterVisible:t})}}),B.a.createElement($,{title:"\u5168\u79f0",dataIndex:"full_name",key:"full_name"}),B.a.createElement($,{title:"\u90e8\u95e8/\u5b66\u9662",dataIndex:"school",filters:m,sorter:!0,render:function(e,t){return t["school_detail"]["full_name"]}}),B.a.createElement($,{title:"\u804c\u8d23",dataIndex:"description",render:function(e,t){return t["description"]},width:200}),B.a.createElement($,{title:"\u7ea7\u522b",dataIndex:"level",key:"level",render:function(e,t){return t["get_level_display"]}}),B.a.createElement($,{title:"\u7535\u8bdd",dataIndex:"phone"}),B.a.createElement($,{title:"\u7535\u5b50\u90ae\u7bb1",dataIndex:"email"}),B.a.createElement($,{title:"\u5185\u7ebf",dataIndex:"internal_phone"}),B.a.createElement($,{title:"\u4f20\u771f",dataIndex:"fax"}),B.a.createElement($,{title:"\u6709\u6548\u6027",dataIndex:"visible",key:"visible",render:function(e){return e?B.a.createElement(U["a"],{status:"success",text:"\u6709\u6548"}):B.a.createElement(U["a"],{status:"error",text:"\u5931\u6548"})}}),B.a.createElement($,{title:"\u64cd\u4f5c",width:152,fixed:"right",render:function(t,a){return B.a.createElement("div",null,B.a.createElement("a",{onClick:function(){return e.editOffice(a)}},"\u7f16\u8f91"),B.a.createElement("span",{className:"ant-divider"}),B.a.createElement(l["a"],{overlay:B.a.createElement(r["a"],null,B.a.createElement(r["a"].Item,null,B.a.createElement(o["a"],{title:"\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f",onConfirm:function(){return e.deleteOffice(a)}},B.a.createElement("a",{href:"#"},"\u5220\u9664"))))},B.a.createElement("a",{className:"ant-dropdown-link"},"\u66f4\u591a ",B.a.createElement(i["a"],{type:"down"}))))}}))))}}]),t}(q["PureComponent"]),X=Z))||X);t["default"]=ee}}]);