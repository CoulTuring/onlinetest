(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[67],{"8guT":function(e,t,a){e.exports={title:"antd-pro-pages-people-people-title",positionsTable:"antd-pro-pages-people-people-positionsTable","ant-table-expanded-row":"antd-pro-pages-people-people-ant-table-expanded-row"}},vj2X:function(e,t,a){"use strict";a.r(t);a("IzEo");var n=a("bx4M"),o=(a("5NDa"),a("5rEg")),i=(a("+L6B"),a("2/Rp")),l=(a("2qtc"),a("kLXV")),s=(a("T2oS"),a("W9HT")),r=(a("qVdP"),a("jsC+")),c=(a("Pwec"),a("CtXQ")),p=(a("lUTK"),a("BvKs")),d=(a("P2fV"),a("NJEC")),m=(a("miYZ"),a("tsqr")),u=a("qIgq"),f=a.n(u),h=a("d6i3"),b=a.n(h),g=a("1l/V"),v=a.n(g),w=a("p0pE"),E=a.n(w),O=a("2Taf"),y=a.n(O),C=a("vZ4D"),S=a.n(C),x=a("l4Ni"),j=a.n(x),M=a("ujKo"),k=a.n(M),P=a("MhPg"),T=a.n(P),V=(a("g9YV"),a("wCAj")),F=a("q1tI"),I=a.n(F),R=a("MuoO"),_=a("LLXN"),z=a("zHco"),N=a("FkSf"),B=a("6NK7"),D=a("8guT"),q=a.n(D),K=(a("y8nQ"),a("Vl3Y")),W=a("gWZ8"),Y=a.n(W),J=a("d/v1"),A=a("pJVQ"),L=a("p9nB"),X=a("WAby"),Q=a("Tt/K"),Z=function(e){},H=function(e){function t(){var e,a;y()(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return a=j()(this,(e=k()(t)).call.apply(e,[this].concat(o))),a.state={offices:[],peopleOptions:[],selectedPeople:[],loading:!1},a.handleSchoolSelect=function(e){var t=a.props.dispatch;t({type:"schools/offices/fetchSchoolOffices",payload:{school:e},callback:a.handleSchoolSelectCallback})},a.handleSchoolSelectCallback=function(e){console.log(e);var t=e.map(function(e){return{key:e.id,value:e.id,label:e.full_name}});a.setState({offices:[{key:"empty",value:null,label:"\uff08\u7a7a\uff09"}].concat(Y()(t))}),a.setState({loading:!1})},a.searchPeople=function(e){var t=a.props.dispatch;t({type:"people/people/search",payload:{person:e},callback:a.searchPeopleCallback})},a.searchPeopleCallback=function(e){console.log("callback search people",e);var t=B["a"].transferObjectsToSelectOptions(e);console.log(t),a.state.selectedPeople.forEach(function(e){return t.findIndex(function(t){return t.id===e.id})<0&&t.push(e)}),a.setState({peopleOptions:t}),a.setState({loading:!1})},a.handleSelect=function(){var e=v()(b.a.mark(function e(t){return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log("\u5f53\u524d\u9009\u4e2d\u7684 value:",t),e.next=3,a.setState({selectedPeople:a.state.selectedPeople.concat(a.state.peopleOptions.filter(function(e){return e.id===t}))});case 3:console.log("\u9009\u4e2d\u540e\uff1a",a.state.selectedPeople);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.handleDeselect=function(){var e=v()(b.a.mark(function e(t){return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({selectedPeople:a.state.selectedPeople.filter(function(e){return e.id!==t})});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return T()(t,e),S()(t,[{key:"componentDidMount",value:function(){var e=this.props.position;if(e){this.handleSchoolSelect(e.school);var t=B["a"].transferObjectsToSelectOptions(e["people_detail"]);console.warn("new people: ",t),this.setState({peopleOptions:t,selectedPeople:t})}}},{key:"render",value:function(){var e=this.props,t=e.schools,a=e.position,n=e.handleSubmit,o=e.submitButtonText,l=e.submitting,r=this.state,c=r.offices,p=r.peopleOptions,d=r.loading;return I.a.createElement("div",null,I.a.createElement(K["a"],{onSubmit:n,layout:"horizontal",className:"modal-form"},I.a.createElement(J["a"],{name:"school",label:Object(_["formatMessage"])({id:"app.schools.school"}),size:"default",labelCol:{span:6},wrapperCol:{span:18},options:t,disabled:!!a&&!!a["id"],onSelect:this.handleSchoolSelect,required:!0,hasFeedback:!0,validate:[X["g"]],component:L["d"]}),I.a.createElement(J["a"],{name:"office",label:Object(_["formatMessage"])({id:"app.people.positions.office"}),size:"default",labelCol:{span:6},wrapperCol:{span:18},options:c,component:L["d"]}),I.a.createElement(J["a"],{name:"name",type:"text",size:"default",placeholder:"",label:Object(_["formatMessage"])({id:"app.people.positions.name"}),required:!0,hasFeedback:!0,validate:[X["g"]],labelCol:{span:6},wrapperCol:{span:18},component:L["g"]}),I.a.createElement(J["a"],{name:"level",label:Object(_["formatMessage"])({id:"app.people.positions.level"}),size:"default",labelCol:{span:6},wrapperCol:{span:18},options:Q["l"],required:!0,hasFeedback:!0,validate:[X["g"]],component:L["d"]}),I.a.createElement(J["a"],{name:"phone",type:"text",size:"default",placeholder:"",label:Object(_["formatMessage"])({id:"app.people.positions.phoneNumber"}),labelCol:{span:6},wrapperCol:{span:18},component:L["g"]}),I.a.createElement(J["a"],{name:"description",type:"text",size:"default",placeholder:"",label:"\u5c97\u4f4d\u804c\u8d23",labelCol:{span:6},wrapperCol:{span:18},component:L["f"]}),I.a.createElement(J["a"],{name:"people",label:Object(_["formatMessage"])({id:"app.people.positions.people"}),size:"default",labelCol:{span:6},wrapperCol:{span:18},options:p,defaultValue:[],mode:"multiple",filterOption:!1,onFocus:this.searchPeople,onSearch:this.searchPeople,onSelect:this.handleSelect,onDeselect:this.handleDeselect,notFoundContent:d?I.a.createElement(s["a"],{size:"small"}):null,component:L["d"]}),I.a.createElement(i["a"],{type:"primary",htmlType:"submit",disabled:l,className:"modal-form-button"},o)))}}]),t}(I.a.Component),U=Object(A["a"])({form:"positionForm",validate:Z})(H);function G(e,t){var a=t.position;return{initialValues:a,position:t.position,submitButtonText:t.submitButtonText||Object(_["formatMessage"])({id:"common.submit"})}}var $=Object(R["connect"])(G)(U),ee=function(e){},te=function(e){function t(){var e,a;y()(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return a=j()(this,(e=k()(t)).call.apply(e,[this].concat(o))),a.state={loading:!1},a}return T()(t,e),S()(t,[{key:"render",value:function(){var e=this.props,t=e.handleSubmit,a=e.submitButtonText,n=e.submitting;return I.a.createElement("div",null,I.a.createElement(K["a"],{onSubmit:t,layout:"horizontal",className:"modal-form"},I.a.createElement(J["a"],{name:"person_name",label:Object(_["formatMessage"])({id:"app.people.positions.people"}),size:"default",labelCol:{span:6},wrapperCol:{span:18},disabled:!0,component:L["g"]}),I.a.createElement(J["a"],{name:"data_joined",type:"text",size:"default",label:Object(_["formatMessage"])({id:"app.people.positions.dateJoined"}),labelCol:{span:6},wrapperCol:{span:12,offset:0},component:L["a"],dateTimeFormat:"YYYY-MM-DD",showTime:!0}),I.a.createElement(J["a"],{name:"sort_weight",type:"text",size:"default",placeholder:"",label:Object(_["formatMessage"])({id:"common.sortWeight"}),required:!0,hasFeedback:!0,validate:[X["g"]],labelCol:{span:6},wrapperCol:{span:18},component:L["b"]}),I.a.createElement(J["a"],{name:"active",label:Object(_["formatMessage"])({id:"common.active"}),size:"default",labelCol:{span:6},wrapperCol:{span:18},defaultChecked:!0,checkedChildren:Object(_["formatMessage"])({id:"common.active"}),unCheckedChildren:Object(_["formatMessage"])({id:"common.inactive"}),component:L["e"]}),I.a.createElement(i["a"],{type:"primary",htmlType:"submit",disabled:n,className:"modal-form-button"},a)))}}]),t}(I.a.Component),ae=Object(A["a"])({form:"positionRelationForm",validate:ee})(te);function ne(e,t){var a=t.relation;return{initialValues:a,submitButtonText:t.submitButtonText||Object(_["formatMessage"])({id:"common.submit"})}}var oe,ie,le,se=Object(R["connect"])(ne)(ae),re=V["a"].Column,ce=(oe=Object(R["connect"])(function(e){return{count:e.count,loading:e.loading.effects["people/positions/fetch"],list:e["people/positions"].data.list,pagination:e["people/positions"].data.pagination}}),oe((le=function(e){function t(){var e,a;y()(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return a=j()(this,(e=k()(t)).call.apply(e,[this].concat(o))),a.state={position:null,relation:null,schoolsOptions:[],schoolsSelectOptions:[],ordering:"",filters:null,filterVisible:!1,filtered:!1,searchText:"",modalTitle:"",modalContent:null,submitButtonText:"",modalVisible:!1,submitting:!1},a.fetchSchools=function(){var e=a.props.dispatch;e({type:"schools/schools/fetchPublic",payload:{},callback:a.fetchSchoolsCallback})},a.fetchSchoolsCallback=function(e){a.setState({schoolsOptions:B["a"].transferObjectsToFilterOptions(e),schoolsSelectOptions:B["a"].transferObjectsToSelectOptionsWithoutID(e)})},a.fetchPositions=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.props,n=t.dispatch,o=t.pagination,i=a.state,l=i.ordering,s=i.filters,r=i.searchText;n(e?{type:"people/positions/fetch",payload:e}:{type:"people/positions/fetch",payload:E()({search:r,page:o?o.current:1,ordering:l},s)})},a.onInputChange=function(e){a.setState({searchText:e.target.value})},a.onPositionSearch=v()(b.a.mark(function e(){var t,n,o,i;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=a.state,n=t.ordering,o=t.filters,i=t.searchText,a.fetchPositions(E()({search:i,page:1,ordering:n},o)),a.setState({filterVisible:!1,filtered:!!i});case 3:case"end":return e.stop()}},e)})),a.handleTableChange=function(){var e=v()(b.a.mark(function e(t,n,o){var i,l;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:i=a.state.searchText,l=B["a"].transferSorterToOrdering(o),a.setState({ordering:l,filters:n}),a.fetchPositions(E()({search:i,page:t.current,ordering:l},n));case 4:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.editPosition=v()(b.a.mark(function e(){var t,n,o,i,l,s,r,c,p=arguments;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:null,n=a.state,o=n.schoolsSelectOptions,i=n.submitting,l=null===t?[Object(_["formatMessage"])({id:"operations.create"},{name:Object(_["formatMessage"])({id:"app.people.position"})}),Object(_["formatMessage"])({id:"common.create"})]:[Object(_["formatMessage"])({id:"operations.edit"},{name:Object(_["formatMessage"])({id:"app.people.position"})}),Object(_["formatMessage"])({id:"common.edit"})],s=f()(l,2),r=s[0],c=s[1],e.next=5,a.setState({position:t,modalTitle:r,modalContent:I.a.createElement($,{position:t,schools:o,title:r,submitButtonText:c,onSubmit:a.onSubmit,submitting:i}),submitButtonText:c,modalVisible:!0});case 5:case"end":return e.stop()}},e)})),a.deletePosition=function(){var e=v()(b.a.mark(function e(t){var n;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=a.props.dispatch,n({type:"people/positions/remove",payload:{position:t},callback:function(){return a.deletePositionCallback(t["name"])}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.deletePositionCallback=function(e){m["a"].success("".concat(Object(_["formatMessage"])({id:"operations.success-delete"},{name:Object(_["formatMessage"])({id:"app.people.position"})})," ").concat(e)),a.fetchPositions()},a.editPositionRelation=v()(b.a.mark(function e(){var t,n,o,i,l,s=arguments;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:null,n=a.state.submitting,o=[Object(_["formatMessage"])({id:"operations.edit"},{name:Object(_["formatMessage"])({id:"app.people.positionRelation"})}),Object(_["formatMessage"])({id:"common.edit"})],i=o[0],l=o[1],e.next=5,a.setState({relation:t,modalTitle:i,modalContent:I.a.createElement(se,{relation:t,title:i,submitButtonText:l,onSubmit:a.onRelationSubmit,submitting:n}),submitButtonText:l,modalVisible:!0});case 5:case"end":return e.stop()}},e)})),a.deletePositionRelation=function(){var e=v()(b.a.mark(function e(t){var n;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=a.props.dispatch,n({type:"people/position/removeRelation",payload:{relation:t},callback:function(){return a.deletePositionRelationCallback(t["person_name"])}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.deletePositionRelationCallback=function(e){m["a"].success("".concat(Object(_["formatMessage"])({id:"operations.success-delete"},{name:Object(_["formatMessage"])({id:"app.people.position"})})," ").concat(e)),a.fetchPositions()},a.handleCancel=v()(b.a.mark(function e(){return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({modalVisible:!1,modalContent:null});case 2:case"end":return e.stop()}},e)})),a.onSubmit=function(){var e=v()(b.a.mark(function e(t){var n,o;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.props.dispatch,o=a.state.position,e.prev=2,e.next=5,a.setState({submitting:!0});case 5:o&&o["id"]?n({type:"people/positions/update",payload:{position:E()({},t,{id:o.id})},callback:function(){return a.fetchPositions()}}):(console.warn("values: ",t),n({type:"people/positions/add",payload:{position:t},callback:function(){return a.fetchPositions()}})),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](2),console.log(e.t0);case 11:return e.prev=11,e.next=14,a.setState({submitting:!1});case 14:return e.finish(11);case 15:return e.next=17,a.setState({modalVisible:!1,modalContent:null});case 17:case"end":return e.stop()}},e,null,[[2,8,11,15]])}));return function(t){return e.apply(this,arguments)}}(),a.onRelationSubmit=function(){var e=v()(b.a.mark(function e(t){var n,o;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.props.dispatch,o=a.state.relation,n({type:"people/positions/updateRelation",payload:{relation:E()({},t,{id:o.id})},callback:function(){m["a"].success("\u66f4\u65b0\u5c97\u4f4d\u4eba\u5458\u4fe1\u606f\u6210\u529f\uff01"),a.fetchPositions()}}),e.next=5,a.setState({modalVisible:!1,modalContent:null});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.expandedRowRender=function(e){var t=a.props.loading,n=e["relations_detail"];return I.a.createElement("div",null,I.a.createElement("p",null,"\u5c97\u4f4d\u63cf\u8ff0\uff1a",e.description),I.a.createElement(V["a"],{dataSource:n,loading:t,rowKey:"id",pagination:!1},I.a.createElement(re,{title:Object(_["formatMessage"])({id:"app.people.person.id"}),dataIndex:"person"}),I.a.createElement(re,{title:Object(_["formatMessage"])({id:"common.name"}),dataIndex:"person_name"}),I.a.createElement(re,{title:Object(_["formatMessage"])({id:"app.people.positions.dateJoined"}),dataIndex:"data_joined"}),I.a.createElement(re,{title:Object(_["formatMessage"])({id:"common.sortWeight"}),dataIndex:"sort_weight",sorter:function(e,t){return e["sort_weight"]-t["sort_weight"]}}),I.a.createElement(re,{title:Object(_["formatMessage"])({id:"common.operations"}),render:function(e,t){return I.a.createElement("div",null,I.a.createElement("a",{onClick:function(){return a.editPositionRelation(t)}},I.a.createElement(_["FormattedMessage"],{id:"common.edit"})),I.a.createElement("span",{className:"ant-divider"}),I.a.createElement(r["a"],{overlay:I.a.createElement(p["a"],null,I.a.createElement(p["a"].Item,null,I.a.createElement(d["a"],{title:Object(_["formatMessage"])({id:"common.delete-ask"}),onConfirm:function(){return a.deletePositionRelation(t)}},I.a.createElement("a",{href:"#"},I.a.createElement(_["FormattedMessage"],{id:"common.delete"})))))},I.a.createElement("a",{className:"ant-dropdown-link"},I.a.createElement(_["FormattedMessage"],{id:"common.more"})," ",I.a.createElement(c["a"],{type:"down"}))))}})))},a}return T()(t,e),S()(t,[{key:"componentDidMount",value:function(){this.fetchSchools(),this.fetchPositions()}},{key:"render",value:function(){var e=this,t=this.props,a=t.list,m=t.pagination,u=t.loading,f=this.state,h=f.schoolsOptions,b=f.filtered,g=f.filterVisible,v=f.modalTitle,w=f.modalContent,E=f.modalVisible;return I.a.createElement(z["a"],{title:Object(_["formatMessage"])({id:"operations.management"},{name:Object(_["formatMessage"])({id:"app.people.positions"})})},I.a.createElement(n["a"],{bordered:!1},m&&I.a.createElement(N["a"],null,m.total),I.a.createElement(l["a"],{title:v,visible:E,onCancel:this.handleCancel,footer:null},w||I.a.createElement(s["a"],{spinning:u})),I.a.createElement(i["a"],{type:"primary",onClick:function(){return e.editPosition()}},I.a.createElement(_["FormattedMessage"],{id:"operations.create",values:{name:Object(_["formatMessage"])({id:"app.people.position"})}})),I.a.createElement(V["a"],{dataSource:a,loading:u,rowKey:"id",onChange:this.handleTableChange,pagination:m,width:1e3,scroll:{x:1e3},expandedRowRender:this.expandedRowRender,className:q.a.positionsTable},I.a.createElement(re,{title:Object(_["formatMessage"])({id:"app.schools.schools"}),dataIndex:"school",filters:h,sorter:!0,render:function(e,t){return t["school_name"]}}),I.a.createElement(re,{title:Object(_["formatMessage"])({id:"app.people.positions.name"}),dataIndex:"name",filterDropdown:I.a.createElement("div",{className:"table-input-search"},I.a.createElement(o["a"],{placeholder:Object(_["formatMessage"])({id:"common.brand-name"}),value:this.state.searchText,onChange:this.onInputChange,onPressEnter:this.onPositionSearch}),I.a.createElement(i["a"],{type:"primary",onClick:this.onPositionSearch},I.a.createElement(_["FormattedMessage"],{id:"common.search"}))),filterIcon:I.a.createElement(c["a"],{type:"search",style:{color:b?"#108ee9":"#aaa"}}),filterDropdownVisible:g,onFilterDropdownVisibleChange:function(t){e.setState({filterVisible:t})}}),I.a.createElement(re,{title:Object(_["formatMessage"])({id:"app.people.positions.office"}),dataIndex:"office",render:function(e,t){return t["office_name"]}}),I.a.createElement(re,{title:Object(_["formatMessage"])({id:"app.people.positions.level"}),dataIndex:"level",sorter:!0,render:function(e,t){return t["get_level_display"]}}),I.a.createElement(re,{title:Object(_["formatMessage"])({id:"common.sortWeight"}),dataIndex:"sort_weight"}),I.a.createElement(re,{title:Object(_["formatMessage"])({id:"common.operations"}),width:136,render:function(t,a){return I.a.createElement("div",null,I.a.createElement("a",{onClick:function(){return e.editPosition(a)}},I.a.createElement(_["FormattedMessage"],{id:"common.edit"})),I.a.createElement("span",{className:"ant-divider"}),I.a.createElement(r["a"],{overlay:I.a.createElement(p["a"],null,I.a.createElement(p["a"].Item,null,I.a.createElement(d["a"],{title:Object(_["formatMessage"])({id:"common.delete-ask"}),onConfirm:function(){return e.deletePosition(a)}},I.a.createElement("a",{href:"#"},I.a.createElement(_["FormattedMessage"],{id:"common.delete"})))))},I.a.createElement("a",{className:"ant-dropdown-link"},I.a.createElement(_["FormattedMessage"],{id:"common.more"})," ",I.a.createElement(c["a"],{type:"down"}))))}}))))}}]),t}(F["PureComponent"]),ie=le))||ie);t["default"]=ce}}]);