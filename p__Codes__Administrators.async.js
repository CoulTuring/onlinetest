(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[13],{JOSW:function(e,t,a){"use strict";a.r(t);a("IzEo");var n=a("bx4M"),r=(a("P2fV"),a("NJEC")),o=(a("Pwec"),a("CtXQ")),s=(a("5NDa"),a("5rEg")),i=(a("+L6B"),a("2/Rp")),c=(a("2qtc"),a("kLXV")),l=(a("T2oS"),a("W9HT")),d=(a("miYZ"),a("tsqr")),m=a("qIgq"),p=a.n(m),u=a("d6i3"),h=a.n(u),f=a("1l/V"),b=a.n(f),g=a("p0pE"),v=a.n(g),O=a("2Taf"),w=a.n(O),y=a("vZ4D"),C=a.n(y),S=a("l4Ni"),x=a.n(S),k=a("ujKo"),E=a.n(k),M=a("MhPg"),j=a.n(M),T=(a("g9YV"),a("wCAj")),A=a("q1tI"),V=a.n(A),P=a("MuoO"),F=a("LLXN"),I=a("zHco"),N=a("FkSf"),B=(a("y8nQ"),a("Vl3Y")),D=a("d/v1"),_=a("pJVQ"),q=a("p9nB"),z=a("WAby"),J=a("6NK7"),W=function(e){},L=function(e){function t(){var e,a;w()(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return a=x()(this,(e=E()(t)).call.apply(e,[this].concat(r))),a.state={peopleOptions:[],selectedPeople:[]},a.searchPeople=function(e,t){var n=a.props.dispatch;n({type:"people/people/search",payload:{person:t},callback:a.searchPeopleCallback})},a.searchPeopleCallback=function(e){var t=J["a"].transferPeopleToOptionsWithName(e);a.setState({peopleOptions:t})},a}return j()(t,e),C()(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.schools,a=e.searching,n=e.handleSubmit,r=e.submitButtonText,o=e.submitting,s=this.state.peopleOptions;return V.a.createElement("div",null,V.a.createElement(B["a"],{onSubmit:n,layout:"horizontal",className:"modal-form"},V.a.createElement(D["a"],{name:"person",label:Object(F["formatMessage"])({id:"common.administrator"}),size:"default",mode:"combobox",labelCol:{span:6},wrapperCol:{span:18},options:s,defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onFocus:this.searchPeople,onChange:this.searchPeople,required:!1,hasFeedback:!0,validate:[z["g"],z["d"]],notFoundContent:a?V.a.createElement(l["a"],{size:"small"}):null,component:q["d"]}),V.a.createElement(D["a"],{name:"school",label:Object(F["formatMessage"])({id:"app.schools.school"}),size:"default",labelCol:{span:6},wrapperCol:{span:18},options:t,hasFeedback:!0,component:q["d"]}),V.a.createElement(i["a"],{type:"primary",htmlType:"submit",disabled:o,className:"modal-form-button"},r)))}}]),t}(V.a.Component),K=Object(_["a"])({form:"codesAdministratorForm",validate:W})(L);function Q(e,t){var a=t.administrator;return{searching:e.loading.effects["people/people/search"],initialValues:a,administrator:t.administrator,submitButtonText:t.submitButtonText||Object(F["formatMessage"])({id:"common.submit"})}}var X,Y,H,Z=Object(P["connect"])(Q)(K),R=T["a"].Column,G=(X=Object(P["connect"])(function(e){return{loading:e.loading.effects["codes/administrators/fetch"],list:e["codes/administrators"].data.list,pagination:e["codes/administrators"].data.pagination}}),X((H=function(e){function t(){var e,a;w()(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return a=x()(this,(e=E()(t)).call.apply(e,[this].concat(r))),a.state={administrator:null,schoolsOptions:[],schoolsSelectOptions:[],ordering:"",filters:null,filterVisible:!1,filtered:!1,searchText:"",modalTitle:"",modalContent:null,submitButtonText:"",modalVisible:!1,submitting:!1},a.fetchAdministrators=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.props,n=t.dispatch,r=t.pagination,o=a.state,s=o.ordering,i=o.filters,c=o.searchText;n(e?{type:"codes/administrators/fetch",payload:e}:{type:"codes/administrators/fetch",payload:v()({search:c,page:r?r.current:1,ordering:s},i)})},a.fetchSchools=function(){var e=a.props.dispatch;e({type:"schools/schools/fetchPublic",payload:{},callback:a.fetchSchoolsCallback})},a.fetchSchoolsCallback=function(e){a.setState({schoolsOptions:J["a"].transferObjectsToFilterOptions(e)}),a.setState({schoolsSelectOptions:J["a"].transferObjectsToSelectOptionsWithoutID(e)})},a.handleTableChange=function(){var e=b()(h.a.mark(function e(t,n,r){var o,s;return h.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return o=a.state.searchText,s=J["a"].transferSorterToOrdering(r),a.setState({ordering:s,filters:n}),e.next=5,a.fetchAdministrators(v()({search:o,page:t.current,ordering:s},n));case 5:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.editAdministrator=b()(h.a.mark(function e(){var t,n,r,o,s,i,c,l,d=arguments;return h.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=d.length>0&&void 0!==d[0]?d[0]:null,n=a.state,r=n.schoolsSelectOptions,o=n.submitting,s=null===t?[Object(F["formatMessage"])({id:"operations.create"},{name:Object(F["formatMessage"])({id:"common.administrator"})}),Object(F["formatMessage"])({id:"common.create"})]:[Object(F["formatMessage"])({id:"operations.edit"},{name:Object(F["formatMessage"])({id:"common.administrator"})}),Object(F["formatMessage"])({id:"common.edit"})],i=p()(s,2),c=i[0],l=i[1],e.next=5,a.setState({administrator:t?v()({},t,{person:"".concat(t["person_detail"]["name"],"(").concat(t["person_detail"]["id"],")")}):{}});case 5:return e.next=7,a.setState({modalTitle:c,modalContent:V.a.createElement(Z,{administrator:a.state.administrator,schools:r,title:c,submitButtonText:l,onSubmit:a.onSubmit,submitting:o}),submitButtonText:l,modalVisible:!0});case 7:case"end":return e.stop()}},e)})),a.deleteAdministrator=function(){var e=b()(h.a.mark(function e(t){var n;return h.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=a.props.dispatch,n({type:"codes/administrators/remove",payload:{administrator:t},callback:function(){return a.deleteAdministratorCallback(t["person_detail"]["name"])}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.deleteAdministratorCallback=function(e){d["a"].success("".concat(Object(F["formatMessage"])({id:"operations.success-delete"},{name:Object(F["formatMessage"])({id:"common.administrator"})})," ").concat(e)),a.fetchAdministrators()},a.onInputChange=function(e){a.setState({searchText:e.target.value})},a.onAdministratorSearch=b()(h.a.mark(function e(){var t,n,r,o;return h.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=a.state,n=t.ordering,r=t.filters,o=t.searchText,e.next=3,a.fetchAdministrators(v()({search:o,page:1,ordering:n},r));case 3:a.setState({filterVisible:!1,filtered:!!o});case 4:case"end":return e.stop()}},e)})),a.handleCancel=b()(h.a.mark(function e(){return h.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({modalVisible:!1,modalContent:null});case 2:case"end":return e.stop()}},e)})),a.onSubmit=function(){var e=b()(h.a.mark(function e(t){var n,r,o,s;return h.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.props.dispatch,r=a.state.administrator,o=/\((\w{4,11})\)/.exec(t["person"]),s=v()({},t,{person:o[1]}),e.prev=4,e.next=7,a.setState({submitting:!0});case 7:r&&r["person"]?n({type:"codes/administrators/update",payload:{administrator:v()({},s)},callback:function(){return a.fetchAdministrators()}}):n({type:"codes/administrators/add",payload:{administrator:s},callback:function(){return a.fetchAdministrators()}}),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](4),console.log(e.t0);case 13:return e.prev=13,e.next=16,a.setState({submitting:!1});case 16:return e.finish(13);case 17:return e.next=19,a.setState({modalVisible:!1,modalContent:null});case 19:case"end":return e.stop()}},e,null,[[4,10,13,17]])}));return function(t){return e.apply(this,arguments)}}(),a}return j()(t,e),C()(t,[{key:"componentDidMount",value:function(){this.fetchAdministrators(),this.fetchSchools()}},{key:"render",value:function(){var e=this,t=this.props,a=t.list,d=t.pagination,m=t.loading,p=this.state,u=p.schoolsOptions,h=p.filtered,f=p.filterVisible,b=p.modalTitle,g=p.modalContent,v=p.modalVisible;return V.a.createElement(I["a"],{title:Object(F["formatMessage"])({id:"operations.management"},{name:Object(F["formatMessage"])({id:"common.administrators"})})},V.a.createElement(n["a"],{bordered:!1},d&&V.a.createElement(N["a"],null,d.total),V.a.createElement(c["a"],{title:b,visible:v,onCancel:this.handleCancel,footer:null},g||V.a.createElement(l["a"],{spinning:m})),V.a.createElement(i["a"],{type:"primary",onClick:function(){return e.editAdministrator()}},V.a.createElement(F["FormattedMessage"],{id:"operations.create",values:{name:Object(F["formatMessage"])({id:"common.administrator"})}})),V.a.createElement(T["a"],{dataSource:a,loading:m,rowKey:"person",onChange:this.handleTableChange,pagination:d,width:800},V.a.createElement(R,{title:Object(F["formatMessage"])({id:"common.person"}),dataIndex:"person",filterDropdown:V.a.createElement("div",{className:"table-input-search"},V.a.createElement(s["a"],{placeholder:Object(F["formatMessage"])({id:"common.person"}),value:this.state.searchText,onChange:this.onInputChange,onPressEnter:this.onAdministratorSearch}),V.a.createElement(i["a"],{type:"primary",onClick:this.onAdministratorSearch},V.a.createElement(F["FormattedMessage"],{id:"common.search"}))),filterIcon:V.a.createElement(o["a"],{type:"search",style:{color:h?"#108ee9":"#aaa"}}),filterDropdownVisible:f,onFilterDropdownVisibleChange:function(t){e.setState({filterVisible:t})},render:function(e,t){return t["person_detail"]?t["person_detail"]["name"]:t["person"]}}),V.a.createElement(R,{title:Object(F["formatMessage"])({id:"app.schools.schools"}),dataIndex:"school",render:function(e,t){return t["school_detail"]?t["school_detail"]["name"]:""},filters:u}),V.a.createElement(R,{title:Object(F["formatMessage"])({id:"common.operations"}),width:152,fixed:"right",render:function(t,a){return V.a.createElement("div",null,V.a.createElement(r["a"],{title:Object(F["formatMessage"])({id:"common.delete-ask"}),onConfirm:function(){return e.deleteAdministrator(a)}},V.a.createElement(F["FormattedMessage"],{id:"common.delete"})))}}))))}}]),t}(A["PureComponent"]),Y=H))||Y);t["default"]=G}}]);