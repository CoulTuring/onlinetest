(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[14],{cWib:function(e,t,a){"use strict";a.r(t);a("IzEo");var n=a("bx4M"),o=(a("qVdP"),a("jsC+")),c=(a("P2fV"),a("NJEC")),r=(a("lUTK"),a("BvKs")),s=(a("Pwec"),a("CtXQ")),l=(a("5NDa"),a("5rEg")),i=(a("+L6B"),a("2/Rp")),d=(a("2qtc"),a("kLXV")),m=(a("T2oS"),a("W9HT")),u=(a("miYZ"),a("tsqr")),p=a("qIgq"),f=a.n(p),h=a("d6i3"),b=a.n(h),g=a("1l/V"),C=a.n(g),v=a("p0pE"),w=a.n(v),E=a("2Taf"),y=a.n(E),O=a("vZ4D"),x=a.n(O),k=a("l4Ni"),M=a.n(k),j=a("ujKo"),S=a.n(j),T=a("MhPg"),V=a.n(T),I=(a("g9YV"),a("wCAj")),F=a("q1tI"),B=a.n(F),N=a("MuoO"),q=a("LLXN"),z=a("zHco"),D=a("FkSf"),P=(a("y8nQ"),a("Vl3Y")),J=a("d/v1"),K=a("pJVQ"),L=a("p9nB"),_=a("WAby"),A=function(e){},W=function(e){function t(){var e,a;y()(this,t);for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return a=M()(this,(e=S()(t)).call.apply(e,[this].concat(o))),a.state={},a}return V()(t,e),x()(t,[{key:"componentDidMount",value:function(){this.props.code}},{key:"render",value:function(){var e=this.props,t=e.schools,a=e.handleSubmit,n=e.submitButtonText,o=e.submitting;return B.a.createElement("div",null,B.a.createElement(P["a"],{onSubmit:a,layout:"horizontal",className:"modal-form"},B.a.createElement(J["a"],{name:"name",type:"text",size:"default",placeholder:"",label:Object(q["formatMessage"])({id:"common.brand-name"}),required:!0,hasFeedback:!0,validate:[_["g"]],labelCol:{span:6},wrapperCol:{span:18},component:L["g"]}),B.a.createElement(J["a"],{name:"description",type:"text",size:"default",placeholder:"",label:Object(q["formatMessage"])({id:"common.description"}),required:!0,hasFeedback:!0,validate:[_["g"]],labelCol:{span:6},wrapperCol:{span:18},rows:3,component:L["f"]}),B.a.createElement(J["a"],{name:"school",label:Object(q["formatMessage"])({id:"app.schools.school"}),size:"default",labelCol:{span:6},wrapperCol:{span:18},options:t,hasFeedback:!0,component:L["d"]}),B.a.createElement(J["a"],{name:"url",type:"text",size:"default",placeholder:"",label:Object(q["formatMessage"])({id:"common.url"}),hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:L["g"]}),B.a.createElement(J["a"],{name:"content",type:"text",size:"default",placeholder:"",label:Object(q["formatMessage"])({id:"common.content"}),hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},rows:6,component:L["f"]}),B.a.createElement(i["a"],{type:"primary",htmlType:"submit",disabled:o,className:"modal-form-button"},n)))}}]),t}(B.a.Component),X=Object(K["a"])({form:"codeForm",validate:A})(W);function Q(e,t){var a=t.code;return{initialValues:a,code:t.code,submitButtonText:t.submitButtonText||Object(q["formatMessage"])({id:"common.submit"})}}var Y,H,Z,R=Object(N["connect"])(Q)(X),U=a("6NK7"),G=a("X3JL"),$=I["a"].Column,ee=(Y=Object(N["connect"])(function(e){return{loading:e.loading.effects["codes/codes/fetch"],list:e["codes/codes"].data.list,pagination:e["codes/codes"].data.pagination}}),Y((Z=function(e){function t(){var e,a;y()(this,t);for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return a=M()(this,(e=S()(t)).call.apply(e,[this].concat(o))),a.state={code:null,schoolsOptions:[],schoolsSelectOptions:[],ordering:"",filters:null,filterVisible:!1,filtered:!1,searchText:"",modalTitle:"",modalContent:null,submitButtonText:"",modalVisible:!1,submitting:!1},a.fetchCodes=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.props,n=t.dispatch,o=t.pagination,c=a.state,r=c.ordering,s=c.filters,l=c.searchText;n(e?{type:"codes/codes/fetch",payload:e}:{type:"codes/codes/fetch",payload:w()({search:l,page:o?o.current:1,ordering:r},s)})},a.fetchSchools=function(){var e=a.props.dispatch;e({type:"schools/schools/fetchPublic",payload:{},callback:a.fetchSchoolsCallback})},a.fetchSchoolsCallback=function(e){a.setState({schoolsOptions:U["a"].transferObjectsToFilterOptions(e)}),a.setState({schoolsSelectOptions:U["a"].transferObjectsToSelectOptionsWithoutID(e)})},a.handleTableChange=function(){var e=C()(b.a.mark(function e(t,n,o){var c,r;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return c=a.state.searchText,r=U["a"].transferSorterToOrdering(o),e.next=4,a.fetchCodes(w()({search:c,page:t.current,ordering:r},n));case 4:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.editCode=C()(b.a.mark(function e(){var t,n,o,c,r,s,l,i,d=arguments;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=d.length>0&&void 0!==d[0]?d[0]:null,n=a.state,o=n.schoolsSelectOptions,c=n.submitting,r=null===t?[Object(q["formatMessage"])({id:"operations.create"},{name:Object(q["formatMessage"])({id:"app.codes.code"})}),Object(q["formatMessage"])({id:"common.create"})]:[Object(q["formatMessage"])({id:"operations.edit"},{name:Object(q["formatMessage"])({id:"app.codes.code"})}),Object(q["formatMessage"])({id:"common.edit"})],s=f()(r,2),l=s[0],i=s[1],e.next=5,a.setState({code:t?w()({},t):{}});case 5:return e.next=7,a.setState({modalTitle:l,modalContent:B.a.createElement(R,{code:a.state.code,schools:o,title:l,submitButtonText:i,onSubmit:a.onSubmit,submitting:c}),submitButtonText:i,modalVisible:!0});case 7:case"end":return e.stop()}},e)})),a.deleteCode=function(){var e=C()(b.a.mark(function e(t){var n;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=a.props.dispatch,n({type:"codes/codes/remove",payload:{code:t},callback:function(){return a.deleteCodeCallback(t["fullname"])}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.deleteCodeCallback=function(e){u["a"].success("".concat(Object(q["formatMessage"])({id:"operations.success-delete"},{name:Object(q["formatMessage"])({id:"app.codes.codes"})})," ").concat(e)),a.fetchCodes()},a.onInputChange=function(e){a.setState({searchText:e.target.value})},a.onCodeSearch=C()(b.a.mark(function e(){var t,n,o,c;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=a.state,n=t.ordering,o=t.filters,c=t.searchText,e.next=3,a.fetchCodes(w()({search:c,page:1,ordering:n},o));case 3:a.setState({filterVisible:!1,filtered:!!c});case 4:case"end":return e.stop()}},e)})),a.handleCancel=C()(b.a.mark(function e(){return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({modalVisible:!1,modalContent:null});case 2:case"end":return e.stop()}},e)})),a.onSubmit=function(){var e=C()(b.a.mark(function e(t){var n,o,c;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.props.dispatch,o=a.state.code,c=w()({},t,{visible:!!t["visible"]}),console.warn("new values: ",c),e.prev=4,e.next=7,a.setState({submitting:!0});case 7:o&&o["id"]?n({type:"codes/codes/update",payload:{code:w()({},c)},callback:function(){return a.onSubmitCallback("".concat(Object(q["formatMessage"])({id:"operations.success-edit"},{name:Object(q["formatMessage"])({id:"app.codes.codes"})})))}}):n({type:"codes/codes/add",payload:{code:c},callback:function(){return a.onSubmitCallback("".concat(Object(q["formatMessage"])({id:"operations.success-create"},{name:Object(q["formatMessage"])({id:"app.codes.codes"})})))}}),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](4),console.log(e.t0);case 13:return e.prev=13,e.next=16,a.setState({submitting:!1});case 16:return e.finish(13);case 17:return e.next=19,a.setState({modalVisible:!1,modalContent:null});case 19:case"end":return e.stop()}},e,null,[[4,10,13,17]])}));return function(t){return e.apply(this,arguments)}}(),a.generateCode=function(){var e=C()(b.a.mark(function e(t){var n;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=a.props.dispatch,n({type:"codes/codes/generate",payload:{code:t},callback:function(e){return a.generateCodeCallback(e)}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.generateCodeCallback=function(){var e=C()(b.a.mark(function e(t){return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({modalTitle:"\u67e5\u770b\u4e8c\u7ef4\u7801",modalContent:B.a.createElement("img",{width:460,alt:"code",src:t}),submitButtonText:"\u786e\u5b9a",modalVisible:!0});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return V()(t,e),x()(t,[{key:"componentDidMount",value:function(){this.fetchCodes(),this.fetchSchools()}},{key:"onSubmitCallback",value:function(e){u["a"].success(e),this.fetchCodes()}},{key:"render",value:function(){var e=this,t=this.props,a=t.list,u=t.pagination,p=t.loading,f=this.state,h=f.schoolsOptions,b=f.filtered,g=f.filterVisible,C=f.modalTitle,v=f.modalContent,w=f.modalVisible;return console.warn("list, pages, loading:",a,u,p),B.a.createElement(z["a"],{title:Object(q["formatMessage"])({id:"operations.management"},{name:Object(q["formatMessage"])({id:"app.codes.codes"})})},B.a.createElement(n["a"],{bordered:!1},u&&B.a.createElement(D["a"],null,u.total),B.a.createElement(d["a"],{title:C,visible:w,onCancel:this.handleCancel,footer:null},v||B.a.createElement(m["a"],{spinning:p})),B.a.createElement(i["a"],{type:"primary",onClick:function(){return e.editCode()}},B.a.createElement(q["FormattedMessage"],{id:"operations.create",values:{name:Object(q["formatMessage"])({id:"app.codes.code"})}})),B.a.createElement(G["a"],null),B.a.createElement(I["a"],{dataSource:a,loading:p,rowKey:"id",onChange:this.handleTableChange,pagination:u,width:1e3,scroll:{x:1e3}},B.a.createElement($,{title:Object(q["formatMessage"])({id:"common.brand-name"}),dataIndex:"name",filterDropdown:B.a.createElement("div",{className:"table-input-search"},B.a.createElement(l["a"],{placeholder:Object(q["formatMessage"])({id:"common.brand-name"}),value:this.state.searchText,onChange:this.onInputChange,onPressEnter:this.onCodeSearch}),B.a.createElement(i["a"],{type:"primary",onClick:this.onCodeSearch},B.a.createElement(q["FormattedMessage"],{id:"common.search"}))),filterIcon:B.a.createElement(s["a"],{type:"search",style:{color:b?"#108ee9":"#aaa"}}),filterDropdownVisible:g,onFilterDropdownVisibleChange:function(t){e.setState({filterVisible:t})}}),B.a.createElement($,{title:Object(q["formatMessage"])({id:"app.schools.schools"}),dataIndex:"school",render:function(e,t){return t["school_detail"]?t["school_detail"]["name"]:""},filters:h}),B.a.createElement($,{title:Object(q["formatMessage"])({id:"common.description"}),dataIndex:"description"}),B.a.createElement($,{title:Object(q["formatMessage"])({id:"common.url"}),dataIndex:"url"}),B.a.createElement($,{title:Object(q["formatMessage"])({id:"common.content"}),dataIndex:"content"}),B.a.createElement($,{title:Object(q["formatMessage"])({id:"common.visit_counts"}),dataIndex:"visit_counts",sorter:!0}),B.a.createElement($,{title:Object(q["formatMessage"])({id:"app.codes.latest"}),dataIndex:"latest",render:function(e,t){return t["visit_counts"]>0?t["latest"]:""}}),B.a.createElement($,{title:Object(q["formatMessage"])({id:"common.operations"}),width:152,fixed:"right",render:function(t,a){return B.a.createElement("div",null,B.a.createElement("a",{onClick:function(){return e.editCode(a)}}," ",Object(q["formatMessage"])({id:"common.edit"})),B.a.createElement("span",{className:"ant-divider"}),B.a.createElement(o["a"],{overlay:B.a.createElement(r["a"],null,B.a.createElement(r["a"].Item,null,B.a.createElement("a",{onClick:function(){return e.generateCode(a)}},B.a.createElement(q["FormattedMessage"],{id:"app.codes.view-code"}))),B.a.createElement(r["a"].Item,null,B.a.createElement(c["a"],{title:Object(q["formatMessage"])({id:"common.delete-ask"}),onConfirm:function(){return e.deleteCode(a)}},B.a.createElement("a",{href:"#"},B.a.createElement(q["FormattedMessage"],{id:"common.delete"})))))},B.a.createElement("a",{className:"ant-dropdown-link"},B.a.createElement(q["FormattedMessage"],{id:"common.more"})," ",B.a.createElement(s["a"],{type:"down"}))))}}))))}}]),t}(F["PureComponent"]),H=Z))||H);t["default"]=ee}}]);