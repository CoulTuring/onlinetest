(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[55],{"5cEL":function(e,t,a){"use strict";a.r(t);a("IzEo");var n=a("bx4M"),i=(a("qVdP"),a("jsC+")),l=(a("P2fV"),a("NJEC")),r=(a("lUTK"),a("BvKs")),o=(a("Awhp"),a("KrTs")),c=(a("Pwec"),a("CtXQ")),s=(a("5NDa"),a("5rEg")),p=(a("+L6B"),a("2/Rp")),m=(a("2qtc"),a("kLXV")),u=(a("T2oS"),a("W9HT")),d=(a("miYZ"),a("tsqr")),h=a("qIgq"),f=a.n(h),b=a("d6i3"),v=a.n(b),E=a("1l/V"),w=a.n(E),x=a("p0pE"),g=a.n(x),k=a("2Taf"),C=a.n(k),y=a("vZ4D"),A=a.n(y),S=a("l4Ni"),T=a.n(S),O=a("ujKo"),I=a.n(O),V=a("MhPg"),j=a.n(V),F=(a("g9YV"),a("wCAj")),N=a("q1tI"),B=a.n(N),P=a("MuoO"),M=a("LLXN"),z=a("zHco"),_=a("FkSf"),q=(a("y8nQ"),a("Vl3Y")),D=a("d/v1"),K=a("pJVQ"),L=a("p9nB"),J=a("WAby"),W=a("6NK7"),Q=function(e){},X=function(e){function t(){var e,a;C()(this,t);for(var n=arguments.length,i=new Array(n),l=0;l<n;l++)i[l]=arguments[l];return a=T()(this,(e=I()(t)).call.apply(e,[this].concat(i))),a.state={peopleOptions:[],selectedPeople:[]},a.searchPeople=function(e,t){var n=a.props.dispatch;n({type:"people/people/search",payload:{person:t},callback:a.searchPeopleCallback})},a.searchPeopleCallback=function(e){var t=W["a"].transferPeopleToOptionsWithName(e);a.setState({peopleOptions:t})},a}return j()(t,e),A()(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.searching,a=e.schools,n=e.handleSubmit,i=e.submitButtonText,l=e.submitting,r=this.state.peopleOptions;return B.a.createElement("div",null,B.a.createElement(q["a"],{onSubmit:n,layout:"horizontal",className:"modal-form"},B.a.createElement(D["a"],{name:"content",type:"text",size:"default",placeholder:"\u8bf7\u7b80\u8981\u8bf4\u660e\u7533\u8bf7/\u4fee\u6539\u57df\u540d\u7684\u539f\u56e0",label:"\u7533\u8bf7\u8bf4\u660e",required:!0,hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:L["f"]}),B.a.createElement(D["a"],{name:"email",type:"text",size:"default",placeholder:"",label:"\u7f51\u7ad9\u57df\u540d\u5730\u5740",required:!0,hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:L["g"]}),B.a.createElement(D["a"],{name:"school",label:"\u90e8\u95e8",size:"default",labelCol:{span:6},wrapperCol:{span:18},options:a,required:!0,hasFeedback:!0,component:L["d"]}),B.a.createElement(D["a"],{name:"owner",label:"\u57df\u540d\u8d1f\u8d23\u4eba",size:"default",mode:"combobox",labelCol:{span:6},wrapperCol:{span:18},options:r,defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onFocus:this.searchPeople,onChange:this.searchPeople,required:!1,hasFeedback:!0,validate:[J["g"],J["d"]],notFoundContent:t?B.a.createElement(u["a"],{size:"small"}):null,component:L["d"]}),B.a.createElement(D["a"],{name:"notes",type:"text",size:"default",placeholder:"",label:"\u5907\u6ce8",labelCol:{span:6},wrapperCol:{span:18},component:L["f"]}),B.a.createElement(p["a"],{type:"primary",htmlType:"submit",disabled:l,className:"modal-form-button"},i)))}}]),t}(B.a.Component),Y=Object(K["a"])({form:"emailApplicationForm",validate:Q})(X);function H(e,t){var a=t.emailApplication;return{searching:e.loading.effects["people/people/search"],initialValues:a,emailApplication:t.emailApplication,submitButtonText:t.submitButtonText||"\u63d0\u4ea4"}}var Z=Object(P["connect"])(H)(Y),R=function(e){},U=function(e){function t(){var e,a;C()(this,t);for(var n=arguments.length,i=new Array(n),l=0;l<n;l++)i[l]=arguments[l];return a=T()(this,(e=I()(t)).call.apply(e,[this].concat(i))),a.state={},a}return j()(t,e),A()(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.handleSubmit,a=e.submitButtonText,n=e.submitting;return B.a.createElement("div",null,B.a.createElement(q["a"],{onSubmit:t,layout:"horizontal",className:"modal-form"},B.a.createElement(D["a"],{name:"approved",label:"\u5ba1\u6279\u7ed3\u679c",size:"default",labelCol:{span:6},wrapperCol:{span:18},defaultChecked:!0,checkedChildren:"\u6279\u51c6",unCheckedChildren:"\u5426\u51b3",component:L["e"]}),B.a.createElement(D["a"],{name:"opinion",type:"text",size:"default",placeholder:"\u8bf7\u7b80\u8981\u8bf4\u660e\u5ba1\u6279\u57df\u540d\u7684\u610f\u89c1",label:"\u5ba1\u6279\u610f\u89c1",required:!0,hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:L["f"]}),B.a.createElement(p["a"],{type:"primary",htmlType:"submit",disabled:n,className:"modal-form-button"},a)))}}]),t}(B.a.Component),G=Object(K["a"])({form:"emailApplicationExamineForm",validate:R})(U);function $(e,t){var a=t.emailApplication;return{searching:e.loading.effects["people/people/search"],initialValues:a,emailApplication:t.emailApplication,submitButtonText:t.submitButtonText||"\u63d0\u4ea4"}}var ee,te,ae,ne=Object(P["connect"])($)(G),ie=F["a"].Column,le=(ee=Object(P["connect"])(function(e){return{isAdminOrIsNetworkServicesAdmin:e["auth"].person&&e["auth"].person["roles"].indexOf("admin")>-1||e["auth"].person&&e["auth"].person["roles"].indexOf("networkServicesAdmin")>-1,loading:e.loading.effects["network-services/email-applications/fetch"],list:e["network-services/email-applications"].data.list,pagination:e["network-services/email-applications"].data.pagination}}),ee((ae=function(e){function t(){var e,a;C()(this,t);for(var n=arguments.length,i=new Array(n),l=0;l<n;l++)i[l]=arguments[l];return a=T()(this,(e=I()(t)).call.apply(e,[this].concat(i))),a.state={emailApplication:null,schoolsOptions:[],schoolsSelectOptions:[],ordering:"",filters:null,filterVisible:!1,filtered:!1,searchText:"",modalTitle:"",modalContent:null,submitButtonText:"",modalVisible:!1,submitting:!1},a.fetchEmailApplications=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.props,n=t.dispatch,i=t.pagination,l=a.state,r=l.ordering,o=l.filters,c=l.searchText;n(e?{type:"network-services/email-applications/fetch",payload:e}:{type:"network-services/email-applications/fetch",payload:g()({search:c,page:i?i.current:1,ordering:r},o)})},a.fetchSchools=function(){var e=a.props.dispatch;e({type:"schools/schools/fetchPublic",payload:{},callback:a.fetchSchoolsCallback})},a.fetchSchoolsCallback=function(e){a.setState({schoolsOptions:W["a"].transferObjectsToFilterOptions(e)}),a.setState({schoolsSelectOptions:W["a"].transferObjectsToSelectOptionsWithoutID(e)})},a.handleTableChange=function(){var e=w()(v.a.mark(function e(t,n,i){var l,r;return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return l=a.state.searchText,r=W["a"].transferSorterToOrdering(i),a.setState({ordering:r,filters:n}),e.next=5,a.fetchEmailApplications(g()({search:l,page:t.current,ordering:r},n));case 5:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.editEmailApplication=w()(v.a.mark(function e(){var t,n,i,l,r,o,c,s,p=arguments;return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:null,n=a.state,i=n.schoolsSelectOptions,l=n.submitting,r=null===t?["\u7533\u8bf7\u7535\u5b50\u90ae\u7bb1","\u7533\u8bf7"]:["\u7f16\u8f91\u7535\u5b50\u90ae\u7bb1\u7533\u8bf7","\u7f16\u8f91"],o=f()(r,2),c=o[0],s=o[1],e.next=5,a.setState({emailApplication:t?g()({},t,{owner:"".concat(t["owner_detail"]["name"],"(").concat(t["owner_detail"]["id"],")")}):{}});case 5:return e.next=7,a.setState({modalTitle:c,modalContent:B.a.createElement(Z,{emailApplication:a.state.emailApplication,schools:i,title:c,submitButtonText:s,onSubmit:a.onSubmit,submitting:l}),submitButtonText:s,modalVisible:!0});case 7:case"end":return e.stop()}},e)})),a.deleteEmailApplication=function(){var e=w()(v.a.mark(function e(t){var n;return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=a.props.dispatch,n({type:"network-services/email-applications/remove",payload:{emailApplication:t},callback:function(){return a.deleteEmailApplicationCallback(t["name"])}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.deleteEmailApplicationCallback=function(e){d["a"].success("\u6210\u529f\u5220\u9664\u7535\u5b50\u90ae\u7bb1\u7533\u8bf7 ".concat(e,"\u3002")),a.fetchEmailApplications()},a.onInputChange=function(e){a.setState({searchText:e.target.value})},a.onEmailApplicationSearch=w()(v.a.mark(function e(){var t,n,i,l;return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=a.state,n=t.ordering,i=t.filters,l=t.searchText,e.next=3,a.fetchEmailApplications(g()({search:l,page:1,ordering:n},i));case 3:a.setState({filterVisible:!1,filtered:!!l});case 4:case"end":return e.stop()}},e)})),a.handleCancel=w()(v.a.mark(function e(){return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({modalVisible:!1,modalContent:null});case 2:case"end":return e.stop()}},e)})),a.onSubmit=function(){var e=w()(v.a.mark(function e(t){var n,i,l,r;return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.props.dispatch,i=a.state.emailApplication,l=/\((\w{4,11})\)/.exec(t["owner"]),r=g()({},t,{owner:l[1]}),console.warn("new values: ",r),e.prev=5,e.next=8,a.setState({submitting:!0});case 8:i&&i["id"]?n({type:"network-services/email-applications/update",payload:{emailApplication:g()({},r)},callback:function(){return a.fetchEmailApplications()}}):n({type:"network-services/email-applications/add",payload:{emailApplication:r},callback:function(){return a.fetchEmailApplications()}}),e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](5),console.log(e.t0);case 14:return e.prev=14,e.next=17,a.setState({submitting:!1});case 17:return e.finish(14);case 18:return e.next=20,a.setState({modalVisible:!1,modalContent:null});case 20:case"end":return e.stop()}},e,null,[[5,11,14,18]])}));return function(t){return e.apply(this,arguments)}}(),a.examineEmailApplication=w()(v.a.mark(function e(){var t,n,i,l,r,o,c,s,p=arguments;return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:null,n=a.state,i=n.schoolsSelectOptions,l=n.submitting,r=null===t?["\u5ba1\u6279\u7535\u5b50\u90ae\u7bb1\u7533\u8bf7","\u5ba1\u6279"]:["\u7f16\u8f91\u7535\u5b50\u90ae\u7bb1\u7533\u8bf7","\u7f16\u8f91"],o=f()(r,2),c=o[0],s=o[1],e.next=5,a.setState({emailApplication:t?g()({},t,{owner:"".concat(t["owner_detail"]["name"],"(").concat(t["owner_detail"]["id"],")")}):{}});case 5:return e.next=7,a.setState({modalTitle:c,modalContent:B.a.createElement(ne,{emailApplication:a.state.emailApplication,schools:i,title:c,submitButtonText:s,onSubmit:a.onEmailApplicationExamineSubmit,submitting:l}),submitButtonText:s,modalVisible:!0});case 7:case"end":return e.stop()}},e)})),a.onEmailApplicationExamineSubmit=function(){var e=w()(v.a.mark(function e(t){var n,i,l;return v.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.props.dispatch,i=a.state.emailApplication,l=g()({},t,{approved:!!t["approved"]}),console.warn("new values: ",l),e.prev=4,e.next=7,a.setState({submitting:!0});case 7:n({type:"network-services/email-applications/examine",payload:g()({},t,{id:i.id}),callback:function(){return a.fetchEmailApplications()}}),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](4),console.log(e.t0);case 13:return e.prev=13,e.next=16,a.setState({submitting:!1});case 16:return e.finish(13);case 17:return e.next=19,a.setState({modalVisible:!1,modalContent:null});case 19:case"end":return e.stop()}},e,null,[[4,10,13,17]])}));return function(t){return e.apply(this,arguments)}}(),a}return j()(t,e),A()(t,[{key:"componentDidMount",value:function(){this.fetchEmailApplications(),this.fetchSchools()}},{key:"render",value:function(){var e=this,t=this.props,a=t.isAdminOrIsNetworkServicesAdmin,d=t.list,h=t.pagination,f=t.loading,b=this.state,v=b.schoolsOptions,E=b.filtered,w=b.filterVisible,x=b.modalTitle,g=b.modalContent,k=b.modalVisible;return console.warn("list, pages, loading:",d,h,f),B.a.createElement(z["a"],{title:"\u7535\u5b50\u90ae\u7bb1\u7533\u8bf7\u7ba1\u7406"},B.a.createElement(n["a"],{bordered:!1},h&&B.a.createElement(_["a"],null,h.total),B.a.createElement(m["a"],{title:x,visible:k,onCancel:this.handleCancel,footer:null},g||B.a.createElement(u["a"],{spinning:f})),B.a.createElement(p["a"],{type:"primary",onClick:function(){return e.editEmailApplication()}},"\u7533\u8bf7\u7535\u5b50\u90ae\u7bb1"),B.a.createElement(F["a"],{dataSource:d,loading:f,rowKey:"id",onChange:this.handleTableChange,pagination:h,width:1920,scroll:{x:1920}},B.a.createElement(ie,{title:"\u7535\u5b50\u90ae\u7bb1",dataIndex:"email",filterDropdown:B.a.createElement("div",{className:"table-input-search"},B.a.createElement(s["a"],{placeholder:"\u540d\u79f0",value:this.state.searchText,onChange:this.onInputChange,onPressEnter:this.onEmailApplicationSearch}),B.a.createElement(p["a"],{type:"primary",onClick:this.onEmailApplicationSearch},"\u68c0\u7d22")),filterIcon:B.a.createElement(c["a"],{type:"search",style:{color:E?"#108ee9":"#aaa"}}),filterDropdownVisible:w,onFilterDropdownVisibleChange:function(t){e.setState({filterVisible:t})}}),B.a.createElement(ie,{title:"\u90e8\u95e8",dataIndex:"school",render:function(e,t){return t["school_detail"]?t["school_detail"]["name"]:""},filters:v}),B.a.createElement(ie,{title:"\u8d1f\u8d23\u4eba",dataIndex:"owner",render:function(e,t){return t["owner_detail"]?t["owner_detail"]["name"]:t["owner"]}}),B.a.createElement(ie,{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"created",sorter:!0}),B.a.createElement(ie,{title:"\u6700\u540e\u4fee\u6539\u65f6\u95f4",dataIndex:"modified",sorter:!0}),B.a.createElement(ie,{title:"\u63d0\u4ea4",dataIndex:"submitted",render:function(e){return e?B.a.createElement(o["a"],{status:"success",text:"\u5df2\u63d0\u4ea4"}):B.a.createElement(o["a"],{status:"error",text:"\u672a\u63d0\u4ea4"})}}),B.a.createElement(ie,{title:"\u7533\u8bf7\u4eba",dataIndex:"person",render:function(e,t){return t["person_detail"]?t["person_detail"]["name"]:t["person"]}}),B.a.createElement(ie,{title:"\u5907\u6ce8",dataIndex:"notes"}),B.a.createElement(ie,{title:"\u5ba1\u6838\u7ed3\u679c",dataIndex:"approved",render:function(e){return!1===e?B.a.createElement(o["a"],{status:"error",text:"\u672a\u901a\u8fc7"}):!0===e?B.a.createElement(o["a"],{status:"success",text:"\u5df2\u901a\u8fc7"}):B.a.createElement(o["a"],{status:"default",text:"\u5f85\u5ba1\u6838"})}}),B.a.createElement(ie,{title:"\u5ba1\u6838\u610f\u89c1",dataIndex:"opinion"}),B.a.createElement(ie,{title:Object(M["formatMessage"])({id:"app.networkServices.examiner"}),dataIndex:"examiner",render:function(e,t){return t["examiner_detail"]?t["examiner_detail"]["name"]:t["examiner"]}}),B.a.createElement(ie,{title:Object(M["formatMessage"])({id:"common.operations"}),width:152,fixed:"right",render:function(t,n){return B.a.createElement("div",null,B.a.createElement("a",{onClick:function(){return e.editEmailApplication(n)}}," ",Object(M["formatMessage"])({id:"common.edit"})),B.a.createElement("span",{className:"ant-divider"}),B.a.createElement(i["a"],{overlay:B.a.createElement(r["a"],null,a&&B.a.createElement(r["a"].Item,null,B.a.createElement("a",{onClick:function(){return e.examineEmailApplication(n)}},Object(M["formatMessage"])({id:"common.examine"}))),B.a.createElement(r["a"].Item,null,B.a.createElement(l["a"],{title:Object(M["formatMessage"])({id:"common.delete-ask"}),onConfirm:function(){return e.deleteEmailApplication(n)}},B.a.createElement(M["FormattedMessage"],{id:"common.delete"}))))},B.a.createElement("a",{className:"ant-dropdown-link"},B.a.createElement(M["FormattedMessage"],{id:"common.more"})," ",B.a.createElement(c["a"],{type:"down"}))))}}))))}}]),t}(N["PureComponent"]),te=ae))||te);t["default"]=le}}]);