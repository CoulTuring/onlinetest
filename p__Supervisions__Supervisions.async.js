(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[107],{EHC5:function(e,t,a){"use strict";a.r(t);a("IzEo");var n=a("bx4M"),s=(a("qVdP"),a("jsC+")),o=(a("lUTK"),a("BvKs")),i=(a("P2fV"),a("NJEC")),r=(a("Awhp"),a("KrTs")),l=(a("Pwec"),a("CtXQ")),c=(a("5NDa"),a("5rEg")),p=(a("+L6B"),a("2/Rp")),u=(a("2qtc"),a("kLXV")),d=(a("T2oS"),a("W9HT")),m=(a("miYZ"),a("tsqr")),f=a("qIgq"),h=a.n(f),v=a("d6i3"),b=a.n(v),g=a("1l/V"),O=a.n(g),S=a("p0pE"),w=a.n(S),C=a("2Taf"),E=a.n(C),y=a("vZ4D"),j=a.n(y),M=a("l4Ni"),x=a.n(M),k=a("ujKo"),T=a.n(k),P=a("MhPg"),V=a.n(P),I=(a("g9YV"),a("wCAj")),D=a("q1tI"),F=a.n(D),_=a("MuoO"),z=a("LLXN"),N=a("zHco"),q=a("FkSf"),B=(a("y8nQ"),a("Vl3Y")),K=a("d/v1"),Y=a("pJVQ"),A=a("p9nB"),J=a("WAby"),L=a("6NK7"),W=a("Tt/K"),X=function(e){},H=function(e){function t(){var e,a;E()(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return a=x()(this,(e=T()(t)).call.apply(e,[this].concat(s))),a.state={schoolsOptions:[],peopleOptions:[],selectedSchools:[],selectedPeople:[]},a.fetchSchools=function(){var e=a.props.dispatch;e({type:"schools/schools/fetchPublic",payload:{},callback:a.fetchSchoolsCallback})},a.fetchSchoolsCallback=function(e){a.setState({schoolsOptions:L["a"].transferObjectsToSelectOptionsWithoutID(e)})},a.searchPeople=function(){var e=O()(b.a.mark(function e(t){var n;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=a.props.dispatch,a.setState({loading:!0}),n({type:"people/people/search",payload:{person:t},callback:a.searchPeopleCallback});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.searchPeopleCallback=function(e){var t=L["a"].transferObjectsToSelectOptions(e);a.state.selectedPeople.forEach(function(e){return t.findIndex(function(t){return t.id===e.id})<0&&t.push(e)}),a.setState({peopleOptions:t,loading:!1})},a.handlePeopleSelect=function(){var e=O()(b.a.mark(function e(t){return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({selectedPeople:a.state.selectedPeople.concat(a.state.peopleOptions.filter(function(e){return e.id===t}))});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.handlePeopleDeselect=function(){var e=O()(b.a.mark(function e(t){return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({selectedPeople:a.state.selectedPeople.filter(function(e){return e.id!==t})});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return V()(t,e),j()(t,[{key:"componentDidMount",value:function(){var e=this.props.supervision;if(this.fetchSchools(),e){var t=e["schools_relations"].map(function(e){return e.school}),a=L["a"].transferObjectsToSelectOptions(t),n=e["people_relations"].map(function(e){return e.person}),s=L["a"].transferObjectsToSelectOptions(n);console.warn(a,s),this.setState({peopleOptions:s,schoolsOptions:a,selectedSchools:a,selectedPeople:s})}}},{key:"render",value:function(){var e=this.props,t=e.supervision,a=e.handleSubmit,n=e.submitButtonText,s=e.submitting,o=e.searching,i=this.state,r=i.schoolsOptions,l=i.peopleOptions;return console.warn(t,r,l),F.a.createElement("div",null,F.a.createElement(B["a"],{onSubmit:a,layout:"horizontal",className:"modal-form"},F.a.createElement(K["a"],{name:"title",type:"text",size:"default",label:Object(z["formatMessage"])({id:"common.title"}),required:!0,hasFeedback:!0,validate:[J["g"]],labelCol:{span:6},wrapperCol:{span:18},component:A["f"]}),F.a.createElement(K["a"],{name:"decision_type",type:"text",size:"default",label:Object(z["formatMessage"])({id:"app.supervisions.decisionType"}),required:!0,hasFeedback:!0,validate:[J["g"]],labelCol:{span:6},wrapperCol:{span:18},component:A["g"]}),F.a.createElement(K["a"],{name:"schools",size:"default",label:Object(z["formatMessage"])({id:"app.supervisions.responsibleSchools"}),labelCol:{span:6},wrapperCol:{span:18},options:r,defaultValue:[],mode:"multiple",component:A["d"]}),F.a.createElement(K["a"],{name:"people",size:"default",label:Object(z["formatMessage"])({id:"app.supervisions.responsiblePeople"}),labelCol:{span:6},wrapperCol:{span:18},options:l,defaultValue:[],mode:"multiple",filterOption:!1,onFocus:this.searchPeople,onSearch:this.searchPeople,onSelect:this.handlePeopleSelect,onDeselect:this.handlePeopleDeselect,notFoundContent:o?F.a.createElement(d["a"],{size:"small"}):null,component:A["d"]}),F.a.createElement(K["a"],{name:"status",size:"default",label:Object(z["formatMessage"])({id:"app.supervisions.status"}),labelCol:{span:6},wrapperCol:{span:18},required:!0,hasFeedback:!0,validate:[J["g"]],options:W["t"],component:A["d"]}),F.a.createElement(K["a"],{name:"due_date",type:"date",size:"default",label:Object(z["formatMessage"])({id:"app.supervisions.dueDate"}),labelCol:{span:6},wrapperCol:{span:12,offset:0},component:A["a"],dateTimeFormat:"YYYY-MM-DD"}),F.a.createElement(K["a"],{name:"notes",type:"text",size:"default",placeholder:"",label:Object(z["formatMessage"])({id:"common.notes"}),labelCol:{span:6},wrapperCol:{span:18},component:A["f"]}),F.a.createElement(K["a"],{name:"visible",label:Object(z["formatMessage"])({id:"common.visible"}),size:"default",labelCol:{span:6},wrapperCol:{span:18},defaultChecked:!0,checkedChildren:Object(z["formatMessage"])({id:"common.visible-to-all"}),unCheckedChildren:Object(z["formatMessage"])({id:"common.visible-to-admin"}),component:A["e"]}),F.a.createElement(p["a"],{type:"primary",htmlType:"submit",disabled:s,className:"modal-form-button"},n)))}}]),t}(F.a.Component),Q=Object(Y["a"])({form:"supervisionForm",validate:X})(H);function Z(e,t){var a=t.supervision;return{searching:e.loading.effects["people/people/search"],initialValues:a,supervision:t.supervision,submitButtonText:t.submitButtonText||Object(z["formatMessage"])({id:"common.submit"})}}var R,U,G,$=Object(_["connect"])(Z)(Q),ee=a("X3JL"),te=I["a"].Column,ae=(R=Object(_["connect"])(function(e){return{loading:e.loading.effects["supervisions/supervisions/fetch"],list:e["supervisions/supervisions"].data.list,pagination:e["supervisions/supervisions"].data.pagination}}),R((G=function(e){function t(){var e,a;E()(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return a=x()(this,(e=T()(t)).call.apply(e,[this].concat(s))),a.state={supervision:null,schoolsOptions:[],schoolsSelectOptions:[],ordering:"",filters:null,filterVisible:!1,filtered:!1,searchText:"",modalTitle:"",modalContent:null,submitButtonText:"",modalVisible:!1,submitting:!1},a.fetchSupervisions=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.props,n=t.dispatch,s=t.pagination,o=a.state,i=o.ordering,r=o.filters,l=o.searchText;n(e?{type:"supervisions/supervisions/fetch",payload:e}:{type:"supervisions/supervisions/fetch",payload:w()({search:l,page:s?s.current:1,ordering:i},r)})},a.fetchSchools=function(){var e=a.props.dispatch;e({type:"schools/schools/fetchPublic",payload:{},callback:a.fetchSchoolsCallback})},a.fetchSchoolsCallback=function(e){a.setState({schoolsOptions:L["a"].transferObjectsToFilterOptions(e),schoolsSelectOptions:L["a"].transferObjectsToSelectOptionsWithoutID(e)})},a.handleTableChange=function(){var e=O()(b.a.mark(function e(t,n,s){var o,i;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return o=a.state.searchText,i=L["a"].transferSorterToOrdering(s),e.next=4,a.fetchSupervisions(w()({search:o,page:t.current,ordering:i},n));case 4:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.editSupervision=O()(b.a.mark(function e(){var t,n,s,o,i,r,l,c,p=arguments;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:null,n=a.state,s=n.schoolsSelectOptions,o=n.submitting,i=null===t?[Object(z["formatMessage"])({id:"operations.create"},{name:Object(z["formatMessage"])({id:"app.supervisions.supervision"})}),Object(z["formatMessage"])({id:"common.create"})]:[Object(z["formatMessage"])({id:"operations.edit"},{name:Object(z["formatMessage"])({id:"app.supervisions.supervision"})}),Object(z["formatMessage"])({id:"common.edit"})],r=h()(i,2),l=r[0],c=r[1],e.next=5,a.setState({supervision:t?w()({},t):null});case 5:return e.next=7,a.setState({modalTitle:l,modalContent:F.a.createElement($,{supervision:a.state.supervision,schools:s,title:l,submitButtonText:c,onSubmit:a.onSubmit,submitting:o}),submitButtonText:c,modalVisible:!0});case 7:case"end":return e.stop()}},e)})),a.deleteSupervision=function(){var e=O()(b.a.mark(function e(t){var n;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=a.props.dispatch,n({type:"supervisions/supervisions/remove",payload:{supervision:t},callback:function(){return a.deleteSupervisionCallback(t["title"])}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.deleteSupervisionCallback=function(e){m["a"].success("".concat(Object(z["formatMessage"])({id:"operations.success-delete"},{name:Object(z["formatMessage"])({id:"app.supervisions.supervisions"})})," ").concat(e)),a.fetchSupervisions()},a.onInputChange=function(e){a.setState({searchText:e.target.value})},a.onSupervisionSearch=O()(b.a.mark(function e(){var t,n,s,o;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=a.state,n=t.ordering,s=t.filters,o=t.searchText,e.next=3,a.fetchSupervisions(w()({search:o,page:1,ordering:n},s));case 3:a.setState({filterVisible:!1,filtered:!!o});case 4:case"end":return e.stop()}},e)})),a.handleCancel=O()(b.a.mark(function e(){return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({modalVisible:!1,modalContent:null});case 2:case"end":return e.stop()}},e)})),a.onSubmit=function(){var e=O()(b.a.mark(function e(t){var n,s,o;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.props.dispatch,s=a.state.supervision,o=w()({},t,{visible:!!t["visible"]}),console.warn("new values: ",o),e.prev=4,e.next=7,a.setState({submitting:!0});case 7:s&&s["id"]?n({type:"supervisions/supervisions/update",payload:{supervision:w()({},o)},callback:function(){return a.onSubmitCallback("".concat(Object(z["formatMessage"])({id:"operations.success-edit"},{name:Object(z["formatMessage"])({id:"app.supervisions.supervisions"})})))}}):n({type:"supervisions/supervisions/add",payload:{supervision:o},callback:function(){return a.onSubmitCallback("".concat(Object(z["formatMessage"])({id:"operations.success-create"},{name:Object(z["formatMessage"])({id:"app.supervisions.supervisions"})})))}}),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](4),console.log(e.t0);case 13:return e.prev=13,e.next=16,a.setState({submitting:!1});case 16:return e.finish(13);case 17:return e.next=19,a.setState({modalVisible:!1,modalContent:null});case 19:case"end":return e.stop()}},e,null,[[4,10,13,17]])}));return function(t){return e.apply(this,arguments)}}(),a}return V()(t,e),j()(t,[{key:"componentDidMount",value:function(){this.fetchSupervisions(),this.fetchSchools()}},{key:"onSubmitCallback",value:function(e){m["a"].success(e),this.fetchSupervisions()}},{key:"render",value:function(){var e=this,t=this.props,a=t.list,m=t.pagination,f=t.loading,h=this.state,v=(h.schoolsOptions,h.filtered),b=h.filterVisible,g=h.modalTitle,O=h.modalContent,S=h.modalVisible;return console.warn("list, pages, loading:",a,m,f),F.a.createElement(N["a"],{title:Object(z["formatMessage"])({id:"operations.management"},{name:Object(z["formatMessage"])({id:"app.supervisions.supervisions"})})},F.a.createElement(n["a"],{bordered:!1},m&&F.a.createElement(q["a"],null,m.total),F.a.createElement(u["a"],{title:g,visible:S,onCancel:this.handleCancel,footer:null},O||F.a.createElement(d["a"],{spinning:f})),F.a.createElement(p["a"],{type:"primary",onClick:function(){return e.editSupervision()}},F.a.createElement(z["FormattedMessage"],{id:"operations.create",values:{name:Object(z["formatMessage"])({id:"app.supervisions.supervision"})}})),F.a.createElement(ee["a"],null),F.a.createElement(I["a"],{dataSource:a,loading:f,rowKey:"id",onChange:this.handleTableChange,pagination:m,width:1600,scroll:{x:1600}},F.a.createElement(te,{title:Object(z["formatMessage"])({id:"common.title"}),dataIndex:"title",width:400,filterDropdown:F.a.createElement("div",{className:"table-input-search"},F.a.createElement(c["a"],{placeholder:Object(z["formatMessage"])({id:"common.title"}),value:this.state.searchText,onChange:this.onInputChange,onPressEnter:this.onSupervisionSearch}),F.a.createElement(p["a"],{type:"primary",onClick:this.onSupervisionSearch},F.a.createElement(z["FormattedMessage"],{id:"common.search"}))),filterIcon:F.a.createElement(l["a"],{type:"search",style:{color:v?"#108ee9":"#aaa"}}),filterDropdownVisible:b,onFilterDropdownVisibleChange:function(t){e.setState({filterVisible:t})}}),F.a.createElement(te,{title:Object(z["formatMessage"])({id:"app.supervisions.decisionType"}),dataIndex:"decision_type",width:144}),F.a.createElement(te,{title:Object(z["formatMessage"])({id:"app.supervisions.responsibleSchools"}),dataIndex:"schools_relations",width:168,render:function(e,t){return F.a.createElement("div",null,t["schools_relations"].map(function(e){return e.school["full_name"]+"  "}))}}),F.a.createElement(te,{title:Object(z["formatMessage"])({id:"app.supervisions.responsiblePeople"}),dataIndex:"people_relations",width:120,render:function(e,t){return F.a.createElement("div",null,t["people_relations"].map(function(e){return e.person.name+"  "}))}}),F.a.createElement(te,{title:Object(z["formatMessage"])({id:"app.supervisions.status"}),dataIndex:"status",width:92,render:function(e,t){return t["get_status_display"]},filters:W["t"].map(function(e){return{text:e.label,value:e.value}})}),F.a.createElement(te,{title:Object(z["formatMessage"])({id:"app.supervisions.dueDate"}),dataIndex:"due_date",width:144,sorter:!0}),F.a.createElement(te,{title:Object(z["formatMessage"])({id:"common.notes"}),dataIndex:"notes"}),F.a.createElement(te,{title:Object(z["formatMessage"])({id:"common.visible"}),dataIndex:"visible",render:function(e){return e?F.a.createElement(r["a"],{status:"success",text:Object(z["formatMessage"])({id:"common.visible"})}):F.a.createElement(r["a"],{status:"default",text:Object(z["formatMessage"])({id:"common.invisible"})})}}),F.a.createElement(te,{title:Object(z["formatMessage"])({id:"common.operations"}),width:152,fixed:"right",render:function(t,a){return F.a.createElement("div",null,F.a.createElement("a",{onClick:function(){return e.editSupervision(a)}}," ",Object(z["formatMessage"])({id:"common.edit"})),F.a.createElement("span",{className:"ant-divider"}),F.a.createElement(s["a"],{overlay:F.a.createElement(o["a"],null,F.a.createElement(o["a"].Item,null,F.a.createElement(i["a"],{title:Object(z["formatMessage"])({id:"common.delete-ask"}),onConfirm:function(){return e.deleteSupervision(a)}},F.a.createElement("a",{href:"#"},F.a.createElement(z["FormattedMessage"],{id:"common.delete"})))))},F.a.createElement("a",{className:"ant-dropdown-link"},F.a.createElement(z["FormattedMessage"],{id:"common.more"})," ",F.a.createElement(l["a"],{type:"down"}))))}}))))}}]),t}(D["PureComponent"]),U=G))||U);t["default"]=ae}}]);