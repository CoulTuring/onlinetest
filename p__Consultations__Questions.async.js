(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[20],{"9oAe":function(e,t,a){e.exports={questionExpandedTable:"antd-pro-pages-consultations-consultations-questionExpandedTable",headCell:"antd-pro-pages-consultations-consultations-headCell"}},"iq/T":function(e,t,a){"use strict";a.r(t);a("IzEo");var n=a("bx4M"),o=(a("qVdP"),a("jsC+")),s=(a("lUTK"),a("BvKs")),i=(a("P2fV"),a("NJEC")),r=(a("Awhp"),a("KrTs")),l=(a("Pwec"),a("CtXQ")),c=(a("5NDa"),a("5rEg")),u=(a("sRBo"),a("kaz8")),m=(a("+L6B"),a("2/Rp")),d=(a("2qtc"),a("kLXV")),p=(a("T2oS"),a("W9HT")),f=(a("miYZ"),a("tsqr")),b=a("qIgq"),h=a.n(b),g=a("p0pE"),v=a.n(g),E=a("d6i3"),y=a.n(E),C=a("1l/V"),w=a.n(C),O=a("2Taf"),j=a.n(O),x=a("vZ4D"),k=a.n(x),M=a("l4Ni"),q=a.n(M),S=a("ujKo"),Q=a.n(S),T=a("MhPg"),R=a.n(T),A=(a("tU7J"),a("wFql")),B=(a("g9YV"),a("wCAj")),I=a("q1tI"),V=a.n(I),N=a("MuoO"),_=a("LLXN"),F=a("ikXu"),D=a("zHco"),P=a("FkSf"),z=a("H/rY"),J=(a("y8nQ"),a("Vl3Y")),K=a("d/v1"),L=a("pJVQ"),X=a("p9nB"),W=(a("WAby"),function(e){}),Y=function(e){function t(){var e,a;j()(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return a=q()(this,(e=Q()(t)).call.apply(e,[this].concat(o))),a.state={},a}return R()(t,e),k()(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.question,a=e.handleSubmit,n=e.submitButtonText,o=e.submitting;return V.a.createElement("div",null,t["title"],V.a.createElement(J["a"],{onSubmit:a,layout:"horizontal",className:"modal-form"},V.a.createElement(K["a"],{name:"content",type:"text",size:"default",placeholder:"",label:Object(_["formatMessage"])({id:"common.reply"}),hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},rows:8,component:X["f"]}),V.a.createElement(m["a"],{type:"primary",htmlType:"submit",disabled:o,className:"modal-form-button"},n)))}}]),t}(V.a.Component),H=Object(L["a"])({form:"consultationReplyForm",validate:W})(Y);function U(e,t){var a=t.question,n=t.reply;return{initialValues:n,question:a,submitButtonText:t.submitButtonText||Object(_["formatMessage"])({id:"common.submit"})}}var Z,G,$,ee=Object(N["connect"])(U)(H),te=a("6NK7"),ae=a("9oAe"),ne=a.n(ae),oe=a("34ay"),se=a("X3JL"),ie=B["a"].Column,re=A["a"].Text,le=function(e){var t=e.question;return V.a.createElement("div",null,V.a.createElement(F["a"],{definition:!0,className:ne.a.questionExpandedTable},V.a.createElement(F["a"].Body,null,V.a.createElement(F["a"].Row,null,V.a.createElement(F["a"].Cell,{textAlign:"right",className:ne.a.headCell},Object(_["formatMessage"])({id:"common.content"})),V.a.createElement(F["a"].Cell,null,t.content)),V.a.createElement(F["a"].Row,null,V.a.createElement(F["a"].Cell,{textAlign:"right",className:ne.a.headCell},Object(_["formatMessage"])({id:"app.consultations.consultation-created-datetime"})),V.a.createElement(F["a"].Cell,null,t["created"])),V.a.createElement(F["a"].Row,null,V.a.createElement(F["a"].Cell,{textAlign:"right",className:ne.a.headCell},Object(_["formatMessage"])({id:"app.consultations.consultation-last-modified-datetime"})),V.a.createElement(F["a"].Cell,null,t["modified"])),V.a.createElement(F["a"].Row,null,V.a.createElement(F["a"].Cell,{textAlign:"right",className:ne.a.headCell},Object(_["formatMessage"])({id:"common.reply"})),V.a.createElement(F["a"].Cell,null,t&&t["replies"]&&t["replies"].length>0&&V.a.createElement(V.a.Fragment,null,t["replies"][0]["content"]))),V.a.createElement(F["a"].Row,null,V.a.createElement(F["a"].Cell,{textAlign:"right",className:ne.a.headCell},Object(_["formatMessage"])({id:"app.consultations.reply-datetime"})),V.a.createElement(F["a"].Cell,null,t&&t["replies"]&&t["replies"].length>0&&V.a.createElement(V.a.Fragment,null,t["replies"][0]["created"]))),V.a.createElement(F["a"].Row,null,V.a.createElement(F["a"].Cell,{textAlign:"right",className:ne.a.headCell},Object(_["formatMessage"])({id:"app.consultations.upvote_counts"})),V.a.createElement(F["a"].Cell,null,t["upvote_counts"])),V.a.createElement(F["a"].Row,null,V.a.createElement(F["a"].Cell,{textAlign:"right",className:ne.a.headCell},Object(_["formatMessage"])({id:"app.consultations.approver"})),V.a.createElement(F["a"].Cell,null,t["approver_detail"]?t["approver_detail"]["name"]:"")),V.a.createElement(F["a"].Row,null,V.a.createElement(F["a"].Cell,{textAlign:"right",className:ne.a.headCell},Object(_["formatMessage"])({id:"app.consultations.approved_datetime"})),V.a.createElement(F["a"].Cell,null,t["approved_datetime"])))))},ce=(Z=Object(N["connect"])(function(e){return{loading:e.loading.effects["consultations/questions/fetch"],list:e["consultations/questions"].data.list,pagination:e["consultations/questions"].data.pagination}}),Z(($=function(e){function t(){var e,a;j()(this,t);for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return a=q()(this,(e=Q()(t)).call.apply(e,[this].concat(o))),a.state={question:null,boardsOptions:[],boardsSelectOptions:[],mine:!1,onlyAuthenticated:!1,consultationsAdminBoards:[],consultationsReviewerBoards:[],ordering:"",filters:null,filterVisible:!1,filtered:!1,searchText:"",modalTitle:"",modalContent:null,submitButtonText:"",modalVisible:!1,submitting:!1},a.init=w()(y.a.mark(function e(){var t,n;return y.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=Object(oe["c"])(),n=Object(oe["b"])(),t.includes("admin")||t.includes("consultationsAdmin")||t.includes("consultationsReviewer")){e.next=5;break}return e.next=5,a.setState({onlyAuthenticated:!0,mine:!0});case 5:a.fetchQuestions(),a.fetchBoards(),t.includes("consultationsAdmin")&&a.setState({consultationsAdminBoards:n["consultations_admin_boards"]}),t.includes("consultationsReviewer")&&a.setState({consultationsReviewerBoards:n["consultations_reviewer_boards"]});case 9:case"end":return e.stop()}},e)})),a.fetchQuestions=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.props,n=t.dispatch,o=t.pagination,s=a.state,i=s.mine,r=s.ordering,l=s.filters,c=s.searchText;n(e?{type:"consultations/questions/fetch",payload:v()({},e,{mine:i})}:{type:"consultations/questions/fetch",payload:v()({mine:i,search:c,page:o?o.current:1,ordering:r},l)})},a.fetchBoards=function(){var e=a.props.dispatch;e({type:"consultations/boards/fetchPublic",payload:{},callback:a.fetchBoardsCallback})},a.fetchBoardsCallback=function(e){a.setState({boardsOptions:te["a"].transferObjectsToFilterOptions(e),boardsSelectOptions:te["a"].transferObjectsToSelectOptionsWithoutID(e)})},a.handleTableChange=function(){var e=w()(y.a.mark(function e(t,n,o){var s,i;return y.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return s=a.state.searchText,i=te["a"].transferSorterToOrdering(o),e.next=4,a.fetchQuestions(v()({search:s,page:t.current,ordering:i},n));case 4:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.editQuestion=w()(y.a.mark(function e(){var t,n,o,s,i,r,l,c,u=arguments;return y.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:null,n=a.state,o=n.boardsSelectOptions,s=n.submitting,i=null===t?[Object(_["formatMessage"])({id:"operations.create"},{name:Object(_["formatMessage"])({id:"app.consultations.questions"})}),Object(_["formatMessage"])({id:"common.create"})]:[Object(_["formatMessage"])({id:"operations.edit"},{name:Object(_["formatMessage"])({id:"app.consultations.questions"})}),Object(_["formatMessage"])({id:"common.edit"})],r=h()(i,2),l=r[0],c=r[1],e.next=5,a.setState({question:t?v()({},t):{}});case 5:return e.next=7,a.setState({modalTitle:l,modalContent:V.a.createElement(z["a"],{question:a.state.question,boards:o,title:l,submitButtonText:c,onSubmit:a.onSubmit,submitting:s}),submitButtonText:c,modalVisible:!0});case 7:case"end":return e.stop()}},e)})),a.deleteQuestion=function(){var e=w()(y.a.mark(function e(t){var n;return y.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=a.props.dispatch,n({type:"consultations/questions/remove",payload:{question:t},callback:function(){return a.deleteQuestionCallback(t["title"])}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.deleteQuestionCallback=function(e){f["a"].success("".concat(Object(_["formatMessage"])({id:"operations.success-delete"},{name:Object(_["formatMessage"])({id:"app.consultations.questions"})})," ").concat(e)),a.fetchQuestions()},a.editReply=w()(y.a.mark(function e(){var t,n,o,s,i,r,l,c=arguments;return y.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:null,n=a.state.submitting,o=t&&t["replies"].length>0?t["replies"][0]:null,s=null===o?[Object(_["formatMessage"])({id:"operations.create"},{name:Object(_["formatMessage"])({id:"common.reply"})}),Object(_["formatMessage"])({id:"common.create"})]:[Object(_["formatMessage"])({id:"operations.edit"},{name:Object(_["formatMessage"])({id:"common.reply"})}),Object(_["formatMessage"])({id:"common.edit"})],i=h()(s,2),r=i[0],l=i[1],e.next=6,a.setState({question:t?v()({},t):{}});case 6:return e.next=8,a.setState({modalTitle:r,modalContent:V.a.createElement(ee,{question:a.state.question,reply:o,title:r,submitButtonText:l,onSubmit:a.onReplySubmit,submitting:n}),submitButtonText:l,modalVisible:!0});case 8:case"end":return e.stop()}},e)})),a.approveQuestion=function(){var e=w()(y.a.mark(function e(t,n){var o;return y.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:o=a.props.dispatch,o(n?{type:"consultations/questions/approve",payload:{questionId:t["id"]},callback:function(){return a.approveQuestionCallback(t["title"],n)}}:{type:"consultations/questions/disapprove",payload:{questionId:t["id"]},callback:function(){return a.approveQuestionCallback(t["title"],n)}});case 2:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.approveQuestionCallback=function(e,t){f["a"].success(t?"".concat(Object(_["formatMessage"])({id:"operations.success-approve"},{name:Object(_["formatMessage"])({id:"app.consultations.questions"})})," ").concat(e):"".concat(Object(_["formatMessage"])({id:"operations.success-disapprove"},{name:Object(_["formatMessage"])({id:"app.consultations.questions"})})," ").concat(e)),a.fetchQuestions()},a.topQuestion=function(){var e=w()(y.a.mark(function e(t,n){var o;return y.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:o=a.props.dispatch,o(n?{type:"consultations/questions/top",payload:{questionId:t["id"]},callback:function(){return a.topQuestionCallback(t["title"],n)}}:{type:"consultations/questions/untop",payload:{questionId:t["id"]},callback:function(){return a.topQuestionCallback(t["title"],n)}});case 2:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.topQuestionCallback=function(e,t){f["a"].success(t?"".concat(Object(_["formatMessage"])({id:"operations.success-top"},{name:Object(_["formatMessage"])({id:"app.consultations.questions"})})," ").concat(e):"".concat(Object(_["formatMessage"])({id:"operations.success-untop"},{name:Object(_["formatMessage"])({id:"app.consultations.questions"})})," ").concat(e)),a.fetchQuestions()},a.onInputChange=function(e){a.setState({searchText:e.target.value})},a.onQuestionSearch=w()(y.a.mark(function e(){var t,n,o,s;return y.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=a.state,n=t.ordering,o=t.filters,s=t.searchText,e.next=3,a.fetchQuestions(v()({search:s,page:1,ordering:n},o));case 3:a.setState({filterVisible:!1,filtered:!!s});case 4:case"end":return e.stop()}},e)})),a.handleCancel=w()(y.a.mark(function e(){return y.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({modalVisible:!1,modalContent:null});case 2:case"end":return e.stop()}},e)})),a.onSubmit=function(){var e=w()(y.a.mark(function e(t){var n,o,s;return y.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.props.dispatch,o=a.state.question,s=v()({},t,{visible:!!t["visible"]}),console.warn("new values: ",s),e.prev=4,e.next=7,a.setState({submitting:!0});case 7:o&&o["id"]?n({type:"consultations/questions/update",payload:{question:v()({},s)},callback:function(){return a.onSubmitCallback("\u4fee\u6539\u95ee\u9898\u6210\u529f")}}):n({type:"consultations/questions/add",payload:{question:s},callback:function(){return a.onSubmitCallback("\u521b\u5efa\u95ee\u9898\u6210\u529f")}}),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](4),console.log(e.t0);case 13:return e.prev=13,e.next=16,a.setState({submitting:!1});case 16:return e.finish(13);case 17:return e.next=19,a.setState({modalVisible:!1,modalContent:null});case 19:case"end":return e.stop()}},e,null,[[4,10,13,17]])}));return function(t){return e.apply(this,arguments)}}(),a.onReplySubmit=function(){var e=w()(y.a.mark(function e(t){var n,o,s,i;return y.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.props.dispatch,o=a.state.question,s=o&&o["replies"].length>0?a.state.question["replies"][0]:null,i=v()({},t,{question:o["id"],reply:s&&s["id"]}),console.warn("new reply values: ",i),e.prev=5,e.next=8,a.setState({submitting:!0});case 8:s&&s["id"]?n({type:"consultations/replies/update",payload:{reply:v()({},i)},callback:function(){return a.onReplySubmitCallback("\u4fee\u6539\u56de\u590d\u6210\u529f")}}):n({type:"consultations/replies/add",payload:{reply:i},callback:function(){return a.onReplySubmitCallback("\u521b\u5efa\u56de\u590d\u6210\u529f")}}),e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](5),console.log(e.t0);case 14:return e.prev=14,e.next=17,a.setState({submitting:!1});case 17:return e.finish(14);case 18:return e.next=20,a.setState({modalVisible:!1,modalContent:null});case 20:case"end":return e.stop()}},e,null,[[5,11,14,18]])}));return function(t){return e.apply(this,arguments)}}(),a.onMineChange=function(){var e=w()(y.a.mark(function e(t){return y.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({mine:t.target.checked});case 2:a.fetchQuestions();case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return R()(t,e),k()(t,[{key:"componentDidMount",value:function(){this.init().then()}},{key:"onSubmitCallback",value:function(e){f["a"].success(e),this.fetchQuestions()}},{key:"onReplySubmitCallback",value:function(e){f["a"].success(e),this.fetchQuestions()}},{key:"render",value:function(){var e=this,t=this.props,a=t.list,f=t.pagination,b=t.loading,h=this.state,g=h.onlyAuthenticated,v=h.consultationsAdminBoards,E=h.consultationsReviewerBoards,y=h.boardsOptions,C=h.filtered,w=h.filterVisible,O=h.modalTitle,j=h.modalContent,x=h.modalVisible;return console.warn("list, pages, loading:",a,f,b),V.a.createElement(D["a"],{title:Object(_["formatMessage"])({id:"operations.management"},{name:Object(_["formatMessage"])({id:"app.consultations.questions"})})},V.a.createElement(n["a"],{bordered:!1},f&&V.a.createElement(P["a"],null,f.total),V.a.createElement(d["a"],{title:O,visible:x,onCancel:this.handleCancel,footer:null},j||V.a.createElement(p["a"],{spinning:b})),V.a.createElement(m["a"],{type:"primary",onClick:function(){return e.editQuestion()}},V.a.createElement(_["FormattedMessage"],{id:"operations.create",values:{name:Object(_["formatMessage"])({id:"app.consultations.questions"})}})),!g&&V.a.createElement(u["a"],{style:{marginLeft:16,fontSize:13,fontWeight:"500"},onChange:this.onMineChange},V.a.createElement(_["FormattedMessage"],{id:"app.consultations.only-my-questions"})),V.a.createElement(se["a"],null),V.a.createElement(B["a"],{dataSource:a,loading:b,rowKey:"id",onChange:this.handleTableChange,pagination:f,expandedRowRender:function(e){return V.a.createElement(le,{question:e})}},V.a.createElement(ie,{title:Object(_["formatMessage"])({id:"common.title"}),dataIndex:"title",filterDropdown:V.a.createElement("div",{className:"table-input-search"},V.a.createElement(c["a"],{placeholder:Object(_["formatMessage"])({id:"common.brand-name"}),value:this.state.searchText,onChange:this.onInputChange,onPressEnter:this.onQuestionSearch}),V.a.createElement(m["a"],{type:"primary",onClick:this.onQuestionSearch},V.a.createElement(_["FormattedMessage"],{id:"common.search"}))),filterIcon:V.a.createElement(l["a"],{type:"search",style:{color:C?"#108ee9":"#aaa"}}),filterDropdownVisible:w,onFilterDropdownVisibleChange:function(t){e.setState({filterVisible:t})}}),V.a.createElement(ie,{title:Object(_["formatMessage"])({id:"app.consultations.boards"}),dataIndex:"board",render:function(e,t){return t["board_detail"]?t["board_detail"]["name"]:""},filters:y}),V.a.createElement(ie,{title:Object(_["formatMessage"])({id:"common.author"}),dataIndex:"author",render:function(e,t){return t["author_detail"]?t["author_detail"]["name"]:""}}),V.a.createElement(ie,{title:Object(_["formatMessage"])({id:"common.top"}),dataIndex:"top",render:function(e){return e?V.a.createElement(r["a"],{status:"success",text:Object(_["formatMessage"])({id:"common.top"})}):null}}),V.a.createElement(ie,{title:Object(_["formatMessage"])({id:"common.approve-status"}),dataIndex:"approved",render:function(e){return e?V.a.createElement(r["a"],{status:"success",text:Object(_["formatMessage"])({id:"common.approved"})}):!1===e?V.a.createElement(r["a"],{status:"error",text:Object(_["formatMessage"])({id:"common.denied"})}):V.a.createElement(r["a"],{status:"default",text:Object(_["formatMessage"])({id:"common.wait-for-decide"})})}}),V.a.createElement(ie,{title:Object(_["formatMessage"])({id:"common.operations"}),width:152,render:function(t,a){return V.a.createElement("div",null,V.a.createElement("a",{onClick:function(){return e.editQuestion(a)}},Object(_["formatMessage"])({id:"common.edit"})),V.a.createElement("span",{className:"ant-divider"}),V.a.createElement(o["a"],{overlay:V.a.createElement(s["a"],null,V.a.createElement(s["a"].Item,null,a&&!a["approved"]?V.a.createElement(i["a"],{title:Object(_["formatMessage"])({id:"common.delete-ask"}),onConfirm:function(){return e.deleteQuestion(a)}},V.a.createElement("a",{href:"#"},V.a.createElement(_["FormattedMessage"],{id:"common.delete"}))):V.a.createElement(re,{disabled:!0},"\u5ba1\u6838\u901a\u8fc7\u540e\u65e0\u6cd5\u5220\u9664")),(Object(oe["f"])()||v.includes(a["board"])||E.includes(a["board"]))&&a&&!!a["approved"]&&V.a.createElement(s["a"].Item,null,V.a.createElement("a",{onClick:function(){return e.approveQuestion(a,!1)}},Object(_["formatMessage"])({id:"common.deny"}))),(Object(oe["f"])()||v.includes(a["board"])||E.includes(a["board"]))&&a&&!a["approved"]&&V.a.createElement(s["a"].Item,null,V.a.createElement("a",{onClick:function(){return e.approveQuestion(a,!0)}},Object(_["formatMessage"])({id:"common.approve"}))),(Object(oe["f"])()||v.includes(a["board"]))&&a&&!!a["top"]&&V.a.createElement(s["a"].Item,null,V.a.createElement("a",{onClick:function(){return e.topQuestion(a,!1)}},Object(_["formatMessage"])({id:"common.cancel-top"}))),(Object(oe["f"])()||v.includes(a["board"]))&&a&&!a["top"]&&V.a.createElement(s["a"].Item,null,V.a.createElement("a",{onClick:function(){return e.topQuestion(a,!0)}},Object(_["formatMessage"])({id:"common.top"}))),(Object(oe["f"])()||v.includes(a["board"]))&&a&&a["replies"]&&0===a["replies"].length&&V.a.createElement(s["a"].Item,null,V.a.createElement("a",{onClick:function(){return e.editReply(a)}},Object(_["formatMessage"])({id:"common.reply"}))),(Object(oe["f"])()||v.includes(a["board"]))&&a&&a["replies"]&&a["replies"].length>0&&V.a.createElement(s["a"].Item,null,V.a.createElement("a",{onClick:function(){return e.editReply(a)}},Object(_["formatMessage"])({id:"common.update-reply"}))))},V.a.createElement("a",{className:"ant-dropdown-link"},V.a.createElement(_["FormattedMessage"],{id:"common.more"})," ",V.a.createElement(l["a"],{type:"down"}))))}}))))}}]),t}(I["PureComponent"]),G=$))||G);t["default"]=ce}}]);