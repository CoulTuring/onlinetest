(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[56],{YyCY:function(e,t,a){"use strict";a.r(t);a("IzEo");var n=a("bx4M"),l=(a("qVdP"),a("jsC+")),r=(a("lUTK"),a("BvKs")),o=(a("P2fV"),a("NJEC")),i=(a("Pwec"),a("CtXQ")),s=(a("5NDa"),a("5rEg")),c=(a("+L6B"),a("2/Rp")),p=(a("2qtc"),a("kLXV")),u=(a("T2oS"),a("W9HT")),m=(a("miYZ"),a("tsqr")),d=a("qIgq"),h=a.n(d),f=a("d6i3"),b=a.n(f),w=a("1l/V"),E=a.n(w),v=a("p0pE"),g=a.n(v),C=a("2Taf"),y=a.n(C),x=a("vZ4D"),k=a.n(x),S=a("l4Ni"),T=a.n(S),O=a("ujKo"),V=a.n(O),I=a("MhPg"),P=a.n(I),F=(a("g9YV"),a("wCAj")),q=a("q1tI"),N=a.n(q),z=a("MuoO"),B=a("zHco"),j=a("FkSf"),D=(a("y8nQ"),a("Vl3Y")),A=a("d/v1"),_=a("pJVQ"),K=a("p9nB"),M=a("WAby"),Y=a("6NK7"),J=function(e){},W=function(e){function t(){var e,a;y()(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return a=T()(this,(e=V()(t)).call.apply(e,[this].concat(l))),a.state={peopleOptions:[],selectedPeople:[]},a.searchPeople=function(e,t){var n=a.props.dispatch;n({type:"people/people/search",payload:{person:t},callback:a.searchPeopleCallback})},a.searchPeopleCallback=function(e){var t=Y["a"].transferPeopleToOptionsWithName(e);a.setState({peopleOptions:t})},a}return P()(t,e),k()(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.searching,a=e.schools,n=e.handleSubmit,l=e.submitButtonText,r=e.submitting,o=this.state.peopleOptions;return N.a.createElement("div",null,N.a.createElement(D["a"],{onSubmit:n,layout:"horizontal",className:"modal-form"},N.a.createElement(A["a"],{name:"name",type:"text",size:"default",placeholder:"",label:"\u7f51\u7ad9\u540d\u79f0",required:!0,hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:K["g"]}),N.a.createElement(A["a"],{name:"url",type:"text",size:"default",placeholder:"",label:"\u7f51\u7ad9URL\u5730\u5740",required:!0,hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:K["g"]}),N.a.createElement(A["a"],{name:"school",label:"\u90e8\u95e8",size:"default",labelCol:{span:6},wrapperCol:{span:18},options:a,required:!0,hasFeedback:!0,component:K["d"]}),N.a.createElement(A["a"],{name:"owner",label:"\u90ae\u7bb1\u8d1f\u8d23\u4eba",size:"default",mode:"combobox",labelCol:{span:6},wrapperCol:{span:18},options:o,defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onFocus:this.searchPeople,onChange:this.searchPeople,required:!1,hasFeedback:!0,validate:[M["g"],M["d"]],notFoundContent:t?N.a.createElement(u["a"],{size:"small"}):null,component:K["d"]}),N.a.createElement(A["a"],{name:"notes",type:"text",size:"default",placeholder:"",label:"\u5907\u6ce8",labelCol:{span:6},wrapperCol:{span:18},component:K["f"]}),N.a.createElement(c["a"],{type:"primary",htmlType:"submit",disabled:r,className:"modal-form-button"},l)))}}]),t}(N.a.Component),L=Object(_["a"])({form:"emailForm",validate:J})(W);function Q(e,t){var a=t.email;return{searching:e.loading.effects["people/people/search"],initialValues:a,email:t.email,submitButtonText:t.submitButtonText||"\u63d0\u4ea4"}}var H,R,U,X=Object(z["connect"])(Q)(L),Z=F["a"].Column,G=(H=Object(z["connect"])(function(e){return{loading:e.loading.effects["network-services/emails/fetch"],list:e["network-services/emails"].data.list,pagination:e["network-services/emails"].data.pagination}}),H((U=function(e){function t(){var e,a;y()(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return a=T()(this,(e=V()(t)).call.apply(e,[this].concat(l))),a.state={email:null,schoolsOptions:[],schoolsSelectOptions:[],ordering:"",filters:null,filterVisible:!1,filtered:!1,searchText:"",modalTitle:"",modalContent:null,submitButtonText:"",modalVisible:!1,submitting:!1},a.fetchEmails=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.props,n=t.dispatch,l=t.pagination,r=a.state,o=r.ordering,i=r.filters,s=r.searchText;n(e?{type:"network-services/emails/fetch",payload:e}:{type:"network-services/emails/fetch",payload:g()({search:s,page:l?l.current:1,ordering:o},i)})},a.fetchSchools=function(){var e=a.props.dispatch;e({type:"schools/schools/fetchPublic",payload:{},callback:a.fetchSchoolsCallback})},a.fetchSchoolsCallback=function(e){a.setState({schoolsOptions:Y["a"].transferObjectsToFilterOptions(e)}),a.setState({schoolsSelectOptions:Y["a"].transferObjectsToSelectOptionsWithoutID(e)})},a.handleTableChange=function(){var e=E()(b.a.mark(function e(t,n,l){var r,o;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return r=a.state.searchText,o=Y["a"].transferSorterToOrdering(l),a.setState({ordering:o,filters:n}),e.next=5,a.fetchEmails(g()({search:r,page:t.current,ordering:o},n));case 5:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.editEmail=E()(b.a.mark(function e(){var t,n,l,r,o,i,s,c,p=arguments;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:null,n=a.state,l=n.schoolsSelectOptions,r=n.submitting,o=null===t?["\u521b\u5efa\u7f51\u7ad9\u5907\u6848","\u521b\u5efa"]:["\u7f16\u8f91\u7f51\u7ad9\u5907\u6848","\u7f16\u8f91"],i=h()(o,2),s=i[0],c=i[1],e.next=5,a.setState({email:t?g()({},t,{owner:"".concat(t["owner_detail"]["name"],"(").concat(t["owner_detail"]["id"],")")}):{}});case 5:return e.next=7,a.setState({modalTitle:s,modalContent:N.a.createElement(X,{email:a.state.email,schools:l,title:s,submitButtonText:c,onSubmit:a.onSubmit,submitting:r}),submitButtonText:c,modalVisible:!0});case 7:case"end":return e.stop()}},e)})),a.deleteEmail=function(){var e=E()(b.a.mark(function e(t){var n;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=a.props.dispatch,n({type:"network-services/emails/remove",payload:{email:t},callback:function(){return a.deleteEmailCallback(t["name"])}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.deleteEmailCallback=function(e){m["a"].success("\u6210\u529f\u5220\u9664\u7f51\u7ad9\u5907\u6848 ".concat(e,"\u3002")),a.fetchEmails()},a.onInputChange=function(e){a.setState({searchText:e.target.value})},a.onEmailSearch=E()(b.a.mark(function e(){var t,n,l,r;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=a.state,n=t.ordering,l=t.filters,r=t.searchText,e.next=3,a.fetchEmails(g()({search:r,page:1,ordering:n},l));case 3:a.setState({filterVisible:!1,filtered:!!r});case 4:case"end":return e.stop()}},e)})),a.handleCancel=E()(b.a.mark(function e(){return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({modalVisible:!1,modalContent:null});case 2:case"end":return e.stop()}},e)})),a.onSubmit=function(){var e=E()(b.a.mark(function e(t){var n,l,r,o;return b.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.props.dispatch,l=a.state.email,r=/\((\w{4,11})\)/.exec(t["owner"]),o=g()({},t,{owner:r[1]}),console.warn("new values: ",o),e.prev=5,e.next=8,a.setState({submitting:!0});case 8:l&&l["id"]?n({type:"network-services/emails/update",payload:{email:g()({},o)},callback:function(){return a.fetchEmails()}}):n({type:"network-services/emails/add",payload:{email:o},callback:function(){return a.fetchEmails()}}),e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](5),console.log(e.t0);case 14:return e.prev=14,e.next=17,a.setState({submitting:!1});case 17:return e.finish(14);case 18:return e.next=20,a.setState({modalVisible:!1,modalContent:null});case 20:case"end":return e.stop()}},e,null,[[5,11,14,18]])}));return function(t){return e.apply(this,arguments)}}(),a}return P()(t,e),k()(t,[{key:"componentDidMount",value:function(){this.fetchEmails(),this.fetchSchools()}},{key:"render",value:function(){var e=this,t=this.props,a=t.list,m=t.pagination,d=t.loading,h=this.state,f=h.schoolsOptions,b=h.filtered,w=h.filterVisible,E=h.modalTitle,v=h.modalContent,g=h.modalVisible;return console.warn("list, pages, loading:",a,m,d),N.a.createElement(B["a"],{title:"\u7f51\u7ad9\u5907\u6848\u7ba1\u7406"},N.a.createElement(n["a"],{bordered:!1},m&&N.a.createElement(j["a"],null,m.total),N.a.createElement(p["a"],{title:E,visible:g,onCancel:this.handleCancel,footer:null},v||N.a.createElement(u["a"],{spinning:d})),N.a.createElement(c["a"],{type:"primary",onClick:function(){return e.editEmail()}},"\u65b0\u5efa\u7f51\u7ad9\u5907\u6848"),N.a.createElement(F["a"],{dataSource:a,loading:d,rowKey:"id",onChange:this.handleTableChange,pagination:m,width:1e3,scroll:{x:1e3}},N.a.createElement(Z,{title:"\u7f51\u7ad9\u5907\u6848\u53f7(\u5185\u90e8)",dataIndex:"id"}),N.a.createElement(Z,{title:"\u540d\u79f0",dataIndex:"name",filterDropdown:N.a.createElement("div",{className:"table-input-search"},N.a.createElement(s["a"],{placeholder:"\u540d\u79f0",value:this.state.searchText,onChange:this.onInputChange,onPressEnter:this.onEmailSearch}),N.a.createElement(c["a"],{type:"primary",onClick:this.onEmailSearch},"\u68c0\u7d22")),filterIcon:N.a.createElement(i["a"],{type:"search",style:{color:b?"#108ee9":"#aaa"}}),filterDropdownVisible:w,onFilterDropdownVisibleChange:function(t){e.setState({filterVisible:t})}}),N.a.createElement(Z,{title:"\u7f51\u5740",dataIndex:"url"}),N.a.createElement(Z,{title:"\u90e8\u95e8",dataIndex:"school",render:function(e,t){return t["school_detail"]?t["school_detail"]["name"]:""},filters:f}),N.a.createElement(Z,{title:"\u8d1f\u8d23\u4eba",dataIndex:"owner",render:function(e,t){return t["owner_detail"]?t["owner_detail"]["name"]:t["owner"]}}),N.a.createElement(Z,{title:"\u5907\u6ce8",dataIndex:"notes"}),N.a.createElement(Z,{title:"\u6dfb\u52a0\u65f6\u95f4",dataIndex:"created",sorter:!0}),N.a.createElement(Z,{title:"\u4fee\u6539\u65f6\u95f4",dataIndex:"modified",sorter:!0}),N.a.createElement(Z,{title:"\u64cd\u4f5c",width:152,fixed:"right",render:function(t,a){return N.a.createElement("div",null,N.a.createElement("a",{onClick:function(){return e.editEmail(a)}},"\u7f16\u8f91"),N.a.createElement("span",{className:"ant-divider"}),N.a.createElement(l["a"],{overlay:N.a.createElement(r["a"],null,N.a.createElement(r["a"].Item,null,N.a.createElement(o["a"],{title:"\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f",onConfirm:function(){return e.deleteEmail(a)}},N.a.createElement("a",{href:"#"},"\u5220\u9664"))))},N.a.createElement("a",{className:"ant-dropdown-link"},"\u66f4\u591a ",N.a.createElement(i["a"],{type:"down"}))))}}))))}}]),t}(q["PureComponent"]),R=U))||R);t["default"]=G}}]);