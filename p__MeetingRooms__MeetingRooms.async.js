(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[50],{UwSR:function(e,t,a){"use strict";a.r(t);a("IzEo");var n=a("bx4M"),o=(a("qVdP"),a("jsC+")),r=(a("lUTK"),a("BvKs")),l=(a("Awhp"),a("KrTs")),i=(a("Pwec"),a("CtXQ")),c=(a("5NDa"),a("5rEg")),s=(a("+L6B"),a("2/Rp")),m=(a("T2oS"),a("W9HT")),p=(a("miYZ"),a("tsqr")),d=(a("2qtc"),a("kLXV")),u=a("qIgq"),h=a.n(u),f=a("d6i3"),g=a.n(f),b=a("1l/V"),v=a.n(b),w=a("p0pE"),E=a.n(w),x=a("2Taf"),C=a.n(x),y=a("vZ4D"),k=a.n(y),R=a("l4Ni"),S=a.n(R),O=a("ujKo"),T=a.n(O),_=a("MhPg"),I=a.n(_),M=(a("g9YV"),a("wCAj")),V=a("q1tI"),F=a.n(V),P=a("MuoO"),z=a("zHco"),j=a("FkSf"),A=(a("y8nQ"),a("Vl3Y")),B=a("d/v1"),N=a("pJVQ"),D=a("p9nB"),q=a("WAby"),K=a("6NK7"),W=function(e){},J=function(e){function t(){var e,a;C()(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return a=S()(this,(e=T()(t)).call.apply(e,[this].concat(o))),a.state={roomsOptions:[],selectedRooms:[],peopleOptions:[],selectedPeople:[]},a.selectRoom=function(e,t){var n=a.props.dispatch;console.log("in clear content: ",e,t),console.log(t.props,t.props.id),n({type:"meeting-rooms/meeting-rooms/selectRoom",payload:t.props.id})},a.searchRoom=function(e,t){console.log("in search room function");var n=a.props.dispatch;n({type:"rooms/rooms/search",payload:{room:t},callback:a.searchRoomsCallback})},a.searchRoomsCallback=function(e){console.log("in callback: ",e);var t=e.map(function(e){return Object.assign({},e,{key:"".concat(e.id),value:"".concat(e["fullname"],"(").concat(e["full_id"],")"),label:"".concat(e["fullname"],"(").concat(e["full_id"],")")})});a.setState({roomsOptions:t})},a.searchPeople=function(e,t){var n=a.props.dispatch;n({type:"people/people/search",payload:{person:t},callback:a.searchPeopleCallback})},a.searchPeopleCallback=function(e){var t=K["a"].transferPeopleToOptionsWithName(e);a.setState({peopleOptions:t})},a}return I()(t,e),k()(t,[{key:"componentDidMount",value:function(){this.props.meetingRoom}},{key:"render",value:function(){var e=this.props,t=e.schools,a=e.roomsSearching,n=e.searching,o=e.handleSubmit,r=e.submitButtonText,l=e.submitting,i=this.state,c=i.roomsOptions,p=i.peopleOptions;return F.a.createElement("div",null,F.a.createElement(A["a"],{onSubmit:o,layout:"horizontal",className:"modal-form"},F.a.createElement(B["a"],{name:"room",label:"\u623f\u95f4",size:"default",mode:"combobox",labelCol:{span:6},wrapperCol:{span:18},options:c,defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onFocus:this.searchRoom,onSelect:this.selectRoom,onChange:this.searchRoom,required:!1,hasFeedback:!0,validate:[q["g"]],notFoundContent:a?F.a.createElement(m["a"],{size:"small"}):null,component:D["d"]}),F.a.createElement(B["a"],{name:"name",type:"text",size:"default",placeholder:"",label:"\u623f\u95f4\u540d\u79f0",hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:D["g"]}),F.a.createElement(B["a"],{name:"seats",type:"text",size:"default",placeholder:"",label:"\u5ea7\u4f4d\u6570",hasFeedback:!0,labelCol:{span:6},wrapperCol:{span:18},component:D["g"]}),F.a.createElement(B["a"],{name:"school",label:"\u96b6\u5c5e\u90e8\u95e8",size:"default",labelCol:{span:6},wrapperCol:{span:18},options:t,hasFeedback:!0,component:D["d"]}),F.a.createElement(B["a"],{name:"contact",label:"\u8054\u7cfb\u4eba",size:"default",mode:"combobox",labelCol:{span:6},wrapperCol:{span:18},options:p,defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onFocus:this.searchPeople,onChange:this.searchPeople,hasFeedback:!0,validate:[q["d"]],notFoundContent:n?F.a.createElement(m["a"],{size:"small"}):null,component:D["d"]}),F.a.createElement(B["a"],{name:"visible",label:"\u53ef\u8bbf\u95ee\u6027",size:"default",labelCol:{span:6},wrapperCol:{span:18},defaultChecked:!0,checkedChildren:"\u5168\u4f53\u53ef\u89c1",unCheckedChildren:"\u7ba1\u7406\u5458\u53ef\u89c1",component:D["e"]}),F.a.createElement(s["a"],{type:"primary",htmlType:"submit",disabled:l,className:"modal-form-button"},r)))}}]),t}(F.a.Component),Q=Object(N["a"])({form:"meetingRoomForm",validate:W})(J);function Y(e,t){var a=t.meetingRoom;return{roomsSearching:e.loading.effects["rooms/rooms/search"],searching:e.loading.effects["people/people/search"],initialValues:a,meetingRoom:t.meetingRoom,submitButtonText:t.submitButtonText||"\u63d0\u4ea4"}}var H,L,U,X=Object(P["connect"])(Y)(Q),Z=M["a"].Column,G=(H=Object(P["connect"])(function(e){return{loading:e.loading.effects["meeting-rooms/meeting-rooms/fetch"],list:e["meeting-rooms/meeting-rooms"].data.list,selectedRoomId:e["meeting-rooms/meeting-rooms"].selectedRoomId,pagination:e["meeting-rooms/meeting-rooms"].data.pagination}}),H((U=function(e){function t(){var e,a;C()(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return a=S()(this,(e=T()(t)).call.apply(e,[this].concat(o))),a.state={meetingRoom:null,schoolsOptions:[],schoolsSelectOptions:[],ordering:"",filters:null,filterVisible:!1,filtered:!1,searchText:"",modalTitle:"",modalContent:null,submitButtonText:"",modalVisible:!1,submitting:!1},a.fetchMeetingRooms=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.props,n=t.dispatch,o=t.pagination,r=a.state,l=r.ordering,i=r.filters,c=r.searchText;n(e?{type:"meeting-rooms/meeting-rooms/fetch",payload:e}:{type:"meeting-rooms/meeting-rooms/fetch",payload:E()({search:c,page:o?o.current:1,ordering:l},i)})},a.fetchSchools=function(){var e=a.props.dispatch;e({type:"schools/schools/fetchPublic",payload:{},callback:a.fetchSchoolsCallback})},a.fetchSchoolsCallback=function(e){a.setState({schoolsOptions:K["a"].transferObjectsToFilterOptions(e)}),a.setState({schoolsSelectOptions:K["a"].transferObjectsToSelectOptionsWithoutID(e)})},a.handleTableChange=function(){var e=v()(g.a.mark(function e(t,n,o){var r,l;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return r=a.state.searchText,l=K["a"].transferSorterToOrdering(o),a.setState({ordering:l,filters:n}),e.next=5,a.fetchMeetingRooms(E()({search:r,page:t.current,ordering:l},n));case 5:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.editMeetingRoom=v()(g.a.mark(function e(){var t,n,o,r,l,i,c,s,m,p=arguments;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:null,n=a.props.dispatch,o=a.state,r=o.schoolsSelectOptions,l=o.submitting,i=null===t?["\u521b\u5efa\u4f1a\u8bae\u5ba4","\u521b\u5efa"]:["\u7f16\u8f91\u4f1a\u8bae\u5ba4","\u7f16\u8f91"],c=h()(i,2),s=c[0],m=c[1],t&&n({type:"meeting-rooms/meeting-rooms/selectRoom",payload:t["room"]}),e.next=7,a.setState({meetingRoom:t?E()({},t,{room:"".concat(t["room_detail"]["fullname"],"(").concat(t["room_detail"]["full_id"],")"),contact:t["contact_detail"]?"".concat(t["contact_detail"]["name"],"(").concat(t["contact_detail"]["id"],")"):""}):{}});case 7:return e.next=9,a.setState({modalTitle:s,modalContent:F.a.createElement(X,{meetingRoom:a.state.meetingRoom,schools:r,title:s,submitButtonText:m,onSubmit:a.onSubmit,submitting:l}),submitButtonText:m,modalVisible:!0});case 9:case"end":return e.stop()}},e)})),a.deleteMeetingRoom=function(){var e=v()(g.a.mark(function e(t){var n;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=a.props.dispatch,d["a"].confirm({title:"\u60a8\u786e\u8ba4\u8981\u5220\u9664\u4f1a\u8bae\u5ba4 ".concat(t["name"]?t["name"]:t["room_detail"]?t["room_detail"]["name"]:""," \u5417?"),content:"\u5220\u9664\u540e\u5c06\u4e0d\u53ef\u6062\u590d\uff0c\u5176\u76f8\u5173\u6570\u636e\u3001\u4fe1\u606f\u4e5f\u5c06\u4e00\u5e76\u5220\u9664\u3002",onOk:function(){var e=v()(g.a.mark(function e(){return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n({type:"meeting-rooms/meeting-rooms/remove",payload:{meetingRoom:t},callback:function(){return a.fetchMeetingRooms()}}),p["a"].success("\u6210\u529f\u5220\u9664\u4f1a\u8bae\u5ba4 ".concat(t["name"]?t["name"]:t["room_detail"]?t["room_detail"]["name"]:"","\u3002"));case 2:case"end":return e.stop()}},e)}));function o(){return e.apply(this,arguments)}return o}(),onCancel:function(){}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.onInputChange=function(e){a.setState({searchText:e.target.value})},a.onMeetingRoomSearch=v()(g.a.mark(function e(){var t,n,o,r;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=a.state,n=t.ordering,o=t.filters,r=t.searchText,e.next=3,a.fetchMeetingRooms(E()({search:r,page:1,ordering:n},o));case 3:a.setState({filterVisible:!1,filtered:!!r});case 4:case"end":return e.stop()}},e)})),a.handleCancel=v()(g.a.mark(function e(){return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.setState({modalVisible:!1,modalContent:null});case 2:case"end":return e.stop()}},e)})),a.onSubmit=function(){var e=v()(g.a.mark(function e(t){var n,o,r,l,i,c;return g.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.props,o=n.dispatch,r=n.selectedRoomId,l=a.state.meetingRoom,i=/\((\w{4,11})\)/.exec(t["contact"]),c=E()({},t,{room:"".concat(r),contact:i[1],visible:!!t["visible"]}),console.warn("new values: ",c),e.prev=5,e.next=8,a.setState({submitting:!0});case 8:l&&l["room"]?o({type:"meeting-rooms/meeting-rooms/update",payload:{meetingRoom:E()({},c)},callback:function(){return a.fetchMeetingRooms()}}):o({type:"meeting-rooms/meeting-rooms/add",payload:{meetingRoom:c},callback:function(){return a.fetchMeetingRooms()}}),e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](5),console.log(e.t0);case 14:return e.prev=14,e.next=17,a.setState({submitting:!1});case 17:return e.finish(14);case 18:return e.next=20,a.setState({modalVisible:!1,modalContent:null});case 20:case"end":return e.stop()}},e,null,[[5,11,14,18]])}));return function(t){return e.apply(this,arguments)}}(),a}return I()(t,e),k()(t,[{key:"componentDidMount",value:function(){this.fetchMeetingRooms(),this.fetchSchools()}},{key:"render",value:function(){var e=this,t=this.props,a=t.list,p=t.pagination,u=t.loading,h=this.state,f=h.schoolsOptions,g=h.filtered,b=h.filterVisible,v=h.modalTitle,w=h.modalContent,E=h.modalVisible;return console.warn("list, pages, loading:",a,p,u),F.a.createElement(z["a"],{title:"\u4f1a\u8bae\u5ba4\u7ba1\u7406"},F.a.createElement(n["a"],{bordered:!1},p&&F.a.createElement(j["a"],null,p.total),F.a.createElement(d["a"],{title:v,visible:E,onCancel:this.handleCancel,footer:null},w||F.a.createElement(m["a"],{spinning:u})),F.a.createElement(s["a"],{type:"primary",onClick:function(){return e.editMeetingRoom()}},"\u65b0\u5efa\u4f1a\u8bae\u5ba4"),F.a.createElement(M["a"],{dataSource:a,loading:u,rowKey:"room",onChange:this.handleTableChange,pagination:p,width:1e3,scroll:{x:1e3}},F.a.createElement(Z,{title:"\u623f\u95f4\u7f16\u53f7",dataIndex:"room",render:function(e,t){return t["room_detail"]?t["room_detail"]["full_id"]:""}}),F.a.createElement(Z,{title:"\u623f\u95f4\u540d\u79f0",dataIndex:"room_detail",render:function(e,t){return t["room_detail"]&&t["room_detail"]["name"]?t["room_detail"]["name"]:t["room_detail"]["fullname"]}}),F.a.createElement(Z,{title:"\u540d\u79f0",dataIndex:"name",filterDropdown:F.a.createElement("div",{className:"table-input-search"},F.a.createElement(c["a"],{placeholder:"\u540d\u79f0",value:this.state.searchText,onChange:this.onInputChange,onPressEnter:this.onMeetingRoomSearch}),F.a.createElement(s["a"],{type:"primary",onClick:this.onMeetingRoomSearch},"\u68c0\u7d22")),filterIcon:F.a.createElement(i["a"],{type:"search",style:{color:g?"#108ee9":"#aaa"}}),filterDropdownVisible:b,onFilterDropdownVisibleChange:function(t){e.setState({filterVisible:t})}}),F.a.createElement(Z,{title:"\u5ea7\u4f4d\u6570",dataIndex:"seats"}),F.a.createElement(Z,{title:"\u7535\u8111",dataIndex:"computers"}),F.a.createElement(Z,{title:"\u6295\u5f71\u4eea",dataIndex:"projectors"}),F.a.createElement(Z,{title:"\u6295\u5f71\u8367\u5e55/\u7535\u5b50\u5c4f",dataIndex:"screens"}),F.a.createElement(Z,{title:"\u8c03\u97f3\u64cd\u4f5c\u53f0",dataIndex:"controls"}),F.a.createElement(Z,{title:"\u4f1a\u8bae\u9ea6",dataIndex:"meeting_mics"}),F.a.createElement(Z,{title:"\u65e0\u7ebf\u9ea6",dataIndex:"wireless_mics"}),F.a.createElement(Z,{title:"\u529f\u653e",dataIndex:"stereos"}),F.a.createElement(Z,{title:"\u996e\u6c34\u673a",dataIndex:"water_machines"}),F.a.createElement(Z,{title:"\u96b6\u5c5e\u90e8\u95e8",dataIndex:"school",render:function(e,t){return t["school_detail"]?t["school_detail"]["name"]:""},filters:f}),F.a.createElement(Z,{title:"\u8054\u7cfb\u4eba",dataIndex:"contact",render:function(e,t){return t["contact_detail"]?t["contact_detail"]["name"]:""}}),F.a.createElement(Z,{title:"\u5f00\u653e",dataIndex:"visible",render:function(e){return e?F.a.createElement(l["a"],{status:"success",text:"\u5f00\u653e"}):F.a.createElement(l["a"],{status:"default",text:"\u5173\u95ed"})}}),F.a.createElement(Z,{title:"\u64cd\u4f5c",width:152,fixed:"right",render:function(t,a){return F.a.createElement("div",null,F.a.createElement("a",{onClick:function(){return e.editMeetingRoom(a)}},"\u7f16\u8f91"),F.a.createElement("span",{className:"ant-divider"}),F.a.createElement(o["a"],{overlay:F.a.createElement(r["a"],null,F.a.createElement(r["a"].Item,null,F.a.createElement("a",{onClick:function(){return e.deleteMeetingRoom(a)}},"\u5220\u9664")))},F.a.createElement("a",{className:"ant-dropdown-link"},"\u66f4\u591a ",F.a.createElement(i["a"],{type:"down"}))))}}))))}}]),t}(V["PureComponent"]),L=U))||L);t["default"]=G}}]);